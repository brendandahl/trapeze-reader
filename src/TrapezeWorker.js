var COMPILED=true;var goog=goog||{};goog.global=this;goog.DEBUG=true;goog.LOCALE="en";goog.evalWorksForGlobals_=null;goog.provide=function(name){if(!COMPILED){if(goog.getObjectByName(name)&&!goog.implicitNamespaces_[name])throw Error('Namespace "'+name+'" already declared.');var namespace=name;while(namespace=namespace.substring(0,namespace.lastIndexOf(".")))goog.implicitNamespaces_[namespace]=true}goog.exportPath_(name)};
goog.setTestOnly=function(opt_message){if(COMPILED&&!goog.DEBUG){opt_message=opt_message||"";throw Error("Importing test-only code into non-debug environment"+opt_message?": "+opt_message:".");}};if(!COMPILED)goog.implicitNamespaces_={};
goog.exportPath_=function(name,opt_object,opt_objectToExportTo){var parts=name.split(".");var cur=opt_objectToExportTo||goog.global;if(!(parts[0]in cur)&&cur.execScript)cur.execScript("var "+parts[0]);for(var part;parts.length&&(part=parts.shift());)if(!parts.length&&goog.isDef(opt_object))cur[part]=opt_object;else if(cur[part])cur=cur[part];else cur=cur[part]={}};
goog.getObjectByName=function(name,opt_obj){var parts=name.split(".");var cur=opt_obj||goog.global;for(var part;part=parts.shift();)if(goog.isDefAndNotNull(cur[part]))cur=cur[part];else return null;return cur};goog.globalize=function(obj,opt_global){var global=opt_global||goog.global;for(var x in obj)global[x]=obj[x]};
goog.addDependency=function(relPath,provides,requires){if(!COMPILED){var provide,require;var path=relPath.replace(/\\/g,"/");var deps=goog.dependencies_;for(var i=0;provide=provides[i];i++){deps.nameToPath[provide]=path;if(!(path in deps.pathToNames))deps.pathToNames[path]={};deps.pathToNames[path][provide]=true}for(var j=0;require=requires[j];j++){if(!(path in deps.requires))deps.requires[path]={};deps.requires[path][require]=true}}};
goog.require=function(rule){if(!COMPILED){if(goog.getObjectByName(rule))return;var path=goog.getPathFromDeps_(rule);if(path){goog.included_[path]=true;goog.writeScripts_()}else{var errorMessage="goog.require could not find: "+rule;if(goog.global.console)goog.global.console["error"](errorMessage);throw Error(errorMessage);}}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.nullFunction=function(){};goog.identityFunction=function(var_args){return arguments[0]};
goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(ctor){ctor.getInstance=function(){return ctor.instance_||(ctor.instance_=new ctor)}};
if(!COMPILED){goog.included_={};goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}};goog.inHtmlDocument_=function(){var doc=goog.global.document;return typeof doc!="undefined"&&"write"in doc};goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else if(!goog.inHtmlDocument_())return;var doc=goog.global.document;var scripts=doc.getElementsByTagName("script");for(var i=scripts.length-1;i>=0;--i){var src=scripts[i].src;
var qmark=src.lastIndexOf("?");var l=qmark==-1?src.length:qmark;if(src.substr(l-7,7)=="base.js"){goog.basePath=src.substr(0,l-7);return}}};goog.importScript_=function(src){var importScript=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;if(!goog.dependencies_.written[src]){goog.dependencies_.written[src]=true;importScript(src)}};goog.writeScriptTag_=function(src){if(goog.inHtmlDocument_()){var doc=goog.global.document;doc.write('<script type="text/javascript" src="'+src+'"></'+"script>");
return true}else return false};goog.writeScripts_=function(){var scripts=[];var seenScript={};var deps=goog.dependencies_;function visitNode(path){if(path in deps.written)return;if(path in deps.visited){if(!(path in seenScript)){seenScript[path]=true;scripts.push(path)}return}deps.visited[path]=true;if(path in deps.requires)for(var requireName in deps.requires[path])if(requireName in deps.nameToPath)visitNode(deps.nameToPath[requireName]);else if(!goog.getObjectByName(requireName))throw Error("Undefined nameToPath for "+
requireName);if(!(path in seenScript)){seenScript[path]=true;scripts.push(path)}}for(var path in goog.included_)if(!deps.written[path])visitNode(path);for(var i=0;i<scripts.length;i++)if(scripts[i])goog.importScript_(goog.basePath+scripts[i]);else throw Error("Undefined script input");};goog.getPathFromDeps_=function(rule){if(rule in goog.dependencies_.nameToPath)return goog.dependencies_.nameToPath[rule];else return null};goog.findBasePath_();if(!goog.global.CLOSURE_NO_DEPS)goog.importScript_(goog.basePath+
"deps.js")}
goog.typeOf=function(value){var s=typeof value;if(s=="object")if(value){if(value instanceof Array)return"array";else if(value instanceof Object)return s;var className=Object.prototype.toString.call(value);if(className=="[object Window]")return"object";if(className=="[object Array]"||typeof value.length=="number"&&typeof value.splice!="undefined"&&typeof value.propertyIsEnumerable!="undefined"&&!value.propertyIsEnumerable("splice"))return"array";if(className=="[object Function]"||typeof value.call!="undefined"&&
typeof value.propertyIsEnumerable!="undefined"&&!value.propertyIsEnumerable("call"))return"function"}else return"null";else if(s=="function"&&typeof value.call=="undefined")return"object";return s};goog.propertyIsEnumerableCustom_=function(object,propName){if(propName in object)for(var key in object)if(key==propName&&Object.prototype.hasOwnProperty.call(object,propName))return true;return false};
goog.propertyIsEnumerable_=function(object,propName){if(object instanceof Object)return Object.prototype.propertyIsEnumerable.call(object,propName);else return goog.propertyIsEnumerableCustom_(object,propName)};goog.isDef=function(val){return val!==undefined};goog.isNull=function(val){return val===null};goog.isDefAndNotNull=function(val){return val!=null};goog.isArray=function(val){return goog.typeOf(val)=="array"};
goog.isArrayLike=function(val){var type=goog.typeOf(val);return type=="array"||type=="object"&&typeof val.length=="number"};goog.isDateLike=function(val){return goog.isObject(val)&&typeof val.getFullYear=="function"};goog.isString=function(val){return typeof val=="string"};goog.isBoolean=function(val){return typeof val=="boolean"};goog.isNumber=function(val){return typeof val=="number"};goog.isFunction=function(val){return goog.typeOf(val)=="function"};
goog.isObject=function(val){var type=goog.typeOf(val);return type=="object"||type=="array"||type=="function"};goog.getUid=function(obj){return obj[goog.UID_PROPERTY_]||(obj[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.removeUid=function(obj){if("removeAttribute"in obj)obj.removeAttribute(goog.UID_PROPERTY_);try{delete obj[goog.UID_PROPERTY_]}catch(ex){}};goog.UID_PROPERTY_="closure_uid_"+Math.floor(Math.random()*2147483648).toString(36);goog.uidCounter_=0;goog.getHashCode=goog.getUid;
goog.removeHashCode=goog.removeUid;goog.cloneObject=function(obj){var type=goog.typeOf(obj);if(type=="object"||type=="array"){if(obj.clone)return obj.clone();var clone=type=="array"?[]:{};for(var key in obj)clone[key]=goog.cloneObject(obj[key]);return clone}return obj};Object.prototype.clone;goog.bindNative_=function(fn,selfObj,var_args){return fn.call.apply(fn.bind,arguments)};
goog.bindJs_=function(fn,selfObj,var_args){var context=selfObj||goog.global;if(arguments.length>2){var boundArgs=Array.prototype.slice.call(arguments,2);return function(){var newArgs=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(newArgs,boundArgs);return fn.apply(context,newArgs)}}else return function(){return fn.apply(context,arguments)}};
goog.bind=function(fn,selfObj,var_args){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1)goog.bind=goog.bindNative_;else goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(fn,var_args){var args=Array.prototype.slice.call(arguments,1);return function(){var newArgs=Array.prototype.slice.call(arguments);newArgs.unshift.apply(newArgs,args);return fn.apply(this,newArgs)}};
goog.mixin=function(target,source){for(var x in source)target[x]=source[x]};goog.now=Date.now||function(){return+new Date};
goog.globalEval=function(script){if(goog.global.execScript)goog.global.execScript(script,"JavaScript");else if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval("var _et_ = 1;");if(typeof goog.global["_et_"]!="undefined"){delete goog.global["_et_"];goog.evalWorksForGlobals_=true}else goog.evalWorksForGlobals_=false}if(goog.evalWorksForGlobals_)goog.global.eval(script);else{var doc=goog.global.document;var scriptElt=doc.createElement("script");scriptElt.type="text/javascript";
scriptElt.defer=false;scriptElt.appendChild(doc.createTextNode(script));doc.body.appendChild(scriptElt);doc.body.removeChild(scriptElt)}}else throw Error("goog.globalEval not available");};goog.cssNameMapping_;goog.cssNameMappingStyle_;
goog.getCssName=function(className,opt_modifier){var getMapping=function(cssName){return goog.cssNameMapping_[cssName]||cssName};var renameByParts=function(cssName){var parts=cssName.split("-");var mapped=[];for(var i=0;i<parts.length;i++)mapped.push(getMapping(parts[i]));return mapped.join("-")};var rename;if(goog.cssNameMapping_)rename=goog.cssNameMappingStyle_=="BY_WHOLE"?getMapping:renameByParts;else rename=function(a){return a};if(opt_modifier)return className+"-"+rename(opt_modifier);else return rename(className)};
goog.setCssNameMapping=function(mapping,style){goog.cssNameMapping_=mapping;goog.cssNameMappingStyle_=style};goog.getMsg=function(str,opt_values){var values=opt_values||{};for(var key in values){var value=(""+values[key]).replace(/\$/g,"$$$$");str=str.replace(new RegExp("\\{\\$"+key+"\\}","gi"),value)}return str};goog.exportSymbol=function(publicPath,object,opt_objectToExportTo){goog.exportPath_(publicPath,object,opt_objectToExportTo)};
goog.exportProperty=function(object,publicName,symbol){object[publicName]=symbol};goog.inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor;childCtor.prototype.constructor=childCtor};
goog.base=function(me,opt_methodName,var_args){var caller=arguments.callee.caller;if(caller.superClass_)return caller.superClass_.constructor.apply(me,Array.prototype.slice.call(arguments,1));var args=Array.prototype.slice.call(arguments,2);var foundCaller=false;for(var ctor=me.constructor;ctor;ctor=ctor.superClass_&&ctor.superClass_.constructor)if(ctor.prototype[opt_methodName]===caller)foundCaller=true;else if(foundCaller)return ctor.prototype[opt_methodName].apply(me,args);if(me[opt_methodName]===
caller)return me.constructor.prototype[opt_methodName].apply(me,args);else throw Error("goog.base called from a method of one name "+"to a method of a different name");};goog.scope=function(fn){fn.call(goog.global)};goog.provide("trapeze.util");function extend(subClass,baseClass){function inheritance(){}inheritance.prototype=baseClass.prototype;subClass.prototype=new inheritance;subClass.prototype.constructor=subClass;subClass.baseConstructor=baseClass;subClass.superClass=baseClass.prototype}
function getBytes(s){var length=s.length;var ret=[];for(var i=0;i<length;i++)ret.push(s.charCodeAt(i)&255);return ret}function isDigit(c){if(c>="0"&&c<="9")return true;return false}function intToSignedByte(i){if(i>127)return i-256;else return i}function toSignedByte(c){var bite=c.charCodeAt(0);if(bite>127)return bite-256;else return bite}String.prototype.repeat=function(num){return(new Array(num+1)).join(this)};goog.provide("trapeze.Exceptions");
function UnimplementedException(message){this.message="UnimplementedException: "+message;console.error(this.message);this.toString=function(){return this.message}}function ParseException(message){this.message="ParseException: "+message;console.error(this.message);this.toString=function(){return this.message}}function Exception(message){this.message="Exception: "+message;console.error(this.message);this.toString=function(){return this.message}}goog.provide("trapeze.AsyncFileReader");
trapeze.AsyncFileReader=function(url,context,callback,progress){this.url=url;this.callback=callback;this.progress=progress;this.context=context};
trapeze.AsyncFileReader.prototype.start=function(){var that=this;if(this.url instanceof File){var reader=new FileReader;reader.onload=function(e){var fileContents=e.target.result;var fileSize=fileContents.length;that.callback.apply(that.context,[fileSize,fileContents])};reader.readAsBinaryString(this.url)}else{var req=new XMLHttpRequest;req.addEventListener("progress",function(e){that.progress.apply(that.context,[e])},false);req.addEventListener("load",function(){if(req.status!=200)throw new Exception("File load failed");
var fileContents=req.responseText;var fileSize=fileContents.length;that.callback.apply(that.context,[fileSize,fileContents])},false);req.open("GET",this.url,true);req.overrideMimeType("text/plain; charset=x-user-defined");req.send(null)}};goog.provide("trapeze.Faux2dContext");trapeze.Faux2dContext=function(listener,index){this.listener=listener;this.index=index;this.actions=[]};
trapeze.Faux2dContext.prototype={callFunction:function(method,args){args=Array.prototype.slice.call(args);this.actions.push([0,method,args])},setAttribute:function(key,value){this.actions.push([1,key,value])},callCustom:function(method,args){args=Array.prototype.slice.call(args);this.actions.push([3,method,args])},post:function(){this.listener(["pageReady",[this.index,this.actions]])},save:function(){this.callFunction("save",[])},restore:function(){this.callFunction("restore",[])},rotate:function(){this.callFunction("rotate",
arguments)},scale:function(){this.callFunction("scale",arguments)},setTransform:function(){this.callFunction("setTransform",arguments)},transform:function(){this.callFunction("transform",arguments)},translate:function(){this.callFunction("translate",arguments)},clearRect:function(){this.callFunction("clearRect",arguments)},fillRect:function(){this.callFunction("fillRect",arguments)},strokeRect:function(){this.callFunction("strokeRect",arguments)},arc:function(){this.callFunction("arc",arguments)},
arcTo:function(){this.callFunction("arcTo",arguments)},beginPath:function(){this.callFunction("beginPath",[])},bezierCurveTo:function(){this.callFunction("bezierCurveTo",arguments)},clip:function(){this.callFunction("clip",arguments)},closePath:function(){this.callFunction("closePath",arguments)},fill:function(){this.callFunction("fill",arguments)},lineTo:function(){this.callFunction("lineTo",arguments)},moveTo:function(){this.callFunction("moveTo",arguments)},quadraticCurveTo:function(){this.callFunction("quadraticCurveTo",
arguments)},rect:function(){this.callFunction("rect",arguments)},stroke:function(){this.callFunction("stroke",arguments)},drawImage:function(){this.callCustom("drawImage",arguments)},createImageData:function(width,height){return{data:new Array(width*height*4),length:width*height*4,"width":width,"height":height}},putImageDataWithTransform:function(){this.callCustom("putImageDataWithTransform",arguments)},set globalAlpha(value){this.setAttribute("globalAlpha",value)},set globalCompositeOperation(value){this.setAttribute("globalCompositeOperation",
value)},set fillStyle(value){this.setAttribute("fillStyle",value)},set strokeStyle(value){this.setAttribute("strokeStyle",value)},set lineCap(value){this.setAttribute("lineCap",value)},set lineJoin(value){this.setAttribute("lineJoin",value)},set lineWidth(value){this.setAttribute("lineWidth",value)},set miterLimit(value){this.setAttribute("miterLimit",value)}};goog.provide("trapeze.FauxConsole");
if(typeof window=="undefined"){function console(){}console.log=function(value){postMessage(["log",[value]])};console.warn=function(value){postMessage(["warn",[value]])};console.error=function(value){postMessage(["error",[value]])};console.time=function(value){postMessage(["time",[value]])};console.timeEnd=function(value){postMessage(["timeEnd",[value]])}}if(typeof window=="undefined")Image=function(){};goog.provide("trapeze.cos.COSObject");
trapeze.cos.COSObject=function(object,key,document){this._object=object;this._key=key;this._document=document};
trapeze.cos.COSObject.prototype={setObject:function(object){this._object=object},getObject:function(){if(this._object===null){this._document.loadObject(this._key);if(this._object===null)throw Exception("Error loading indirect object: "+obj.key.getKey());}return this._object},getKey:function(){return this._key},toString:function(depth){return"COSObject";depth=depth||0;if(this.object!=null)return"\t".repeat(depth)+"COSObject: \n"+this.object.toString(depth+1);else return"\t".repeat(depth)+"COSObject: null"}};
goog.provide("trapeze.cos.COSArray");goog.require("trapeze.cos.COSObject");trapeze.cos.COSArray=function(){this._objects=[]};
trapeze.cos.COSArray.prototype={add:function(object){this._objects.push(object)},remove:function(){return this._objects.pop()},get:function(index){return this._objects[index]},size:function(){return this._objects.length},getObject:function(index){var obj=this._objects[index];if(obj instanceof trapeze.cos.COSObject)obj=obj.getObject();return obj},getArray:function(){var size=this.size();var ret=new Array(size);for(var i=0;i<size;i++)ret[i]=this.getObject(i);return ret},toString:function(depth){return"COSArray";
depth=depth||0;if(depth>10)return"\t".repeat(depth)+"...";var retVal="\t".repeat(depth)+"COSArray: [\n";for(var i=0;i<this._objects.length;i++)retVal+=this._objects[i].toString(depth+1)+"\n";return retVal+"\t".repeat(depth)+"]"}};goog.provide("trapeze.cos.COSBoolean");trapeze.cos.COSBoolean=function(value){this.value=value};trapeze.cos.COSBoolean.prototype.toString=function(){return"COSBoolean: "+this.value};trapeze.cos.COSBoolean.TRUE=new trapeze.cos.COSBoolean(true);
trapeze.cos.COSBoolean.FALSE=new trapeze.cos.COSBoolean(false);goog.provide("trapeze.cos.COSDictionary");goog.require("trapeze.cos.COSObject");trapeze.cos.COSDictionary=function(items){if(typeof items!="undefined")this._items=items;else this._items={}};
trapeze.cos.COSDictionary.prototype={setItem:function(key,value){this._items[key.name]=value},getItem:function(key){return this._items[key]},getDictionaryObject:function(key){var retval=this._items[key];if(typeof retval=="undefined")return null;if(retval instanceof trapeze.cos.COSObject)return retval.getObject();return retval},getDictionaryObjectTwoKey:function(firstKey,secondKey){var retval=this.getDictionaryObject(firstKey);if(retval==null)retval=this.getDictionaryObject(secondKey);return retval},
addAll:function(dic){var dicKeys=dic.keyList();var dicLength=dicKeys.length;for(var i=0;i<dicLength;i++){var key=dicKeys[i];var value=dic.getItem(key);if(key!="Size"||this._items["Size"]==null)this.setItem({"name":key},value)}},putAll:function(dic){var dicKeys=dic.keyList();var dicLength=dicKeys.length;for(var i=0;i<dicLength;i++){var key=dicKeys[i];var value=dic.getItem(key);this.setItem({"name":key},value)}},keyList:function(){var ret=[];for(property in this._items)ret.push(property);return ret},
toString:function(depth){return"COSDictionary";depth=depth||0;if(depth>2)return"\t".repeat(depth)+"...";var retval="\t".repeat(depth)+"COSDictionary: \n";for(property in this._items)retval+="\t".repeat(depth)+"'"+property+"' => "+this._items[property].toString(depth+1).replace(/^\s+/,"")+"\n";return retval}};goog.provide("trapeze.cos.COSName");trapeze.cos.COSName=function(name){this.name=name};
trapeze.cos.COSName.prototype={toString:function(depth){depth=depth||0;return"\t".repeat(depth)+"COSName: "+this.name}};goog.provide("trapeze.cos.COSNull");trapeze.cos.COSNull=function(){};trapeze.cos.COSNull.NULL=new trapeze.cos.COSNull;goog.provide("trapeze.cos.COSNumber");trapeze.cos.COSNumber=function(value){this.value=parseFloat(value)};trapeze.cos.COSNumber.prototype={toString:function(depth){depth=depth||0;return"\t".repeat(depth)+"COSNumber: "+this.value}};goog.provide("trapeze.cos.COSObjectKey");
trapeze.cos.COSObjectKey=function(num,gen){if(typeof num=="string")this.number=parseInt(num);else this.number=num;if(typeof gen=="string")this.generation=parseInt(gen);else this.generation=gen};trapeze.cos.COSObjectKey.prototype={getKey:function(){return this.number+"-"+this.generation},toString:function(){return"COSObjectKey: "+this.getKey()}};goog.provide("trapeze.StreamBuffer");
trapeze.StreamBuffer=function(streamText,bigEndian,start,length){var bigEndian=bigEndian||true;var position=0;var limit=length||streamText.length;var buffer=streamText;var offset=start||0;this.getLimit=function(){return limit};this.getPosition=function(){return position};this.setPosition=function(newPosition){if(newPosition<0||newPosition>limit)console.warn("New stream posistion is invalid.");position=newPosition;return position};this.remaining=function(){return limit-position};this.hasRemaining=
function(){return position<limit};this.readNumber=function(iNumBytes,iFrom){iNumBytes=iNumBytes||1;iFrom=iFrom||position;this.setPosition(iFrom+iNumBytes);var result=0;for(var i=iFrom+iNumBytes;i>iFrom;i--)result=result*256+this.getByteAt(i-1);return result};this.subStream=function(start,length){var length=length||limit-start;if(length>limit-start)throw"Sub stream length is greater than it could be";return new trapeze.StreamBuffer(buffer,bigEndian,start+offset,length)};this.read=function(iNumChars){iNumChars=
iNumChars||1;if(iNumChars==1)return String.fromCharCode(buffer.charCodeAt(offset+position++)&255);else{var string=buffer.substr(offset+position,iNumChars);position+=iNumChars;return string}};this.readAt=function(pos,iNumChars){iNumChars=iNumChars||1;if(iNumChars==1)return String.fromCharCode(buffer.charCodeAt(offset+pos)&255);else{var string=buffer.substr(offset+pos,iNumChars);return string}};this.readLine=function(){var line="";while(true){var c=this.read();if(c=="\r"){var next=this.peek();if(next==
"\n")this.read();break}else if(c=="\n")break;line+=c}return line};this.peek=function(){var z=buffer;if(position>=limit)return-1;var c=this.read();this.setPosition(this.getPosition()-1);return c};this.rewindOne=function(){this.setPosition(this.getPosition()-1)};this.getByteAt=function(i){return buffer.charCodeAt(i+offset)&255};this.order=function(){return bigEndian};this.get=function(){var bite=this.getByteAt(position);position++;if(bite>127)return bite-256;else return bite};this.getAt=function(loc){var bite=
this.getByteAt(loc);if(bite>127)return bite-256;else return bite};this.getBulk=function(dst){var len=dst.length;for(var i=0;i<len;i++)dst[i]=this.get()};this.getChar=function(){var b1=this.get();var b0=this.get();return String.fromCharCode(b1<<8|b0&255)};this.getShort=function(){var iShort=bigEndian?(this.getByteAt(position)<<8)+this.getByteAt(position+1):(this.getByteAt(position+1)<<8)+this.getByteAt(position);position+=2;if(iShort>32767)return iShort-65536;else return iShort};this.getInt=function(){var iByte1=
this.getByteAt(position),iByte2=this.getByteAt(position+1),iByte3=this.getByteAt(position+2),iByte4=this.getByteAt(position+3);var iInt=bigEndian?(((iByte1<<8)+iByte2<<8)+iByte3<<8)+iByte4:(((iByte4<<8)+iByte3<<8)+iByte2<<8)+iByte1;position+=4;if(iInt>2147483647)return iInt-4294967296;else return iInt};this.getLong=function(){this.getInt();this.getInt();console.warn("getLong not implemented")};this.lastIndexOf=function(searchString){return streamText.lastIndexOf(searchString)};this.toByteArray=function(){var ret=
new Array(limit);for(var i=0;i<limit;i++)ret[i]=this.getAt(i);return ret};this.toString=function(){return"StreamBuffer: pos "+position+" lim "+limit}};trapeze.StreamBuffer.createFromUrl=function(fileURL){var req=new XMLHttpRequest;req.open("GET",fileURL,false);req.overrideMimeType("text/plain; charset=x-user-defined");req.send(null);if(req.status!=200)throwException(_exception.FileLoadFailed);var fileContents=req.responseText;var fileSize=fileContents.length;return new trapeze.StreamBuffer(fileContents)};
goog.provide("trapeze.colorspace.Color");trapeze.colorspace.Color=function(){};goog.provide("trapeze.colorspace.PDFColorSpace");trapeze.colorspace.PDFColorSpace=function(cs){this._cs=cs};trapeze.colorspace.PDFColorSpace.prototype.getPaint=function(components){var rgb=this._cs.toRGB(components);return rgb};trapeze.colorspace.PDFColorSpace.prototype.getNumComponents=function(){return this._cs.getNumComponents()};
trapeze.colorspace.PDFColorSpace.prototype.toString=function(){var name="PDFColorSpace";if(this._cs.toString)name+="{"+this._cs.toString()+"}";return name};trapeze.colorspace.PDFColorSpace.prototype.toRGB=function(components){return this._cs.toRGB(components)};trapeze.colorspace.PDFColorSpace.COLORSPACE_GRAY=0;trapeze.colorspace.PDFColorSpace.COLORSPACE_RGB=1;trapeze.colorspace.PDFColorSpace.COLORSPACE_CMYK=2;trapeze.colorspace.PDFColorSpace.COLORSPACE_PATTERN=3;
trapeze.colorspace.PDFColorSpace.CMYKtoRGB=function(c,m,y,k){var r=1-Math.min(1,c*(1-k)+k);var g=1-Math.min(1,m*(1-k)+k);var b=1-Math.min(1,y*(1-k)+k);r=Math.round(r*255);g=Math.round(g*255);b=Math.round(b*255);return[r,g,b]};goog.provide("trapeze.colorspace.AlternateColorSpace");goog.require("trapeze.colorspace.PDFColorSpace");
trapeze.colorspace.AlternateColorSpace=function(alternate,pdfFunction){trapeze.colorspace.AlternateColorSpace.baseConstructor.call(this,null);this.alternate=alternate;this.pdfFunction=pdfFunction;this._cs={toRGB:function(){return[0,0,0]}}};extend(trapeze.colorspace.AlternateColorSpace,trapeze.colorspace.PDFColorSpace);trapeze.colorspace.AlternateColorSpace.prototype.getNumComponents=function(){if(this.pdfFunction!=null)return this.pdfFunction.getNumInputs();else return this.alternate.getNumComponents()};
trapeze.colorspace.AlternateColorSpace.prototype.toString=function(){return"AlternateColorSpace"};goog.provide("trapeze.colorspace.ICC_ColorSpace");trapeze.colorspace.ICC_ColorSpace=function(){};trapeze.colorspace.ICC_ColorSpace.prototype.getNumComponents=function(){return 3};trapeze.colorspace.ICC_ColorSpace.prototype.toRGB=function(colorValue){return colorValue};trapeze.colorspace.ICC_ColorSpace.prototype.getPaint=function(colorValue){return colorValue};
trapeze.colorspace.ICC_ColorSpace.prototype.toString=function(colorValue){return"ICC_ColorSpace"};goog.provide("trapeze.cos.COSStream");goog.require("trapeze.filter.FilterManager");goog.require("trapeze.PDFStreamParser");goog.require("trapeze.PDFImage");goog.require("trapeze.cos.COSName");goog.require("trapeze.cos.COSArray");trapeze.cos.COSStream=function(dictionary,file){this.dictionary=dictionary;this.file=file};
trapeze.cos.COSStream.prototype={decode:function(){var value=this.dictionary.getItem("Filter");var filters=[];var params=[];if(value==null)filters.push("NoFilter");else if(value instanceof trapeze.cos.COSName){filters.push(value.name);params.push(this.dictionary.getDictionaryObject("DecodeParms"))}else if(value instanceof trapeze.cos.COSArray){var paramsArray=this.dictionary.getDictionaryObject("DecodeParms");for(var i=0;i<value.size();i++){filters.push(value.getObject(i).name);if(paramsArray!=null)params.push(paramsArray.getObject(i))}}else throw"Bad COS type for filter name";
var buf=this.file;for(var i=0;i<filters.length;i++){var filterName=filters[i];var filter=trapeze.filter.FilterManager.getFilter(filterName);buf=filter.decode(buf,params[i])}return buf},getStreamTokens:function(){var parser=new trapeze.PDFStreamParser(this);parser.parse();return parser.getTokens()},toString:function(depth){depth=depth||0;return"\t".repeat(depth)+"COSStream:"},getImageString:function(resources,graphics){if(this.cache==null){var filterType=this.dictionary.getDictionaryObject("Filter").name;
if(filterType=="DCTDecode")this.cache="data:image/jpeg;base64,"+base64.encode(this.file);else if(filterType=="FlateDecode"||filterType=="Fl")this.cache=trapeze.PDFImage.create(this,resources,graphics).getImageString();else{console.error("Uknown filter type for image '"+filterType+"'");this.cache=""}}return this.cache}};goog.provide("trapeze.cos.COSString");trapeze.cos.COSString=function COSString(value){this.value=value};
trapeze.cos.COSString.prototype={toString:function(depth){depth=depth||0;return"\t".repeat(depth)+"COSString: "+this.value}};
trapeze.cos.COSString.createFromHexString=function(hex){var retval="";var hexBuffer="";var len=hex.length;for(var i=0;i<len;i++){var c=hex.charAt(i);if(c>="0"&&c<="9"||c>="a"&&c<="f"||c>="A"&&c<="F")hexBuffer+=c}if(hexBuffer.length%2==1)hexBuffer+="0";for(var i=0;i<hexBuffer.length;){var hexChars=hexBuffer.charAt(i++)+hexBuffer.charAt(i++);retval+=String.fromCharCode(parseInt(hexChars,16))}var cosString=new trapeze.cos.COSString(retval);cosString.cameFromHEX=true;return cosString};goog.provide("trapeze.colorspace.IndexedColor");
goog.require("trapeze.colorspace.PDFColorSpace");goog.require("trapeze.StreamBuffer");goog.require("trapeze.cos.COSString");goog.require("trapeze.cos.COSStream");
trapeze.colorspace.IndexedColor=function(base,count,stream){trapeze.colorspace.IndexedColor.baseConstructor.call(this,null);this.finalcolors;this.table;this.count;this.nchannels=1;count++;this.count=count;var value;if(stream instanceof trapeze.cos.COSString)value=stream.value;else if(stream instanceof trapeze.cos.COSStream)value=stream.decode();else throw new UnimplementedException("Unknown type of indexed colorspace");var data=new trapeze.StreamBuffer(value);this.nchannels=base.getNumComponents();
var offSized=data.getLimit()/this.nchannels<count;this.finalcolors=new Array(3*count);this.table=new Array(count);var comps=new Array(this.nchannels);var loc=0;var finalloc=0;var temp=data.toByteArray();for(var i=0;i<count;i++){for(var j=0;j<comps.length;j++)if(loc<data.getLimit())comps[j]=(data.getByteAt(loc++)&255)/255;else comps[j]=1;this.table[i]=base.getPaint(comps);this.finalcolors[finalloc++]=this.table[i][0];this.finalcolors[finalloc++]=this.table[i][1];this.finalcolors[finalloc++]=this.table[i][2]}};
extend(trapeze.colorspace.IndexedColor,trapeze.colorspace.PDFColorSpace);trapeze.colorspace.IndexedColor.prototype.getNumComponents=function(){return 1};trapeze.colorspace.IndexedColor.prototype.getPaint=function(components){if(!this.table[components[0]])throw new ParseException("Unknown indexed color for index "+components[0]);return this.table[components[0]]};trapeze.colorspace.IndexedColor.prototype.toRGB=function(components){return this.getPaint(components)};
trapeze.colorspace.IndexedColor.prototype.toString=function(){return"IndexedColor"};goog.provide("trapeze.colorspace.PatternSpace");goog.require("trapeze.colorspace.PDFColorSpace");trapeze.colorspace.PatternSpace=function(base){trapeze.colorspace.PatternSpace.baseConstructor.call(this,null);this._base=null};extend(trapeze.colorspace.PatternSpace,trapeze.colorspace.PDFColorSpace);trapeze.colorspace.PatternSpace.prototype.getNumComponents=function(){if(this._base==null)return 0;return this._base.getNumComponents()};
trapeze.colorspace.PatternSpace.prototype.getPaint=function(patternObj,components,resources){var basePaint=null;if(this._base!=null)basePaint=this._base.getPaint(components);debugger;zip.func();var pattern=patternObj.getCache();if(pattern==null){pattern=PDFPattern.getPattern(patternObj,resources);patternObj.setCache(pattern)}return pattern.getPaint(basePaint)};trapeze.colorspace.PatternSpace.prototype.toRGB=function(components){return this.getPaint(components)};
trapeze.colorspace.PatternSpace.prototype.toString=function(){return"PatternSpace"};goog.provide("trapeze.pdffunction.PDFFunction");goog.require("trapeze.pdffunction.FunctionType0");trapeze.pdffunction.PDFFunction=function(){};trapeze.pdffunction.PDFFunction.TYPE_0=0;trapeze.pdffunction.PDFFunction.TYPE_2=2;trapeze.pdffunction.PDFFunction.TYPE_3=3;trapeze.pdffunction.PDFFunction.TYPE_4=4;
trapeze.pdffunction.PDFFunction.getFunction=function(obj){var pdfFunction;var type;var domain=null;var range=null;var dictObj=obj.dictionary;var typeObj=dictObj.getDictionaryObject("FunctionType");if(typeObj==null)throw new PDFParseException("No FunctionType specified in function!");type=typeObj.value;var domainObj=dictObj.getDictionaryObject("Domain");if(domainObj==null)throw new PDFParseException("No Domain specified in function!");var domainAry=domainObj;var domainArySize=domainObj.size();domain=
new Array(domainArySize);for(var i=0;i<domainArySize;i++)domain[i]=domainAry.getObject(i).value;var rangeObj=dictObj.getDictionaryObject("Range");if(rangeObj!=null){var rangeAry=rangeObj;var rangeArySize=rangeObj.size();range=new Array(rangeArySize);for(var i=0;i<rangeArySize;i++)range[i]=rangeAry.getObject(i).value}switch(type){case trapeze.pdffunction.PDFFunction.TYPE_0:if(rangeObj==null)throw new PDFParseException("No Range specified in Type 0 Function!");pdfFunction=new trapeze.pdffunction.FunctionType0;
break;case trapeze.pdffunction.PDFFunction.TYPE_2:pdfFunction=new FunctionType2;break;case trapeze.pdffunction.PDFFunction.TYPE_3:pdfFunction=new FunctionType3;break;case trapeze.pdffunction.PDFFunction.TYPE_4:if(rangeObj==null)throw new PDFParseException("No Range specified in Type 4 Function!");pdfFunction=new FunctionType4;break;default:throw new PDFParseException("Unsupported function type: "+type);}pdfFunction.setDomain(domain);if(range!=null)pdfFunction.setRange(range);pdfFunction.parse(obj);
return pdfFunction};trapeze.pdffunction.PDFFunction.prototype.getNumInputs=function(){return this.domain.length/2};trapeze.pdffunction.PDFFunction.prototype.getNumOutputs=function(){if(this.range==null)return 0;return this.range.length/2};trapeze.pdffunction.PDFFunction.prototype.setDomain=function(domain){this.domain=domain};trapeze.pdffunction.PDFFunction.prototype.setRange=function(range){this.range=range};goog.provide("trapeze.pdffunction.FunctionType0");goog.require("trapeze.pdffunction.PDFFunction");
goog.require("trapeze.StreamBuffer");trapeze.pdffunction.FunctionType0=function(){trapeze.pdffunction.FunctionType0.baseConstructor.call(this,trapeze.pdffunction.PDFFunction.TYPE0)};extend(trapeze.pdffunction.FunctionType0,trapeze.pdffunction.PDFFunction);
trapeze.pdffunction.FunctionType0.prototype.parse=function(obj){var dictObj=obj.dictionary;var sizeObj=dictObj.getDictionaryObject("Size");if(sizeObj==null)throw new PDFParseException("Size required for function type 0!");var sizeAry=sizeObj.getArray();var size=new Array(sizeAry.length);for(var i=0;i<sizeAry.length;i++)size[i]=sizeAry[i].value;this.setSize(size);var bpsObj=dictObj.getDictionaryObject("BitsPerSample");if(bpsObj==null)throw new PDFParseException("BitsPerSample required for function type 0!");
this.setBitsPerSample(bpsObj.value);var orderObj=dictObj.getDictionaryObject("Order");if(orderObj!=null)this.setOrder(orderObj.value);var encodeObj=dictObj.getDictionaryObject("Encode");if(encodeObj!=null){var encodeAry=encodeObj.getArray();var encode=new Array(encodeAry.length);for(var i=0;i<encodeAry.length;i++)encode[i]=encodeAry[i].value;this.setEncode(encode)}var decodeObj=dictObj.getDictionaryObject("Decode");if(decodeObj!=null){var decodeAry=decodeObj.getArray();var decode=new Array(decodeAry.length);
for(var i=0;i<decodeAry.length;i++)decode[i]=decodeAry[i].value;this.setDecode(decode)}this.setSamples(this.readSamples(new trapeze.StreamBuffer(obj.decode())))};trapeze.pdffunction.FunctionType0.prototype.setSize=function(size){this.size=size};trapeze.pdffunction.FunctionType0.prototype.getSize=function(dimension){return this.size[dimension]};trapeze.pdffunction.FunctionType0.prototype.getBitsPerSample=function(){return this.bitsPerSample};
trapeze.pdffunction.FunctionType0.prototype.setBitsPerSample=function(bits){this.bitsPerSample=bits};trapeze.pdffunction.FunctionType0.prototype.setOrder=function(order){this.order=order};trapeze.pdffunction.FunctionType0.prototype.setEncode=function(encode){this.encode=encode};trapeze.pdffunction.FunctionType0.prototype.setDecode=function(decode){this.decode=decode};trapeze.pdffunction.FunctionType0.prototype.setSamples=function(samples){this.samples=samples};
trapeze.pdffunction.FunctionType0.prototype.readSamples=function(buf){var size=1;for(var i=0;i<this.getNumInputs();i++)size*=this.getSize(i);var samples=new Array(size);var outputs=this.getNumOutputs();for(var i=0;i<size;i++)samples[i]=new Array(outputs);var bitLoc=0;var byteLoc=0;var index=0;for(var i=0;i<this.getNumInputs();i++)for(var j=0;j<this.getSize(i);j++){for(var k=0;k<this.getNumOutputs();k++){var value=0;var toRead=this.getBitsPerSample();var curByte=buf.getAt(byteLoc);while(toRead>0){var nextBit=
curByte>>7-bitLoc&1;value|=nextBit<<toRead-1;if(++bitLoc==8){bitLoc=0;byteLoc++;if(toRead>1)curByte=buf.getAt(byteLoc)}toRead--}samples[index][k]=value}index++}return samples};goog.provide("trapeze.colorspace.ColorSpaceManager");goog.require("trapeze.colorspace.PatternSpace");goog.require("trapeze.colorspace.IndexedColor");goog.require("trapeze.colorspace.ICC_ColorSpace");goog.require("trapeze.colorspace.AlternateColorSpace");goog.require("trapeze.pdffunction.PDFFunction");goog.require("trapeze.StreamBuffer");
goog.require("trapeze.cos.COSName");
trapeze.colorspace.ColorSpaceManager.getColorSpaceByName=function(name){if(!trapeze.colorspace.ColorSpaceManager.staticColorSpacesInitialized){trapeze.colorspace.ColorSpaceManager.patternSpace=new trapeze.colorspace.PatternSpace;trapeze.colorspace.ColorSpaceManager.rgbSpace=new trapeze.colorspace.PDFColorSpace({toRGB:function(components){return this.getPaint(components)},getNumComponents:function(){return 3},getPaint:function(components){var r=Math.round(components[0]*255);var g=Math.round(components[1]*
255);var b=Math.round(components[2]*255);return[r,g,b]},toString:function(){return"PDFColorSpace.rgbSpace"}});trapeze.colorspace.ColorSpaceManager.cmykSpace=new trapeze.colorspace.PDFColorSpace({toRGB:function(components){return this.getPaint(components)},getNumComponents:function(){return 4},getPaint:function(components){return trapeze.colorspace.PDFColorSpace.CMYKtoRGB(components[0],components[1],components[2],components[3])},toString:function(){return"PDFColorSpace.cmykSpace"}})}switch(name){case trapeze.colorspace.PDFColorSpace.COLORSPACE_GRAY:return trapeze.colorspace.ColorSpaceManager.graySpace;
case trapeze.colorspace.PDFColorSpace.COLORSPACE_RGB:return trapeze.colorspace.ColorSpaceManager.rgbSpace;case trapeze.colorspace.PDFColorSpace.COLORSPACE_CMYK:return trapeze.colorspace.ColorSpaceManager.cmykSpace;case trapeze.colorspace.PDFColorSpace.COLORSPACE_PATTERN:return trapeze.colorspace.ColorSpaceManager.patternSpace;default:throw new IllegalArgumentException("Unknown Color Space name: "+name);}};trapeze.colorspace.ColorSpaceManager.staticColorSpacesInitialized=false;
trapeze.colorspace.ColorSpaceManager.getColorSpace=function(csobj,resources){var name;if(csobj instanceof trapeze.cos.COSName){name=csobj.name;var colorSpaces;if(resources!=null)colorSpaces=resources.resources.getDictionaryObject("ColorSpace");if(name=="DeviceGray"||name=="G")return trapeze.colorspace.ColorSpaceManager.getColorSpaceByName(trapeze.colorspace.PDFColorSpace.COLORSPACE_GRAY);else if(name=="DeviceRGB"||name=="RGB")return trapeze.colorspace.ColorSpaceManager.getColorSpaceByName(trapeze.colorspace.PDFColorSpace.COLORSPACE_RGB);
else if(name=="DeviceCMYK"||name=="CMYK")return trapeze.colorspace.ColorSpaceManager.getColorSpaceByName(trapeze.colorspace.PDFColorSpace.COLORSPACE_CMYK);else if(name=="Pattern")return trapeze.colorspace.ColorSpaceManager.getColorSpaceByName(trapeze.colorspace.PDFColorSpace.COLORSPACE_PATTERN);else if(colorSpaces!=null)csobj=colorSpaces.getDictionaryObject(name)}var value=null;var ary=csobj;name=csobj.getObject(0).name;if(name=="CalGray")value=new trapeze.colorspace.PDFColorSpace(new CalGrayColor(ary.getObject(1)));
else if(name=="CalRGB")value=new trapeze.colorspace.PDFColorSpace(new CalRGBColor(ary.getObject(1)));else if(name=="Lab")value=new trapeze.colorspace.PDFColorSpace(new LabColor(ary.getObject(1)));else if(name=="ICCBased"){var streamContents=ary.getObject(1).decode();var stream=new trapeze.StreamBuffer(streamContents);value=new trapeze.colorspace.PDFColorSpace(new trapeze.colorspace.ICC_ColorSpace(stream))}else if(name=="Separation"||name=="DeviceN"){console.warn("Colorspace seperation and DevinceN are not implemented fullly");
var alternate=trapeze.colorspace.ColorSpaceManager.getColorSpace(ary.getObject(2),resources);var func=trapeze.pdffunction.PDFFunction.getFunction(ary.getObject(3));value=new trapeze.colorspace.AlternateColorSpace(alternate,func)}else if(name=="Indexed"||name=="I"){var refspace=trapeze.colorspace.ColorSpaceManager.getColorSpace(ary.getObject(1),resources);var count=ary.getObject(2).value;value=new trapeze.colorspace.IndexedColor(refspace,count,ary.getObject(3))}else if(name=="Pattern"){console.warn("Colorspace Pattern is not implemented fullly");
if(ary.size()==1)return trapeze.colorspace.ColorSpaceManager.getColorSpaceByName(trapeze.colorspace.PDFColorSpace.COLORSPACE_PATTERN);var base=getColorSpace(ary.getObject(1),resources);return new trapeze.colorspace.PatternSpace(base)}else throw new PDFParseException("Unknown color space: "+name+" with "+ary[1]);return value;throw new UnimplementedException("Only support names color spaces");};goog.provide("trapeze.PDFImage");goog.require("trapeze.colorspace.ColorSpaceManager");goog.require("trapeze.colorspace.IndexedColor");
goog.require("trapeze.colorspace.Color");goog.require("trapeze.StreamBuffer");trapeze.PDFImage=function(){this.width;this.height;this.bpc;this.colorSpace};
trapeze.PDFImage.prototype.getImageString=function(){var oData=this.imageData;var aHeader=[];var iWidth=oData.width;var iHeight=oData.height;aHeader.push(66);aHeader.push(77);var iFileSize=iWidth*iHeight*3+54;aHeader.push(iFileSize%256);iFileSize=Math.floor(iFileSize/256);aHeader.push(iFileSize%256);iFileSize=Math.floor(iFileSize/256);aHeader.push(iFileSize%256);iFileSize=Math.floor(iFileSize/256);aHeader.push(iFileSize%256);aHeader.push(0);aHeader.push(0);aHeader.push(0);aHeader.push(0);aHeader.push(54);
aHeader.push(0);aHeader.push(0);aHeader.push(0);var aInfoHeader=[];aInfoHeader.push(40);aInfoHeader.push(0);aInfoHeader.push(0);aInfoHeader.push(0);var iImageWidth=iWidth;aInfoHeader.push(iImageWidth%256);iImageWidth=Math.floor(iImageWidth/256);aInfoHeader.push(iImageWidth%256);iImageWidth=Math.floor(iImageWidth/256);aInfoHeader.push(iImageWidth%256);iImageWidth=Math.floor(iImageWidth/256);aInfoHeader.push(iImageWidth%256);var iImageHeight=iHeight;aInfoHeader.push(iImageHeight%256);iImageHeight=Math.floor(iImageHeight/
256);aInfoHeader.push(iImageHeight%256);iImageHeight=Math.floor(iImageHeight/256);aInfoHeader.push(iImageHeight%256);iImageHeight=Math.floor(iImageHeight/256);aInfoHeader.push(iImageHeight%256);aInfoHeader.push(1);aInfoHeader.push(0);aInfoHeader.push(24);aInfoHeader.push(0);aInfoHeader.push(0);aInfoHeader.push(0);aInfoHeader.push(0);aInfoHeader.push(0);var iDataSize=iWidth*iHeight*3;aInfoHeader.push(iDataSize%256);iDataSize=Math.floor(iDataSize/256);aInfoHeader.push(iDataSize%256);iDataSize=Math.floor(iDataSize/
256);aInfoHeader.push(iDataSize%256);iDataSize=Math.floor(iDataSize/256);aInfoHeader.push(iDataSize%256);for(var i=0;i<16;i++)aInfoHeader.push(0);var iPadding=(4-iWidth*3%4)%4;var aImgData=oData.data;var strPixelData="";var y=iHeight;do{var iOffsetY=iWidth*(y-1)*4;var strPixelRow="";for(var x=0;x<iWidth;x++){var iOffsetX=4*x;strPixelRow+=String.fromCharCode(aImgData[iOffsetY+iOffsetX+2]);strPixelRow+=String.fromCharCode(aImgData[iOffsetY+iOffsetX+1]);strPixelRow+=String.fromCharCode(aImgData[iOffsetY+
iOffsetX])}for(var c=0;c<iPadding;c++)strPixelRow+=String.fromCharCode(0);strPixelData+=strPixelRow}while(--y);var encodeData=function(data){var strData="";if(typeof data=="string")strData=data;else{var aData=data;for(var i=0;i<aData.length;i++)strData+=String.fromCharCode(aData[i])}return base64.encode(strData)};var strEncoded=encodeData(aHeader.concat(aInfoHeader))+encodeData(strPixelData);return"data:"+"image/bmp"+";base64,"+strEncoded};
trapeze.PDFImage.create=function(obj,resources,context){var image=new trapeze.PDFImage;var dictionary=obj.dictionary;var widthObj=dictionary.getDictionaryObject("Width");if(widthObj==null)throw new ParseException("Unable to read image width: "+obj);image.width=widthObj.value;var heightObj=dictionary.getDictionaryObject("Height");if(heightObj==null)throw new ParseException("Unable to get image height: "+obj);image.height=heightObj.value;var bpcObj=dictionary.getDictionaryObject("BitsPerComponent");
if(bpcObj==null)throw new ParseException("Unable to get bits per component: "+obj);image.bpc=bpcObj.value;var csObj=dictionary.getDictionaryObject("ColorSpace");if(csObj==null)throw new ParseException("No ColorSpace for image: "+obj);var cs=trapeze.colorspace.ColorSpaceManager.getColorSpace(csObj,resources);image.colorSpace=cs;var imageData=context.createImageData(image.width,image.height);var pix=imageData.data;var data=new trapeze.StreamBuffer(obj.decode());function ChunkReader(buffer){this.bytestream=
buffer;this.offset=0;this.readBit=function(){var b=this.bytestream.getByteAt(this.offset>>>3);var tmp=b>>(this.offset&7);this.offset++;return tmp&1};this.read=function(numBits){var val=0;for(var i=0;i<numBits;++i)val|=this.readBit()<<i;return val}}data=new ChunkReader(data);var numComponents=image.colorSpace.getNumComponents();var n=pix.length;for(var i=0;i<n;i+=4){var components=new Array(numComponents);for(var j=0;j<numComponents;j++)if(cs instanceof trapeze.colorspace.IndexedColor)components[j]=
data.read(image.bpc);else components[j]=data.read(image.bpc)/255;var rgb=image.colorSpace.toRGB(components);pix[i]=rgb[0];pix[i+1]=rgb[1];pix[i+2]=rgb[2];pix[i+3]=255}image.imageData=imageData;return image};goog.provide("trapeze.BaseParser");goog.require("trapeze.cos.COSArray");goog.require("trapeze.cos.COSString");goog.require("trapeze.cos.COSBoolean");goog.require("trapeze.cos.COSDictionary");goog.require("trapeze.cos.COSName");goog.require("trapeze.cos.COSNull");goog.require("trapeze.cos.COSNumber");
goog.require("trapeze.cos.COSObject");goog.require("trapeze.cos.COSObjectKey");goog.require("trapeze.cos.COSStream");trapeze.BaseParser=function(){};trapeze.BaseParser.prototype.parseCOSStream=function(dictionary){this.stream.readLine();var length=dictionary.getDictionaryObject("Length").value;var streamText="";var start=this.stream.getPosition();var offset=start+length;for(var i=start;i<offset;i++)streamText+=this.stream.read();var cosStream=new trapeze.cos.COSStream(dictionary,streamText);return cosStream};
trapeze.BaseParser.prototype.parseCOSDictionary=function(){var c=this.stream.read();if(c!="<")throw"Expecting '<'";var c=this.stream.read();if(c!="<")throw"Expecting '<'";this.skipSpaces();var obj=new trapeze.cos.COSDictionary;var done=false;while(!done){this.skipSpaces();c=this.stream.read();if(c==">")done=true;else if(c!="/")console.warn("invalid dicitonary expected '/' found '"+c+"'");else{var key=this.parseCOSName();var value=this.parseCOSDictionaryValue();this.skipSpaces();if(value==null)console.warn("Bad Dictionary Declaration. Key: "+
key.name);else obj.setItem(key,value)}}var ch=this.stream.read();if(ch!=">")throw new IOException("expected='>' actual='"+ch+"'");return obj};
trapeze.BaseParser.prototype.parseCOSDictionaryValue=function(){var retval=null;var number=this.parseDirObject();this.skipSpaces();var next=this.stream.peek();if(next>="0"&&next<="9"){var generationNumber=this.parseDirObject();this.skipSpaces();var r=this.stream.read();if(r!="R")throw"Expected='R' actual='"+r+"'";var key=new trapeze.cos.COSObjectKey(number.value,generationNumber.value);retval=this.document.getObjectFromPool(key)}else retval=number;return retval};
trapeze.BaseParser.prototype.parseCOSArray=function(){var po=new trapeze.cos.COSArray;var pbo=null;this.skipSpaces();var i=this.stream.peek();while(i!="]"&&this.stream.hasRemaining()){pbo=this.parseDirObject();if(pbo instanceof trapeze.cos.COSObject)if(po.get(po.size()-1)instanceof trapeze.cos.COSNumber){var genNumber=po.remove();if(po.get(po.size()-1)instanceof trapeze.cos.COSNumber){var number=po.remove();var key=new trapeze.cos.COSObjectKey(number.value,genNumber.value);pbo=this.document.getObjectFromPool(key)}else pbo=
null}else pbo=null;if(pbo!=null)po.add(pbo);else console.warn("Corrupt object reference");this.skipSpaces();i=this.stream.peek()}this.stream.read();this.skipSpaces();return po};trapeze.BaseParser.prototype.parseCOSName=function(){var c;var sb="";while(this.stream.getPosition()<this.stream.getLimit()&&this.isRegularCharacter(c=this.stream.read()))sb+=c;this.stream.rewindOne();return new trapeze.cos.COSName(sb)};
trapeze.BaseParser.prototype.parseCOSNumber=function(){var c=this.stream.read();var neg=c=="-";var sawdot=c==".";var dotmult=sawdot?0.1:1;var value=c>="0"&&c<="9"?c-"0":0;while(true){c=this.stream.read();if(c=="."){if(sawdot){this.stream.setPosition(this.stream.getPosition()-1);break}sawdot=true;dotmult=0.1}else if(c>="0"&&c<="9"){var val=c-"0";if(sawdot){value+=val*dotmult;dotmult*=0.1}else value=value*10+val}else{this.stream.setPosition(this.stream.getPosition()-1);break}}if(neg)value=-value;return new trapeze.cos.COSNumber(value)};
trapeze.BaseParser.prototype.parseCOSString=function(){var parenLevel=0;var sb="";var openBrace=this.stream.read();var closeBrace;if(openBrace=="(")closeBrace=")";else closeBrace=">";while(this.stream.getPosition()<this.stream.getLimit()){var c=this.stream.read();if(c==closeBrace){if(parenLevel--==0)break}else if(c==openBrace)parenLevel++;else if(c=="\\"){c=this.stream.read();if(c>="0"&&c<="9"){var count=0;var val=0;var zero="0".charCodeAt(0);while(c>="0"&&c<="9"&&count<3){val=val*8+c.charCodeAt(0)-
zero;c=this.stream.read();count++}this.stream.rewindOne();c=String.fromCharCode(val)}else if(c=="n")c="\n";else if(c=="r")c="\r";else if(c=="t")c="\t";else if(c=="b")c="\u0008";else if(c=="f")c="\u000c";else if(c=="\\")c="\\";else if(c=="(")c="(";else if(c==")")c=")";else if(c=="<")c="<";else if(c==">")c=">"}sb+=c}if(openBrace=="<")return trapeze.cos.COSString.createFromHexString(sb);else return new trapeze.cos.COSString(sb)};
trapeze.BaseParser.prototype.skipSpaces=function(){if(!this.stream.hasRemaining())return;var c=this.stream.read();while(this.isWhiteSpace(c)||c=="%")if(c=="%"){var comment="";while(this.stream.hasRemaining()&&c!="\n"){comment+=c;c=this.stream.read()}if(this.stream.hasRemaining()){c=this.stream.read();if(c=="\r")c=this.stream.read()}}else{if(!this.stream.hasRemaining())return;c=this.stream.read()}this.stream.rewindOne()};
trapeze.BaseParser.prototype.readNum=function(){var c=this.stream.read();var neg=c=="-";var sawdot=c==".";var dotmult=sawdot?0.1:1;var value=c>="0"&&c<="9"?c-"0":0;while(true){c=this.stream.read();if(c=="."){if(sawdot){this.stream.setPosition(this.stream.getPosition()-1);break}sawdot=true;dotmult=0.1}else if(c>="0"&&c<="9"){var val=c-"0";if(sawdot){value+=val*dotmult;dotmult*=0.1}else value=value*10+val}else{this.stream.setPosition(this.stream.getPosition()-1);break}}if(neg)value=-value;return value};
trapeze.BaseParser.prototype.isWhiteSpace=function(c){switch(c){case " ":case "\n":case "\r":case "\0":case "\t":case "\u000c":return true;default:return false}};trapeze.BaseParser.prototype.readString=function(){this.skipSpaces();var c;var sb="";while(this.stream.getPosition()<this.stream.getLimit()&&this.isRegularCharacter(c=this.stream.read()))sb+=c;if(this.stream.getPosition()<this.stream.getLimit())this.stream.rewindOne();return sb};
trapeze.BaseParser.prototype.parseDirObject=function(){this.skipSpaces();var c=this.stream.read();var peek=this.stream.peek();if(c=="[")return this.parseCOSArray();else if(c=="("){this.stream.rewindOne();return this.parseCOSString()}else if(c=="<"&&peek=="<"){this.stream.rewindOne();return this.parseCOSDictionary()}else if(c=="<"){this.stream.rewindOne();return this.parseCOSString()}else if(c=="/")return this.parseCOSName();else if(c=="R")return new trapeze.cos.COSObject(null);else if(c=="."||c==
"-"||c>="0"&&c<="9"){this.stream.rewindOne();return this.parseCOSNumber()}else if(c=="n"){var st=this.readString();if(st!="ull")throw"Expecting null string found "+st;return trapeze.cos.COSNull.NULL}else if(c=="t"){var st=this.readString();if(st!="rue")throw"Expecting null string found "+st;return trapeze.cos.COSBoolean.TRUE}else if(c=="f"){var st=this.readString();if(st!="alse")throw"Expecting null string found "+st;return trapeze.cos.COSBoolean.FALSE}return null;var d=c+this.stream.read(5);console.warn(d);
throw"Unable to parse object. Found token: "+d;};trapeze.BaseParser.prototype.isRegularCharacter=function(c){return!(this.isWhiteSpace(c)||this.isDelimiter(c))};trapeze.BaseParser.prototype.isDelimiter=function(c){switch(c){case "(":case ")":case "<":case ">":case "[":case "]":case "{":case "}":case "/":case "%":return true;default:return false}};
trapeze.BaseParser.prototype.isEndOfName=function(ch){return ch==" "||ch=="\r"||ch=="\n"||ch=="\t"||ch==">"||ch=="<"||ch=="["||ch=="/"||ch=="]"||ch==")"||ch=="("||ch==-1};trapeze.BaseParser.isWhiteSpace=function(c){switch(c){case " ":case "\n":case "\r":case "\0":case "\t":case "\u000c":return true;default:return false}};goog.provide("trapeze.PDFOperator");trapeze.PDFOperator=function(operator){this.operator=operator};trapeze.PDFOperator.getOperator=function(operator){return new trapeze.PDFOperator(operator)};
goog.provide("trapeze.PDFStreamParser");goog.require("trapeze.BaseParser");goog.require("trapeze.StreamBuffer");goog.require("trapeze.PDFOperator");goog.require("trapeze.cos.COSBoolean");goog.require("trapeze.cos.COSDictionary");goog.require("trapeze.cos.COSNull");goog.require("trapeze.cos.COSNumber");goog.require("trapeze.cos.COSStream");trapeze.PDFStreamParser=function(stream){var streamText=stream.decode();this.stream=new trapeze.StreamBuffer(streamText);this.streamObjects=[]};
extend(trapeze.PDFStreamParser,trapeze.BaseParser);trapeze.PDFStreamParser.prototype.parse=function(){var token=null;while((token=this.parseNextToken())!=null)this.streamObjects.push(token)};trapeze.PDFStreamParser.prototype.getTokens=function(){return this.streamObjects};
trapeze.PDFStreamParser.prototype.parseNextToken=function(){var retval=null;if(this.stream.getPosition()>=this.stream.getLimit())return null;this.skipSpaces();var nextByte=this.stream.peek();if(nextByte==-1)return null;var c=nextByte;switch(c){case "<":var leftBracket=this.stream.read();c=this.stream.peek();this.stream.rewindOne();if(c=="<"){var pod=this.parseCOSDictionary();this.skipSpaces();if(this.stream.peek()=="s")retval=this.parseCOSStream(pod,file);else retval=pod}else retval=this.parseCOSString();
break;case "[":this.stream.read();retval=this.parseCOSArray();break;case "(":retval=this.parseCOSString();break;case "/":this.stream.read();retval=this.parseCOSName();break;case "n":var nullString=this.readString();if(nullString=="null")retval=trapeze.cos.COSNull.NULL;else retval=trapeze.PDFOperator.getOperator(nullString);break;case "t":case "f":var next=this.readString();if(next=="true"){retval=trapeze.cos.COSBoolean.TRUE;break}else if(next=="false")retval=trapeze.cos.COSBoolean.FALSE;else retval=
trapeze.PDFOperator.getOperator(next);break;case "R":var line=this.readString();if(line=="R")retval=new trapeze.cos.COSObject(null);else retval=trapeze.PDFOperator.getOperator(line);break;case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":case "-":case "+":case ".":var buf="";buf+=c;this.stream.read();var dotNotRead=c!=".";while(isDigit(c=this.stream.peek())||dotNotRead&&c=="."){buf+=c;this.stream.read();if(dotNotRead&&c==".")dotNotRead=false}retval=new trapeze.cos.COSNumber(buf);
break;case "B":var next=this.readString();retval=trapeze.PDFOperator.getOperator(next);if(next=="BI"){var image=this.parseInlineImage();retval=image}break;case "]":this.stream.read();retval=trapeze.cos.COSNull.NULL;break;default:var operator=this.readOperator();if(operator.length==0)retval=null;else retval=trapeze.PDFOperator.getOperator(operator)}return retval};
trapeze.PDFStreamParser.prototype.parseInlineImage=function(){var hm={};while(true){var t=this.parseNextToken();if(t instanceof trapeze.PDFOperator&&t.operator=="ID")break;var name=t.name;if(name=="BPC")name="BitsPerComponent";else if(name=="CS")name="ColorSpace";else if(name=="D")name="Decode";else if(name=="DP")name="DecodeParms";else if(name=="F")name="Filter";else if(name=="H")name="Height";else if(name=="IM")name="ImageMask";else if(name=="W")name="Width";else if(name=="I")name="Interpolate";
var vobj=this.parseNextToken();hm[name]=vobj}var loc=this.stream.getPosition();if(this.stream.readAt(loc)=="\r")loc++;if(this.stream.readAt(loc)=="\n"||this.stream.readAt(loc)==" ")loc++;var imObj=hm["ImageMask"];if(imObj!=null&&imObj==trapeze.cos.COSBoolean.TRUE){var decode=[0,1];var decodeObj=hm.get["Decode"];if(decodeObj!=null){decode[0]=decodeObj.getObject(0).value;decode[1]=decodeObj.getObject(1).value}hm["Decode"]=decode}var dstart=loc;while(!this.isWhiteSpace(this.stream.readAt(loc))||this.stream.readAt(loc+
1)!="E"||this.stream.readAt(loc+2)!="I")loc++;var streamText="";for(var i=dstart;i<loc;i++)streamText+=this.stream.readAt(i);var obj=new trapeze.cos.COSStream(new trapeze.cos.COSDictionary(hm),streamText);loc+=1;this.stream.setPosition(loc);return obj};trapeze.PDFStreamParser.prototype.readOperator=function(){this.skipSpaces();var buffer="";var c=this.stream.peek();while(c!=-1&&!this.isWhiteSpace(c)&&c!="]"&&c!="["&&c!="<"&&c!="("&&c!="/"&&(c<"0"||c>"9")){buffer+=this.stream.read();c=this.stream.peek()}return buffer};
goog.provide("trapeze.filter.ASCII85Filter");goog.require("trapeze.StreamBuffer");goog.require("trapeze.BaseParser");
trapeze.filter.ASCII85Filter=function(){var buf=null;function nextChar(){while(buf.remaining()>0){var c=buf.get();if(!trapeze.BaseParser.isWhiteSpace(String.fromCharCode(c)))return c}return-1}var TILDY="~".charCodeAt(0);var GT=">".charCodeAt(0);var EX="!".charCodeAt(0);var Z="z".charCodeAt(0);var U="u".charCodeAt(0);this.decode5=function(baos){var five=new Array(5);var i;for(i=0;i<5;i++){five[i]=nextChar();if(five[i]==TILDY)if(nextChar()==GT)break;else throw new PDFParseException("Bad character in ASCII85Decode: not ~>");
else if(five[i]>=EX&&five[i]<=U)five[i]-=EX;else if(five[i]==Z)if(i==0){five[i]=0;i=4}else throw new PDFParseException("Inappropriate 'z' in ASCII85Decode");else throw new PDFParseException("Bad character in ASCII85Decode: "+five[i]+" ("+five[i]+")");}if(i>0)i-=1;var value=five[0]*85*85*85*85+five[1]*85*85*85+five[2]*85*85+five[3]*85+five[4];for(var j=0;j<i;j++){var shift=8*(3-j);baos.write(value>>shift&255)}return i==4};this.decode=function(stream){buf=new trapeze.StreamBuffer(stream);var baos={output:[],
write:function(b){this.output.push(b)}};while(this.decode5(baos));return String.fromCharCode.apply(this,baos.output)}};goog.provide("trapeze.filter.Predictor");goog.require("trapeze.filter.PNGPredictor");trapeze.filter.Predictor=function(){this._algorithm;this._colors=1;this._bpc=8;this._columns=1};trapeze.filter.Predictor.prototype.getAlgorithm=function(){return this._algorithm};trapeze.filter.Predictor.prototype.getColors=function(){return this._colors};
trapeze.filter.Predictor.prototype.setColors=function(colors){this._colors=colors};trapeze.filter.Predictor.prototype.getBitsPerComponent=function(){return this._bpc};trapeze.filter.Predictor.prototype.setBitsPerComponent=function(bpc){this._bpc=bpc};trapeze.filter.Predictor.prototype.getColumns=function(){return this._columns};trapeze.filter.Predictor.prototype.setColumns=function(columns){this._columns=columns};
trapeze.filter.Predictor.getPredictor=function(params){var algorithmObj=params.getDictionaryObject("Predictor");if(algorithmObj==null)return null;var algorithm=algorithmObj.value;var predictor=null;switch(algorithm){case 1:return null;case 2:throw new UnimplementedException("Tiff Predictor not supported");case 10:case 11:case 12:case 13:case 14:case 15:predictor=new trapeze.filter.PNGPredictor;break;default:throw new PDFParseException("Unknown predictor: "+algorithm);}var colorsObj=params.getDictionaryObject("Colors");
if(colorsObj!=null)predictor.setColors(colorsObj.value);var bpcObj=params.getDictionaryObject("BitsPerComponent");if(bpcObj!=null)predictor.setBitsPerComponent(bpcObj.value);var columnsObj=params.getDictionaryObject("Columns");if(columnsObj!=null)predictor.setColumns(columnsObj.value);return predictor};goog.provide("trapeze.filter.PNGPredictor");goog.require("trapeze.filter.Predictor");goog.require("trapeze.StreamBuffer");trapeze.filter.PNGPredictor=function(){trapeze.filter.PNGPredictor.baseConstructor.call(this)};
extend(trapeze.filter.PNGPredictor,trapeze.filter.Predictor);
trapeze.filter.PNGPredictor.prototype.unpredict=function(imageData){var rows=[];var curLine=null;var prevLine=null;imageData=new trapeze.StreamBuffer(imageData);var rowSize=this.getColumns()*this.getColors()*this.getBitsPerComponent();rowSize=Math.ceil(rowSize/8);while(imageData.remaining()>=rowSize+1){var pos=imageData.getPosition();var algorithm=imageData.getByteAt(pos++);imageData.setPosition(pos);curLine=new Array(rowSize);imageData.getBulk(curLine);switch(algorithm){case 0:break;case 1:this.doSubLine(curLine);
break;case 2:this.doUpLine(curLine,prevLine);break;case 3:this.doAverageLine(curLine,prevLine);break;case 4:this.doPaethLine(curLine,prevLine);break}rows.push(curLine);prevLine=curLine}var outBuf=new Array(rows.length*rowSize);var outBufLength=outBuf.length;var numberOfRows=rows.length;var index=0;for(var i=0;i<numberOfRows;i++)for(var j=0;j<rowSize;j++){var value=rows[i][j];outBuf[index]=value;index++}return String.fromCharCode.apply(this,outBuf)};
trapeze.filter.PNGPredictor.prototype.doSubLine=function(curLine){var sub=Math.ceil(this.getBitsPerComponent()*this.getColors()/8);for(var i=0;i<curLine.length;i++){var prevIdx=i-sub;if(prevIdx>=0)curLine[i]+=curLine[prevIdx]}};trapeze.filter.PNGPredictor.prototype.doUpLine=function(curLine,prevLine){if(prevLine==null)return;for(var i=0;i<curLine.length;i++)curLine[i]+=prevLine[i]};
trapeze.filter.PNGPredictor.prototype.doAverageLine=function(curLine,prevLine){var sub=Math.ceil(this.getBitsPerComponent()*this.getColors()/8);for(var i=0;i<curLine.length;i++){var raw=0;var prior=0;var prevIdx=i-sub;if(prevIdx>=0)raw=curLine[prevIdx]&255;if(prevLine!=null)prior=prevLine[i]&255;curLine[i]+=Math.floor((raw+prior)/2)}};
trapeze.filter.PNGPredictor.prototype.doPaethLine=function(curLine,prevLine){var sub=Math.ceil(this.getBitsPerComponent()*this.getColors()/8);for(var i=0;i<curLine.length;i++){var left=0;var up=0;var upLeft=0;var prevIdx=i-sub;if(prevIdx>=0)left=curLine[prevIdx]&255;if(prevLine!=null)up=prevLine[i]&255;if(prevIdx>0&&prevLine!=null)upLeft=prevLine[prevIdx]&255;curLine[i]+=this.paeth(left,up,upLeft)}};
trapeze.filter.PNGPredictor.prototype.paeth=function(left,up,upLeft){var p=left+up-upLeft;var pa=Math.abs(p-left);var pb=Math.abs(p-up);var pc=Math.abs(p-upLeft);if(pa<=pb&&pa<=pc)return left;else if(pb<=pc)return up;else return upLeft};goog.provide("trapeze.filter.FlateFilter");goog.require("trapeze.filter.Predictor");
trapeze.filter.FlateFilter=function(){this.decode=function(stream,params){var inflator=new Inflator(new function(){var filePointer=2;var fileSize=stream.length-4;this.readByte=function(){if(filePointer>=fileSize)return-1;return stream.charCodeAt(filePointer++)&255}});var textReader=new TextReader(new DefaultTranslator(inflator));var outBytes=textReader.readToEnd();if(params!=null)var predictor=params.getDictionaryObject("Predictor");if(params!=null&&predictor!=null){var predictor=trapeze.filter.Predictor.getPredictor(params);
if(predictor!=null)outBytes=predictor.unpredict(outBytes)}return outBytes}};goog.provide("trapeze.filter.LzwFilter");goog.require("trapeze.StreamBuffer");
trapeze.filter.LzwFilter=function(){var buf;var bytepos;var bitpos;var dict=new Array(4096);var dictlen=0;var bitspercode=9;var STOP=257;var CLEARDICT=256;for(var i=0;i<256;i++){dict[i]=new Array(1);dict[i][0]=i}dictlen=258;bitspercode=9;bytepos=0;bitpos=0;this._nextCode=function(){var fillbits=bitspercode;var value=0;if(bytepos>=buf.getLimit()-1)return-1;while(fillbits>0){var nextbits=buf.getAt(bytepos);var bitsfromhere=8-bitpos;if(bitsfromhere>fillbits)bitsfromhere=fillbits;value|=(nextbits>>8-
bitpos-bitsfromhere&255>>8-bitsfromhere)<<fillbits-bitsfromhere;fillbits-=bitsfromhere;bitpos+=bitsfromhere;if(bitpos>=8){bitpos=0;bytepos++}}return value};this._resetDict=function(){dictlen=258;bitspercode=9};this.decode=function(stream){buf=new trapeze.StreamBuffer(stream);var cW=CLEARDICT;var baos={output:[],write:function(b,offset,length){for(var i=offset;i<offset+length;i++)this.output.push(b[i])}};function arrayCopy(src,srcPos,dest,destPos,len){for(var i=0;i<len;i++)dest[destPos+i]=src[srcPos+
i]}while(true){var pW=cW;cW=this._nextCode();if(cW==-1)throw new PDFParseException("Missed the stop code in LZWDecode!");if(cW==STOP)break;else if(cW==CLEARDICT)this._resetDict();else if(pW==CLEARDICT)baos.write(dict[cW],0,dict[cW].length);else{if(cW<dictlen){baos.write(dict[cW],0,dict[cW].length);var p=new Array(dict[pW].length+1);arrayCopy(dict[pW],0,p,0,dict[pW].length);p[dict[pW].length]=dict[cW][0];dict[dictlen++]=p}else{var p=new Array(dict[pW].length+1);arrayCopy(dict[pW],0,p,0,dict[pW].length);
p[dict[pW].length]=p[0];baos.write(p,0,p.length);dict[dictlen++]=p}if(dictlen>=(1<<bitspercode)-1&&bitspercode<12)bitspercode++}}return String.fromCharCode.apply(this,baos.output)}};goog.provide("trapeze.filter.NoFilter");trapeze.filter.NoFilter=function(){this.decode=function(text){return text}};goog.provide("trapeze.filter.FilterManager");goog.require("trapeze.filter.NoFilter");goog.require("trapeze.filter.LzwFilter");goog.require("trapeze.filter.FlateFilter");goog.require("trapeze.filter.ASCII85Filter");
trapeze.filter.FilterManager=function(){};trapeze.filter.FilterManager.getFilter=function(name){if(name=="FlateDecode"||name=="Fl")return new trapeze.filter.FlateFilter;else if(name=="NoFilter")return new trapeze.filter.NoFilter;else if(name=="LZWDecode"||name=="LZW")return new trapeze.filter.LzwFilter;else if(name=="ASCII85Decode"||name=="A85")return new trapeze.filter.ASCII85Filter;else throw new Exception("Unknown filter "+name);};goog.provide("trapeze.cos.COSObjectStreamLocation");
trapeze.cos.COSObjectStreamLocation=function(streamObjectKey,index){this.streamObjectKey=streamObjectKey;this.index=index};goog.provide("trapeze.PDFXrefStreamParser");goog.require("trapeze.StreamBuffer");goog.require("trapeze.cos.COSNumber");goog.require("trapeze.cos.COSArray");goog.require("trapeze.cos.COSObjectKey");goog.require("trapeze.cos.COSObjectStreamLocation");
trapeze.PDFXrefStreamParser=function(stream,doc){this.stream=stream;this.pdfSource=new trapeze.StreamBuffer(stream.decode());this.document=doc};
trapeze.PDFXrefStreamParser.prototype={parse:function(){var dictionary=this.stream.dictionary;var xrefFormat=dictionary.getDictionaryObject("W");var indexArray=dictionary.getDictionaryObject("Index");if(indexArray==null){indexArray=new trapeze.cos.COSArray;indexArray.add(new trapeze.cos.COSNumber(0));indexArray.add(dictionary.getDictionaryObject("Size"))}var objNums=[];var indexSize=indexArray.size();var index=0;while(index<indexSize){var objID=indexArray.get(index++).value;var size=indexArray.get(index++).value;
for(var i=0;i<size;i++)objNums.push(parseInt(objID+i))}var objLength=objNums.length;var objIndex=0;var w0=xrefFormat.get(0).value;var w1=xrefFormat.get(1).value;var w2=xrefFormat.get(2).value;var lineSize=w0+w1+w2;while(this.pdfSource.hasRemaining()){var currLine=[];for(var i=0;i<lineSize;i++)currLine.push(this.pdfSource.get());var type=0;for(var i=0;i<w0;i++)type+=(currLine[i]&255)<<(w0-i-1)*8;var objID=objNums[objIndex++];switch(type){case 0:break;case 1:var offset=0;for(var i=0;i<w1;i++)offset+=
(currLine[i+w0]&255)<<(w1-i-1)*8;var genNum=0;for(var i=0;i<w2;i++)genNum+=(currLine[i+w0+w1]&255)<<(w2-i-1)*8;var objKey=new trapeze.cos.COSObjectKey(objID,genNum);this.document.setXRef(objKey,offset);break;case 2:var streamObjectNumber=0;for(var i=0;i<w1;i++)streamObjectNumber+=(currLine[i+w0]&255)<<(w1-i-1)*8;var index=0;for(var i=0;i<w2;i++)index+=(currLine[i+w0+w1]&255)<<(w2-i-1)*8;var objKey=new trapeze.cos.COSObjectKey(objID,0);this.document.setXRef(objKey,new trapeze.cos.COSObjectStreamLocation(new trapeze.cos.COSObjectKey(streamObjectNumber,
0),index));break;default:break}}}};goog.provide("trapeze.PDFObjectStreamParser");goog.require("trapeze.BaseParser");goog.require("trapeze.StreamBuffer");goog.require("trapeze.cos.COSObject");goog.require("trapeze.cos.COSObjectKey");trapeze.PDFObjectStreamParser=function(stream,doc){trapeze.PDFObjectStreamParser.baseConstructor.call(this);this.dictionary=stream.dictionary;this.stream=new trapeze.StreamBuffer(stream.decode());this.document=doc;this.streamObjects=[];this.objectNumbers=[]};
extend(trapeze.PDFObjectStreamParser,trapeze.BaseParser);
trapeze.PDFObjectStreamParser.prototype.parse=function(){var numberOfObjects=this.dictionary.getDictionaryObject("N").value;this.objectNumbers=[];this.streamObjects=[];for(var i=0;i<numberOfObjects;i++){var objectNumber=this.readNum();var offset=this.readNum();this.objectNumbers.push(objectNumber)}var object=null;var cosObject=null;var objectCounter=0;while(this.stream.hasRemaining()&&(cosObject=this.parseDirObject())!=null){var key=new trapeze.cos.COSObjectKey(this.objectNumbers[objectCounter],0);
object=new trapeze.cos.COSObject(cosObject,key);this.streamObjects.push(object);objectCounter++}};goog.provide("trapeze.cos.COSDocument");goog.require("trapeze.PDFObjectStreamParser");goog.require("trapeze.cos.COSObject");goog.require("trapeze.cos.COSObjectStreamLocation");trapeze.cos.COSDocument=function(){this.version;this.parser;this._objectPool={};this._xrefTable={};this._trailer=null};
trapeze.cos.COSDocument.prototype={getObjectFromPool:function(key){var hash=key.getKey();var object=this._objectPool[hash];if(object==null){object=new trapeze.cos.COSObject(null,key,this);this._objectPool[hash]=object}return object},setXRef:function(key,offset){if(typeof offset=="string"){while(offset.charAt(0)=="0"){if(offset.length==1)break;if(offset.charAt(1)==".")break;offset=offset.substr(1,offset.length-1)}offset=parseInt(offset)}this._xrefTable[key.getKey()]=offset},getTrailer:function(){return this._trailer},
setTrailer:function(trailer){this._trailer=trailer},loadObject:function(key){var pos=this._xrefTable[key.getKey()];if(pos instanceof trapeze.cos.COSObjectStreamLocation){var obj=this.getObjectFromPool(pos.streamObjectKey);var parser=new trapeze.PDFObjectStreamParser(obj.getObject(),this);parser.parse();var compressedObjects=parser.streamObjects;var coLength=compressedObjects.length;for(var j=0;j<coLength;j++){var next=compressedObjects[j];var key=next.getKey();var obj=this.getObjectFromPool(key);
obj.setObject(next.getObject())}}else{var oldPos=this.parser.stream.getPosition();this.parser.stream.setPosition(pos);var newObject=this.parser.parseObject();this.parser.stream.setPosition(oldPos)}},toString:function(){return"COSDocument";var retval="";for(property in this._objectPool)retval+=this._objectPool[property].toString()+"\n";return retval}};goog.provide("trapeze.Rectangle2D");trapeze.Rectangle2D=function(x,y,w,h){this.x=x;this.y=y;this.width=w;this.height=h};
trapeze.Rectangle2D.prototype={getX:function(){return this.x},getY:function(){return this.y},getWidth:function(){return this.width},getHeight:function(){return this.height},getMinX:function(){return this.x},getMinY:function(){return this.y},isEmpty:function(){if(this.width==0||this.height==0)return true;return false}};goog.provide("trapeze.AffineTransform");
trapeze.AffineTransform=function(m00,m10,m01,m11,m02,m12){if(arguments.length==0){m00=1;m10=0;m01=0;m11=1;m02=0;m12=0}this.m00=m00;this.m10=m10;this.m01=m01;this.m11=m11;this.m02=m02;this.m12=m12};
trapeze.AffineTransform.prototype={multiply:function(b){var result=new trapeze.AffineTransform;if(b!=null){result.m00=this.m00*b.m00+this.m01*b.m10;result.m01=this.m00*b.m01+this.m01*b.m11;result.m02=this.m00*b.m02+this.m01*b.m12+this.m02;result.m10=this.m10*b.m00+this.m11*b.m10;result.m11=this.m10*b.m01+this.m11*b.m11;result.m12=this.m10*b.m02+this.m11*b.m12+this.m12}else console.error("no AffineTransform");return result},toString:function(){var result="";result+="[[";result+=this.m00+", ";result+=
this.m01+", ";result+=this.m02+"][";result+=this.m10+", ";result+=this.m11+", ";result+=this.m12+"]]";return result},getDeterminant:function(){return this.m00*this.m11-this.m01*this.m10},getScaleX:function(){return this.m00},getScaleY:function(){return this.m11},clone:function(){return new trapeze.AffineTransform(this.m00,this.m10,this.m01,this.m11,this.m02,this.m12)},scale:function(x,y){var scalor=trapeze.AffineTransform.getScaleInstance(x,y);return this.multiply(scalor)},translate:function(x,y){var scalor=
trapeze.AffineTransform.getTranslatingInstance(x,y);return this.multiply(scalor)},transform:function(pt){return{x:pt.x*this.m00+pt.y*this.m01+this.m02,y:pt.x*this.m10+pt.y*this.m11+this.m12}}};trapeze.AffineTransform.getScaleInstance=function(x,y){var affineTransform=new trapeze.AffineTransform;affineTransform.m00=x;affineTransform.m11=y;return affineTransform};
trapeze.AffineTransform.getTranslatingInstance=function(x,y){var affineTransform=new trapeze.AffineTransform;affineTransform.m02=x;affineTransform.m12=y;return affineTransform};goog.provide("trapeze.pdmodel.PDPageNode");goog.require("trapeze.pdmodel.PDResources");goog.require("trapeze.pdmodel.PDPage");goog.require("trapeze.Rectangle2D");goog.require("trapeze.cos.COSDictionary");
trapeze.pdmodel.PDPageNode=function(pages){this.page=pages;this.getCount=function(){return this.page.getDictionaryObject("Count").value};this.getAllKids=function(result){trapeze.pdmodel.PDPageNode.getAllKidsStatic(result,this.page,true)};this.getParent=function(){var parent=null;var parentDic=this.page.getDictionaryObjectTwoKey("Parent","P");if(parentDic!=null)parent=new trapeze.pdmodel.PDPageNode(parentDic);return parent};this.getMediaBox=function(){var retval=null;var array=this.page.getDictionaryObject("MediaBox");
if(array!=null)retval=new trapeze.Rectangle2D(array.getObject(0).value,array.getObject(1).value,array.getObject(2).value-array.getObject(0).value,array.getObject(3).value-array.getObject(1).value);return retval};this.findResources=function(){var retval=this.getResources();var parent=this.getParent();if(retval==null&&parent!=null)retval=parent.findResources();return retval};this.getResources=function(){var retval=null;var resources=this.page.getDictionaryObject("Resources");if(resources!=null)retval=
new trapeze.pdmodel.PDResources(resources);return retval};this.findMediaBox=function(){var retval=this.getMediaBox();var parent=this.getParent();if(retval==null&&parent!=null)retval=this.parent.findMediaBox();return retval}};
trapeze.pdmodel.PDPageNode.getAllKidsStatic=function(result,page,recurse){var kids=page.getDictionaryObject("Kids");if(kids==null)return[];for(var i=0;i<kids.size();i++){var obj=kids.getObject(i);if(obj instanceof trapeze.cos.COSDictionary){var kid=obj;if("Page"==kid.getDictionaryObject("Type").name)result.push(new trapeze.pdmodel.PDPage(kid));else if(recurse)trapeze.pdmodel.PDPageNode.getAllKidsStatic(result,kid,recurse);else result.push(new trapeze.pdmodel.PDPageNode(kid))}}return kids};goog.provide("trapeze.pdmodel.PDResources");
trapeze.pdmodel.PDResources=function(resourceDictionary){this.resources=resourceDictionary;this.getFonts=function(){var retval=null;var fonts=this.resources.getDictionaryObject("Font");console.log(fonts);retval={};return retval};this.getFont=function(name){var fonts=this.resources.getDictionaryObject("Font");var font=fonts.getDictionaryObject(name);return font};this.getXObject=function(name){var x=this.resources.getDictionaryObject("XObject");return x.getDictionaryObject(name)};this.getGraphicsState=
function(name){var states=this.resources.getDictionaryObject("ExtGState");if(states==null)return null;return states.getDictionaryObject(name)}};goog.provide("trapeze.cos.COSStreamArray");goog.require("trapeze.PDFStreamParser");
trapeze.cos.COSStreamArray=function(base){this.streams=base;this.decode=function(){var out="";for(var i=0;i<this.streams.size();i++)out+=this.streams.getObject(i).decode();return out};this.getStreamTokens=function(){var parser=new trapeze.PDFStreamParser(this);parser.parse();return parser.getTokens()}};goog.provide("trapeze.pdmodel.PDStream");goog.require("trapeze.cos.COSArray");goog.require("trapeze.cos.COSStreamArray");
trapeze.pdmodel.PDStream=function(stream){this.stream=stream;this.getStream=function(){return this.stream}};trapeze.pdmodel.PDStream.createFromCOS=function(base){var retval=null;if(base instanceof trapeze.cos.COSStream)retval=new trapeze.pdmodel.PDStream(base);else if(base instanceof trapeze.cos.COSArray)retval=new trapeze.pdmodel.PDStream(new trapeze.cos.COSStreamArray(base));else if(base!=null)throw new IOException("Contents are unknown type:"+base.getClass().getName());return retval};goog.provide("trapeze.pdmodel.PDPage");
goog.require("trapeze.pdmodel.PDStream");goog.require("trapeze.pdmodel.PDResources");goog.require("trapeze.pdmodel.PDPageNode");goog.require("trapeze.Rectangle2D");goog.require("trapeze.AffineTransform");
trapeze.pdmodel.PDPage=function(pageDic){this.page=pageDic;this.getMediaBox=function(){var retval=null;var array=this.page.getDictionaryObject("MediaBox");if(array!=null)retval=new trapeze.Rectangle2D(array.getObject(0).value,array.getObject(1).value,array.getObject(2).value-array.getObject(0).value,array.getObject(3).value-array.getObject(1).value);return retval};this.getRotation=function(){var rotation=0;var rotate=this.page.getDictionaryObject("Rotate");if(rotate!=null)rotation=rotate.value;return rotation};
this.findMediaBox=function(){var retval=this.getMediaBox();var parent=this.getParent();if(retval==null&&parent!=null)retval=parent.findMediaBox();return retval};this.getParent=function(){var parent=null;var parentDic=this.page.getDictionaryObjectTwoKey("Parent","P");if(parentDic!=null)parent=new trapeze.pdmodel.PDPageNode(parentDic);return parent};this.getResources=function(previousResources){var retval=null;var resources=this.page.getDictionaryObject("Resources");if(resources!=null)retval=new trapeze.pdmodel.PDResources(resources);
return retval};this.findResources=function(){var retval=this.getResources();var parent=this.getParent();if(retval==null&&parent!=null)retval=parent.findResources();return retval};this.getContents=function(){return trapeze.pdmodel.PDStream.createFromCOS(this.page.getDictionaryObject("Contents"))};this.drawToCanvas=function(){var resolution=96;var mBox=this.findMediaBox();var widthPt=mBox.getWidth();var heightPt=mBox.getHeight();var scaling=resolution/72;var widthPx=Math.round(widthPt*scaling);var heightPx=
Math.round(heightPt*scaling)};this.getInitialTransform=function(width,height){var at=new trapeze.AffineTransform;switch(this.getRotation()){case 0:at=new trapeze.AffineTransform(1,0,0,-1,0,height);break;case 90:at=new trapeze.AffineTransform(0,1,1,0,0,0);break;case 180:at=new trapeze.AffineTransform(-1,0,0,1,width,0);break;case 270:at=new trapeze.AffineTransform(0,-1,-1,0,width,height);break}var clip=this.findMediaBox();if(this.getRotation()==90||this.getRotation()==270){var tmp=clip.width;clip.width=
clip.height;clip.height=tmp}var scaleX=width/clip.getWidth();var scaleY=height/clip.getHeight();at=at.scale(scaleX,scaleY);var zx=-clip.getMinX();var zy=-clip.getMinY();at=at.translate(-clip.getMinX(),-clip.getMinY());return at};this.getUnstretchedSize=function(width,height){var clip=this.findMediaBox();if(clip==null){console.error("todo");clip=bbox}else if(this.getRotation()==90||this.getRotation()==270)clip=new trapeze.Rectangle2D(clip.getX(),clip.getY(),clip.getHeight(),clip.getWidth());var ratio=
clip.getHeight()/clip.getWidth();var askratio=height/width;if(askratio>ratio)height=parseInt(width*ratio+0.5);else width=parseInt(height/ratio+0.5);return{"width":width,"height":height}}};goog.provide("trapeze.pdmodel.PDDocumentCatalog");goog.require("trapeze.pdmodel.PDPageNode");goog.require("trapeze.cos.COSString");goog.require("trapeze.cos.COSDictionary");
trapeze.pdmodel.PDDocumentCatalog=function(doc,rootDictionary){this.document=doc;if(rootDictionary)this.root=rootDictionary;else{this.root=new trapeze.cos.COSDictionary;this.root.setItem("Type",new trapeze.cos.COSString("Catalog"));this.document.document.getTrailer().setItem("Root",this.root)}this.getPages=function(){return new trapeze.pdmodel.PDPageNode(this.root.getDictionaryObject("Pages"))};this.getAllPages=function(){var retval=[];var rootNode=this.getPages();rootNode.getAllKids(retval);return retval}};
goog.provide("trapeze.pdmodel.PDDocumentInformation");trapeze.pdmodel.PDDocumentInformation=function(dic){this.info=dic;this.getTitle=function(){return this.info.getItem("Title")}};goog.provide("trapeze.pdmodel.PDDocument");goog.require("trapeze.pdmodel.PDDocumentInformation");goog.require("trapeze.pdmodel.PDDocumentCatalog");goog.require("trapeze.cos.COSDictionary");
trapeze.pdmodel.PDDocument=function(cosDocument){this.document=cosDocument;this.getNumberOfPages=function(){var cat=this.getDocumentCatalog();return cat.getPages().getCount()};this.getDocumentCatalog=function(){var trailer=this.document.getTrailer();var infoDic=trailer.getDictionaryObject("Root");if(infoDic==null){console.error(" ");throw"hello";documentCatalog=new trapeze.pdmodel.PDDocumentCatalog(this)}else documentCatalog=new trapeze.pdmodel.PDDocumentCatalog(this,infoDic);return documentCatalog};
this.getDocumentInformation=function(){var trailer=this.document.getTrailer();var infoDic=trailer.getDictionaryObject("Info");if(infoDic==null){infoDic=new trapeze.cos.COSDictionary;trailer.setItem({name:"Info"},infoDic)}var documentInformation=new trapeze.pdmodel.PDDocumentInformation(infoDic);return documentInformation}};goog.provide("trapeze.PDFParser");goog.require("trapeze.BaseParser");goog.require("trapeze.pdmodel.PDDocument");goog.require("trapeze.PDFXrefStreamParser");goog.require("trapeze.cos.COSDictionary");
goog.require("trapeze.cos.COSDocument");goog.require("trapeze.cos.COSObjectKey");trapeze.PDFParser=function(stream){this.stream=stream;this.document=new trapeze.cos.COSDocument;this.document.parser=this};extend(trapeze.PDFParser,trapeze.BaseParser);
trapeze.PDFParser.prototype.parse=function(){var startXrefPos=this.stream.lastIndexOf("startxref");if(startXrefPos==-1)throw new ParseException("Could not find the startxref");this.stream.setPosition(startXrefPos+9);this.skipSpaces();var xrefPos=this.readNum();while(true){this.stream.setPosition(xrefPos);this.skipSpaces();var peek=this.stream.peek();var trailer=null;if(peek=="x"){this.parseXrefTable();trailer=this.parseTrailer()}else trailer=this.parseXrefStream();var prev=trailer.getDictionaryObject("Prev");
if(prev)xrefPos=prev.value;else break}};trapeze.PDFParser.prototype.parseHeader=function(){var header=this.stream.readLine();var version=header.substring(5);this.document.version=version};
trapeze.PDFParser.prototype.parseObject=function(){if(!this.stream.hasRemaining())return true;this.skipSpaces();var peek=this.stream.peek();if(peek=="e"){this.readString();this.skipSpaces()}else if(peek=="x")this.parseXrefTable();else if(peek=="t"||peek=="s"){if(peek=="t"){this.parseTrailer();peek=this.stream.peek()}if(peek=="s"){this.parseStartXref();this.skipSpaces();if(this.stream.hasRemaining());return true}}else{var objectNumber=this.readNum();this.skipSpaces();var genNumber=this.readNum();this.skipSpaces();
var objectKey=this.stream.read(3);var pb=this.parseDirObject();var endObjectKey=this.readString();if(endObjectKey=="stream"){if(pb instanceof trapeze.cos.COSDictionary)pb=this.parseCOSStream(pb);else throw new Exception("Previous must be a dictionary");endObjectKey=this.readString()}var key=new trapeze.cos.COSObjectKey(objectNumber,genNumber);var pdfObject=this.document.getObjectFromPool(key);pdfObject.setObject(pb);return pb}return false};
trapeze.PDFParser.prototype.parseXrefStream=function(){var obj=this.parseObject();var parser=new trapeze.PDFXrefStreamParser(obj,this.document);parser.parse();var parsedTrailer=obj.dictionary;var docTrailer=this.document.getTrailer();if(docTrailer==null)this.document.setTrailer(parsedTrailer);else docTrailer.addAll(parsedTrailer);return parsedTrailer};
trapeze.PDFParser.prototype.parseXrefTable=function(){var xref=this.readString();if(xref!="xref")return false;this.skipSpaces();while(true){var currObjID=this.readNum();var count=this.readNum();this.skipSpaces();for(var i=0;i<count;i++){if(!this.stream.hasRemaining()||this.isEndOfName(this.stream.peek()))break;if(this.stream.peek()=="t")break;var currentLine=this.stream.readLine().replace(/\s+$/,"");var splitString=currentLine.split(" ");if(splitString.length<3){console.warn("invalid xref line: "+
currentLine);break}if(splitString[splitString.length-1]=="n"){var currOffset=splitString[0];var currGenID=splitString[1];var objKey=new trapeze.cos.COSObjectKey(currObjID,currGenID);this.document.setXRef(objKey,currOffset)}else if(splitString[2]!="f")throw"Corrupt XRefTable Entry - ObjID:"+currObjID;currObjID++;this.skipSpaces()}this.skipSpaces();var c=this.stream.peek();if(c<"0"||c>"9")break}return true};
trapeze.PDFParser.prototype.parseTrailer=function(){var nextLine=this.stream.read(7);if(nextLine!="trailer")throw new ParseException("Expected trailer found '"+nextLine+"'");this.skipSpaces();var parsedTrailer=this.parseCOSDictionary();var docTrailer=this.document.getTrailer();if(docTrailer==null)this.document.setTrailer(parsedTrailer);else docTrailer.addAll(parsedTrailer);this.skipSpaces();return parsedTrailer};
trapeze.PDFParser.prototype.parseStartXref=function(){var startXRef=this.stream.readLine();if(startXRef!="startxref")throw"blah";this.skipSpaces();this.readNum();return true};trapeze.PDFParser.prototype.getPDDocument=function(){return new trapeze.pdmodel.PDDocument(this.document)};goog.provide("trapeze.font.BaseFontMap");
trapeze.font.BaseFontMap={"Courier":{"file":"n022003l.pfb","length":96263},"Courier-Bold":{"file":"n022004l.pfb","length":120373},"Courier-BoldOblique":{"file":"n022024l.pfb","length":114228},"Courier-Oblique":{"file":"n022023l.pfb","length":101133},"Helvetica":{"file":"n019003l.pfb","length":68590},"Helvetica-Bold":{"file":"n019004l.pfb","length":72400},"Helvetica-BoldOblique":{"file":"n019024l.pfb","length":73879},"Helvetica-Oblique":{"file":"n019023l.pfb","length":71719},"Times-Roman":{"file":"n021003l.pfb",
"length":113206},"Times-Bold":{"file":"n021004l.pfb","length":108822},"Times-BoldItalic":{"file":"n021024l.pfb","length":96211},"Times-Italic":{"file":"n021023l.pfb","length":108217},"Symbol":{"file":"s050000l.pfb","length":32213},"ZapfDingbats":{"file":"d050000l.pfb","length":45955}};goog.provide("trapeze.font.PDFFontDescriptor");goog.require("trapeze.Rectangle2D");goog.require("trapeze.cos.COSDictionary");goog.require("trapeze.cos.COSName");goog.require("trapeze.cos.COSNumber");
trapeze.font.PDFFontDescriptor=function(obj){if(obj instanceof trapeze.cos.COSDictionary){this.ascent=obj.getDictionaryObject("Ascent").value;this.capHeight=obj.getDictionaryObject("CapHeight").value;this.descent=obj.getDictionaryObject("Descent").value;this.flags=obj.getDictionaryObject("Flags").value;this.fontName=obj.getDictionaryObject("FontName").name;this.italicAngle=obj.getDictionaryObject("ItalicAngle").value;this.stemV=obj.getDictionaryObject("StemV").value;this.avgWidth=getValueOrNull("AvgWidth")||
0;this.fontFile=getValueOrNull("FontFile");this.fontFile2=getValueOrNull("FontFile2");this.fontFile3=getValueOrNull("FontFile3");this.leading=getValueOrNull("Leading")||0;this.maxWidth=getValueOrNull("MaxWidth")||0;this.missingWidth=getValueOrNull("MissingWidth")||0;this.stemH=getValueOrNull("StemH")||0;this.xHeight=getValueOrNull("XHeight")||0;this.charSet=getValueOrNull("CharSet");this.fontFamily=getValueOrNull("FontFamily");this.fontWeight=getValueOrNull("FontWeight");this.fontStretch=getValueOrNull("FontStretch")}else this.fontName=
obj;function getValueOrNull(key){var test=obj.getDictionaryObject(key);if(test==null)return null;else if(test instanceof trapeze.cos.COSNumber)return test.value;else if(test instanceof trapeze.cos.COSName)return test.name;else return test}};trapeze.font.PDFFontDescriptor.PLAIN=0;trapeze.font.PDFFontDescriptor.BOLD=1;trapeze.font.PDFFontDescriptor.ITALIC=2;trapeze.font.PDFFontDescriptor.FIXED_PITCH=1<<1-1;trapeze.font.PDFFontDescriptor.SERIF=1<<2-1;trapeze.font.PDFFontDescriptor.SYMBOLIC=1<<3-1;
trapeze.font.PDFFontDescriptor.SCRIPT=1<<4-1;trapeze.font.PDFFontDescriptor.NONSYMBOLIC=1<<6-1;trapeze.font.PDFFontDescriptor.ITALIC=1<<7-1;trapeze.font.PDFFontDescriptor.ALLCAP=1<<17-1;trapeze.font.PDFFontDescriptor.SMALLCAP=1<<18-1;trapeze.font.PDFFontDescriptor.FORCEBOLD=1<<19-1;goog.provide("trapeze.GeneralPath");goog.require("trapeze.AffineTransform");
trapeze.GeneralPath=function(){this.at=new trapeze.AffineTransform;this.commands=[["transform",[this.at.m00,this.at.m10,this.at.m01,this.at.m11,this.at.m02,this.at.m12]]]};trapeze.GeneralPath.prototype.moveTo=function(x,y){this.commands.push(["moveTo",[x,y]])};trapeze.GeneralPath.prototype.quadTo=function(x1,y1,x2,y2){this.commands.push(["quadraticCurveTo",[x1,y1,x2,y2]])};
trapeze.GeneralPath.prototype.curveTo=function(cp1x,cp1y,cp2x,cp2y,x,y){this.commands.push(["bezierCurveTo",[cp1x,cp1y,cp2x,cp2y,x,y]])};trapeze.GeneralPath.prototype.lineTo=function(x,y){this.commands.push(["lineTo",[x,y]])};trapeze.GeneralPath.prototype.closePath=function(){this.commands.push(["closePath",[]])};trapeze.GeneralPath.prototype.transform=function(matrix){this.at=this.at.multiply(matrix);this.commands[0]=["transform",[this.at.m00,this.at.m10,this.at.m01,this.at.m11,this.at.m02,this.at.m12]]};
trapeze.GeneralPath.prototype.append=function(path){for(var i=1;i<path.commands.length;i++)this.commands.push(path.commands[i])};goog.provide("trapeze.font.FontSupport");trapeze.font.FontSupport=function(){};trapeze.font.FontSupport.findName=function(name,table){for(var i=0;i<table.length;i++)if(name==table[i])return i;return-1};
trapeze.font.FontSupport.getName=function(i){if(i<trapeze.font.FontSupport.stdNames.length)return trapeze.font.FontSupport.stdNames[i];else{i-=trapeze.font.FontSupport.stdNames.length;if(i<trapeze.font.FontSupport.macExtras.length)return trapeze.font.FontSupport.macExtras[i]}return".notdef"};
trapeze.font.FontSupport.stdNames=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore",
"quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave",
"acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave",
"Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute",
"ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior",
"esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall",
"centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior",
"seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall",
"Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"];
trapeze.font.FontSupport.stdValues=[""," ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","\u00a1","\u00a2","\u00a3","/fraction","\u00a5","Fflorin","\u00a7","\u00a4","\u00b4quotesingle",
"\u201c","?guillemotleft","\u2039","\u203a","fi","fl","--","\u2020","\u2021","\u00b7","\u00b6","\u2022","'quotesinglbase",'"quotedblbase','"quotedblright',"?guillemotright","...ellipsis","%perthousand","?questiondown","`grave","'acute","^circumflex","~tilde","-macron","?breve","?dotaccent","?dieresis","oring","ccedilla",":hungarumlaut","?ogonek",",caron","---emdash","AE","aordfeminine","LLslash","OOslash","OE","oordmasculine","ae","idotlessi","llslash","ooslash","oe","Bgermandbls","1onesuperior",
"~logicalnot","?mu","(TM)trademark","?Eth","1/2","+/-","?Thorn","1/4","/divide","|brokenbar","*degree","?thorn","3/4","2twosuperior","(R)","-minus","?eth","*multiply","3threesuperior","(C)","AAacute","AAcircumflex","AAdieresis","AAgrave","AAring","AAtilde","CCcedilla","EEacute","EEcircumflex","EEdieresis","EEgrave","IIacute","IIcircumflex","IIdieresis","IIgrave","NNtilde","OOacute","OOcircumflex","OOdieresis","OOgrave","OOtilde","SScaron","UUacute","UUcircumflex","UUdieresis","UUgrave","YYacute",
"YYdieresis","ZZcaron","aaacute","aacircumflex","aadieresis","aagrave","aaring","aatilde","cccedilla","eeacute","eecircumflex","eedieresis","eegrave","iiacute","iicircumflex","iidieresis","iigrave","nntilde","ooacute","oocircumflex","oodieresis","oograve","ootilde","sscaron","uuacute","uucircumflex","uudieresis","uugrave","yyacute","yydieresis","zzcaron","!exclamsmall","?Hungarumlautsmall","$dollaroldstyle","$dollarsuperior","&ampersandsmall","'Acutesmall","/parenleftsuperior","\\parenrightsuperior",
"?twodotenleader","?onedotenleader","0zerooldstyle","1oneoldstyle","2twooldstyle","3threeoldstyle","4fouroldstyle","5fiveoldstyle","6sixoldstyle","7sevenoldstyle","8eightoldstyle","9nineoldstyle","'commasuperior","--threequartersemdash",".periodsuperior","?questionsmall","aasuperior","bbsuperior","ccentsuperior","ddsuperior","eesuperior","iisuperior","llsuperior","mmsuperior","nnsuperior","oosuperior","rrsuperior","sssuperior","ttsuperior","ff","ffi","ffl","\\parenleftinferior","/parenrightinferior",
"^Circumflexsmall","-hyphensuperior","`Gravesmall","AAsmall","BBsmall","CCsmall","DDsmall","EEsmall","FFsmall","GGsmall","HHsmall","IIsmall","JJsmall","KKsmall","LLsmall","MMsmall","NNsmall","OOsmall","PPsmall","QQsmall","RRsmall","SSsmall","TTsmall","UUsmall","VVsmall","WWsmall","XXsmall","YYsmall","ZZsmall",":colonmonetary","1onefitted","?rupiah","~Tildesmall","!exclamdownsmall","ccentoldstyle","LLslashsmall","SScaronsmall","ZZcaronsmall","?Dieresissmall","?Brevesmall","^Caronsmall","?Dotaccentsmall",
"?Macronsmall","--figuredash","-hypheninferior","?Ogoneksmall","oRingsmall",",Cedillasmall","?questiondownsmall","1/8oneeighth","3/8threeeighths","5/8fiveeighths","7/8seveneighths","1/3onethird","2/3twothirds","0zerosuperior","4foursuperior","5fivesuperior","6sixsuperior","7sevensuperior","8eightsuperior","9ninesuperior","0zeroinferior","1oneinferior","2twoinferior","3threeinferior","4fourinferior","5fiveinferior","6sixinferior","7seveninferior","8eightinferior","9nineinferior","ccentinferior","$dollarinferior",
".periodinferior",",commainferior","AAgravesmall","AAacutesmall","AAcircumflexsmall","AAtildesmall","AAdieresissmall","AAringsmall","AEAEsmall","CCcedillasmall","EEgravesmall","EEacutesmall","EEcircumflexsmall","EEdieresissmall","IIgravesmall","IIacutesmall","IIcircumflexsmall","IIdieresissmall","EthEthsmall","NNtildesmall","OOgravesmall","OOacutesmall","OOcircumflexsmall","OOtildesmall","OOdieresissmall","OEOEsmall","OOslashsmall","UUgravesmall","UUacutesmall","UUcircumflexsmall","UUdieresissmall",
"YYacutesmall","?Thornsmall","YYdieresissmall","?001.000","?001.001","?001.002","?001.003"," Black"," Bold"," Book"," Light"," Medium"," Regular"," Roman"," Semibold","?NUL","?HT"," LF"," CR","?DLE","?DC1","?DC2","?DC3","?DC4","?RS","?US","!=","?DEL","?infinity","<=",">=","?partialdiff","?summation","xproduct","?pi","?integral","?Omega","?radical","~=","?Delta"," nbspace","?lozenge","?apple"];
trapeze.font.FontSupport.type1CExpertCharset=[1,229,230,231,232,233,234,235,236,237,238,13,14,15,99,239,240,241,242,243,244,245,246,247,248,27,28,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,109,110,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,158,155,163,319,320,321,322,323,324,325,326,150,164,169,327,328,329,
330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378];
trapeze.font.FontSupport.type1CExpertSubCharset=[1,231,232,235,236,237,238,13,14,15,99,239,240,241,242,243,244,245,246,247,248,27,28,249,250,251,253,254,255,256,257,258,259,260,261,262,263,264,265,266,109,110,267,268,269,270,272,300,301,302,305,314,315,158,155,163,320,321,322,323,324,325,326,150,164,169,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346];
trapeze.font.FontSupport.macExtras=["NUL","HT","LF","CR","DLE","DC1","DC2","DC3","DC4","RS","US","notequal","DEL","infinity","lessequal","greaterequal","partialdiff","summation","product","pi","integral","Omega","radical","approxequal","Delta","nbspace","lozenge","apple"];
trapeze.font.FontSupport.macRomanEncoding=[391,154,167,140,146,192,221,197,226,392,393,157,162,394,199,228,395,396,397,398,399,155,158,150,163,169,164,160,166,168,400,401,1,2,3,4,5,6,7,104,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,124,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,403,173,175,177,178,186,189,195,200,203,201,202,205,
204,206,207,210,208,209,211,214,212,213,215,216,219,217,218,220,222,225,223,224,112,161,97,98,102,116,115,149,165,170,153,125,131,402,138,141,404,156,405,406,100,152,407,408,409,410,411,139,143,412,144,147,123,96,151,413,101,414,415,106,120,121,416,174,176,191,142,148,111,137,105,119,65,8,159,417,227,198,99,103,107,108,109,110,113,114,117,118,122,172,179,171,180,181,182,183,184,185,187,188,418,190,193,194,196,145,126,127,128,129,130,132,133,134,135,136];
trapeze.font.FontSupport.isoLatin1Encoding=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,166,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,145,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,1,96,97,98,103,100,160,
102,131,170,139,106,151,14,165,128,161,156,164,169,125,152,115,114,133,150,143,120,158,155,163,123,174,171,172,176,173,175,138,177,181,178,179,180,185,182,183,184,154,186,190,187,188,191,189,168,141,196,193,194,195,197,157,149,203,200,201,205,202,204,144,206,210,207,208,209,214,211,212,213,167,215,219,216,217,220,218,159,147,225,222,223,224,226,162,227];
trapeze.font.FontSupport.winAnsiEncoding=[124,125,126,127,128,129,130,131,132,133,134,135,136,145,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,117,101,118,121,112,113,0,122,192,107,142,0,0,0,0,65,8,105,119,116,111,137,0,153,221,
108,148,0,0,198,1,96,97,98,103,100,160,102,131,170,139,106,151,14,165,128,161,156,164,169,125,152,115,114,133,150,143,120,158,155,163,123,174,171,172,176,173,175,138,177,181,178,179,180,185,182,183,184,154,186,190,187,188,191,189,168,141,196,193,194,195,197,157,149,203,200,201,205,202,204,144,206,210,207,208,209,214,211,212,213,167,215,219,216,217,220,218,159,147,225,222,223,224,226,162,227];
trapeze.font.FontSupport.standardEncoding=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,
110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];goog.provide("trapeze.font.PDFFont");trapeze.font.PDFFont=function(baseFont,descriptor){this.baseFont=baseFont;this.descriptor=descriptor;this.subType;this.encoding;this.glyphCache={}};
trapeze.font.PDFFont.prototype.getGlyphs=function(text){if(this.encoding!=null)return this.encoding.getGlyphs(this,text);else{var outList=[];for(var i=0;i<text.length;i++){var src=text.charAt(i);outList.push(this.getCachedGlyph(src,null))}return outList}};trapeze.font.PDFFont.prototype.getCachedGlyph=function(src,name){if(this.glyphCache[src]!=null)return this.glyphCache[src];var glyph=this.getGlyph(src,name);this.glyphCache[src]=glyph;return glyph};goog.provide("trapeze.font.PDFGlyph");goog.require("trapeze.cos.COSStream");
trapeze.font.PDFGlyph=function(src,name,shape,advance){this.shape=shape;this.advance=advance;this.src=src;this.name=name};trapeze.font.PDFGlyph.prototype.render=function(graphics,engine){if(this.shape instanceof trapeze.cos.COSStream)console.warn("todo type3font");else if(this.shape.commands!=null)for(var i=0;i<this.shape.commands.length;i++){command=this.shape.commands[i];graphics[command[0]].apply(graphics,command[1])}return this.advance};trapeze.font.PDFGlyph.prototype.getChar=function(){return this.src};
goog.provide("trapeze.font.OutlineFont");goog.require("trapeze.font.PDFFont");goog.require("trapeze.font.PDFGlyph");
trapeze.font.OutlineFont=function(baseFont,fontObj,descriptor){trapeze.font.PDFFont.call(this,baseFont,descriptor);this.firstChar=-1;this.lastChar=-1;this.widths=null;var firstCharObj=fontObj.getDictionaryObject("FirstChar");var lastCharObj=fontObj.getDictionaryObject("LastChar");var widthArrayObj=fontObj.getDictionaryObject("Widths");if(firstCharObj!=null)this.firstChar=firstCharObj.value;if(lastCharObj!=null)this.lastChar=lastCharObj.value;if(widthArrayObj!=null){this.widths=[];var size=widthArrayObj.size();
for(var i=0;i<size;i++)this.widths[i]=widthArrayObj.get(i).value/1E3}};goog.inherits(trapeze.font.OutlineFont,trapeze.font.PDFFont);trapeze.font.OutlineFont.prototype.getGlyph=function(src,name){var outline=null;var width=this.getWidth(src,name);if(name!=null)outline=this.getOutlineByName(name,width);if(outline==null)outline=this.getOutlineByCode(src,width);var advance={"x":width,"y":0};return new trapeze.font.PDFGlyph(src,name,outline,advance)};
trapeze.font.OutlineFont.prototype.getWidth=function(code,name){var charCode=code.charCodeAt(0)&255;var idx=charCode-this.firstChar;if(idx<0||this.widths==null||idx>=this.widths.length)if(this.descriptor!=null)return this.descriptor.missingWidth;else return 0;return this.widths[idx]};trapeze.font.OutlineFont.prototype.getDefaultWidth=function(){return 1E3};goog.provide("trapeze.font.Type1Font");goog.require("trapeze.font.OutlineFont");goog.require("trapeze.font.PSParser");goog.require("trapeze.font.FontSupport");
goog.require("trapeze.StreamBuffer");goog.require("trapeze.GeneralPath");goog.require("trapeze.AffineTransform");
trapeze.font.Type1Font=function(baseFont,fontObj,descriptor){trapeze.font.OutlineFont.call(this,baseFont,fontObj,descriptor);this.name2width;this.char2name;this.password=0;this.at;this.subrs;this.lenIV;this.name2outline;this.stack=[];this.sloc=0;this.psStack=[];this.psLoc=0;this.callcount=0;if(descriptor!=null&&descriptor.fontFile!=null){var start=descriptor.fontFile.dictionary.getDictionaryObject("Length1").value;var len=descriptor.fontFile.dictionary.getDictionaryObject("Length2").value;var font=
new trapeze.StreamBuffer(descriptor.fontFile.decode());this.parseFontFromStream(font,start,len)}};goog.inherits(trapeze.font.Type1Font,trapeze.font.OutlineFont);
trapeze.font.Type1Font.prototype.parseFontFromStream=function(font,start,len){this.name2width={};var data=null;if(this.isASCII(font,start))throw"not done in type1font ascii";else data=trapeze.font.Type1Font.decrypt(font,start,start+len,55665,4);var fontArray=[];var i=0;while(font.hasRemaining()){font.setPosition(i);fontArray.push(font.getByteAt(i++))}this.chr2name=this.readEncoding(fontArray);var lenIVLoc=this.findSlashName(data,"lenIV");var psp=new trapeze.font.PSParser(data,0);if(lenIVLoc<0)this.lenIV=
4;else{psp.setLoc(lenIVLoc+6);this.lenIV=parseInt(psp.readThing())}this.password=4330;var matrixloc=this.findSlashName(fontArray,"FontMatrix");if(matrixloc<0){System.out.println("No FontMatrix!");this.at=new trapeze.AffineTransform(0.001,0,0,0.001,0,0)}else{var psp2=new trapeze.font.PSParser(fontArray,matrixloc+11);var xf=psp2.readArray(6);this.at=new trapeze.AffineTransform(xf[0],xf[1],xf[2],xf[3],xf[4],xf[5])}this.subrs=this.readArray(data,"Subrs","index");this.name2outline=this.readChars(data)};
trapeze.font.Type1Font.prototype.isASCII=function(data,start){for(var i=start;i<start+4;i++){var c=data.getByteAt(i);if(c>="0"&&c<="9")continue;else if(c>="a"&&c<="f")continue;else if(c>="A"&&c<="F")continue;else return false}};trapeze.font.Type1Font.prototype.readEncoding=function(d){var ary=this.readArray(d,"Encoding","def");return ary};
trapeze.font.Type1Font.prototype.readArray=function(d,key,end){var i=this.findSlashName(d,key);if(i<0)return[[]];var psp=new trapeze.font.PSParser(d,i);var type=psp.readThing();var val;type=psp.readThing();if(type=="StandardEncoding"){var stdenc=[];var length=trapeze.font.FontSupport.standardEncoding.length;for(i=0;i<length;i++)stdenc[i]=trapeze.font.FontSupport.getName(trapeze.font.FontSupport.standardEncoding[i]);return stdenc}var len=parseInt(type);var out=[];var line;while(true){var s=psp.readThing();
if(s=="dup"){var id=parseInt(psp.readThing());var elt=psp.readThing();line=getBytes(elt);if(isDigit(elt.charAt(0))){var hold=parseInt(elt);var special=psp.readThing();if(special=="-|"||special=="RD"){psp.setLoc(psp.getLoc()+1);line=psp.getNEncodedBytes(hold,this.password,this.lenIV)}}out[id]=line}else if(s==end)break}return out};
trapeze.font.Type1Font.prototype.findSlashName=function(d,name){var i;for(i=0;i<d.length;i++)if(d[i]=="/".charCodeAt(0)){var found=true;for(var j=0;j<name.length;j++)if(d[i+j+1]!=name.charCodeAt(j)){found=false;break}if(found)return i}return-1};
trapeze.font.Type1Font.prototype.readChars=function(d){var hm={};var i=this.findSlashName(d,"CharStrings");if(i<0)return hm;var psp=new trapeze.font.PSParser(d,i);while(true){var s=psp.readThing();var c=s.charAt(0);if(c=="/"){var len=parseInt(psp.readThing());var go=psp.readThing();if(go=="-|"||go=="RD"){psp.setLoc(psp.getLoc()+1);var line=psp.getNEncodedBytes(len,this.password,this.lenIV);hm[s.substring(1)]=line}}else if(s=="end")break}return hm};
trapeze.font.Type1Font.prototype.getWidth=function(code,name){debugger;if(this.firstChar==-1||this.lastChar==-1){var key=this.chr2name[toSignedByte(code)];if(name!=null)key=name;if(key!=null&&this.name2outline[key]!=null){if(this.name2width[key]==null)this.getOutlineByName(key,0);var width=this.name2width[key];if(width!=null)return width.x/this.getDefaultWidth()}return 0}return trapeze.font.Type1Font.superClass_.getWidth.call(this,code,name)};
trapeze.font.Type1Font.prototype.getOutlineByName=function(name,width){if(name==null||this.name2outline[name]==null)name=".notdef";var obj=this.name2outline[name];if(obj instanceof trapeze.GeneralPath)return obj;else{var cs=obj;var advance={};var gp=this.parseGlyph(cs,advance,this.at);if(width!=0&&advance.x!=0){var p={"x":advance.x,"y":advance.y};p=this.at.transform(p);var scale=width/p.x;var xform=trapeze.AffineTransform.getScaleInstance(scale,1);gp.transform(xform)}this.name2outline[name]=gp;this.name2width[name]=
advance;return gp}};trapeze.font.Type1Font.prototype.getOutlineByCode=function(src,width){return this.getOutlineByName(this.chr2name[toSignedByte(src)],width)};trapeze.font.Type1Font.prototype.parseGlyph=function(cs,advance,at){var gp=new trapeze.GeneralPath;var curpoint={"x":null,"y":null};this.sloc=0;this.parse(cs,gp,curpoint,advance);gp.transform(at);return gp};trapeze.font.Type1Font.prototype.pop=function(){var val=0;if(this.sloc>0)val=this.stack[--this.sloc];return val};
trapeze.font.Type1Font.prototype.buildAccentChar=function(x,y,a,b,gp){console.warn("build aaccent char not finished yet")};
trapeze.font.Type1Font.prototype.parse=function(cs,gp,pt,wid){var loc=0;var x1,x2,x3,y1,y2,y3;while(loc<cs.length){var v=cs[loc++]&255;if(v==255){this.stack[this.sloc++]=((cs[loc]&255)<<24)+((cs[loc+1]&255)<<16)+((cs[loc+2]&255)<<8)+(cs[loc+3]&255);loc+=4}else if(v>=251){this.stack[this.sloc++]=-(v-251<<8)-(cs[loc]&255)-108;loc++}else if(v>=247){this.stack[this.sloc++]=(v-247<<8)+(cs[loc]&255)+108;loc++}else if(v>=32)this.stack[this.sloc++]=v-139;else switch(v){case 0:throw new RuntimeException("Bad command ("+
v+")");case 1:this.sloc=0;break;case 2:throw new RuntimeException("Bad command ("+v+")");case 3:this.sloc=0;break;case 4:pt.y+=this.pop();gp.moveTo(pt.x,pt.y);this.sloc=0;break;case 5:pt.y+=this.pop();pt.x+=this.pop();gp.lineTo(pt.x,pt.y);this.sloc=0;break;case 6:pt.x+=this.pop();gp.lineTo(pt.x,pt.y);this.sloc=0;break;case 7:pt.y+=this.pop();gp.lineTo(pt.x,pt.y);this.sloc=0;break;case 8:y3=this.pop();x3=this.pop();y2=this.pop();x2=this.pop();y1=this.pop();x1=this.pop();gp.curveTo(pt.x+x1,pt.y+y1,
pt.x+x1+x2,pt.y+y1+y2,pt.x+x1+x2+x3,pt.y+y1+y2+y3);pt.x+=x1+x2+x3;pt.y+=y1+y2+y3;this.sloc=0;break;case 9:gp.closePath();this.sloc=0;break;case 10:var n=this.pop();if(this.subrs[n]==null)System.out.println("No subroutine #"+n);else{this.callcount++;if(this.callcount>10)System.out.println("Call stack too large");else this.parse(this.subrs[n],gp,pt,wid);this.callcount--}break;case 11:return;case 12:v=cs[loc++]&255;if(v==6){var b=this.pop();var a=this.pop();var y=this.pop();var x=this.pop();this.buildAccentChar(x,
y,a,b,gp);this.sloc=0}else if(v==7){wid.y=this.pop();wid.x=this.pop();pt.y=this.pop();pt.x=this.pop();this.sloc=0}else if(v==12){var b=this.pop();var a=this.pop();this.stack[this.sloc++]=a/b}else if(v==33){pt.y=this.pop();pt.x=this.pop();gp.moveTo(pt.x,pt.y);this.sloc=0}else if(v==0)this.sloc=0;else if(v==1)this.sloc=0;else if(v==2)this.sloc=0;else if(v==16){var cn=this.pop();var countargs=this.pop();switch(cn){case 0:this.psStack[this.psLoc++]=this.pop();this.psStack[this.psLoc++]=this.pop();this.pop();
break;case 3:this.psStack[this.psLoc++]=3;break;default:for(var i=0;i>countargs;i--)this.psStack[this.psLoc++]=this.pop();break}}else if(v==17){this.stack[this.sloc++]=this.psStack[this.psLoc-1];this.psLoc--}else throw new RuntimeException("Bad command ("+v+")");break;case 13:wid.x=this.pop();wid.y=0;pt.x=this.pop();pt.y=0;this.sloc=0;break;case 14:break;case 15:case 16:case 17:case 18:case 19:case 20:throw new RuntimeException("Bad command ("+v+")");case 21:pt.y+=this.pop();pt.x+=this.pop();gp.moveTo(pt.x,
pt.y);this.sloc=0;break;case 22:pt.x+=this.pop();gp.moveTo(pt.x,pt.y);this.sloc=0;break;case 23:case 24:case 25:case 26:case 27:case 28:case 29:throw new RuntimeException("Bad command ("+v+")");case 30:x3=this.pop();y2=this.pop();x2=this.pop();y1=this.pop();x1=y3=0;gp.curveTo(pt.x,pt.y+y1,pt.x+x2,pt.y+y1+y2,pt.x+x2+x3,pt.y+y1+y2);pt.x+=x2+x3;pt.y+=y1+y2;this.sloc=0;break;case 31:y3=this.pop();y2=this.pop();x2=this.pop();x1=this.pop();y1=x3=0;gp.curveTo(pt.x+x1,pt.y,pt.x+x1+x2,pt.y+y2,pt.x+x1+x2,pt.y+
y2+y3);pt.x+=x1+x2;pt.y+=y2+y3;this.sloc=0;break}}};trapeze.font.Type1Font.decrypt=function(d,start,end,key,skip){if(end-start-skip<0)skip=0;var o=[];var r=key;var ipos;var c1=52845;var c2=22719;for(ipos=start;ipos<end;ipos++){var c;if(d instanceof trapeze.StreamBuffer)c=d.getByteAt(ipos)&255;else c=d[ipos]&255;var p=(c^r>>8)&255;r=(c+r)*c1+c2&65535;if(ipos-start-skip>=0){if(p>127)p=p-256;else p=p;o[ipos-start-skip]=p}}return o};goog.provide("trapeze.font.PSParser");goog.require("trapeze.font.Type1Font");
trapeze.font.PSParser=function(data,start){this.data=data;this.loc=start;this.readThing=function(){while(this.isWhiteSpace(data[this.loc]))this.loc++;var start=this.loc;var s="";while(!this.isWhiteSpace(data[this.loc])){s+=String.fromCharCode(data[this.loc]);this.loc++;if(!this.isRegularCharacter(data[this.loc]))break}return s};this.readArray=function(count){var ary=[];var idx=0;while(idx<count){var thing=this.readThing();if(thing.charAt(0)=="[")thing=thing.substring(1);if(thing.charAt(thing.length-
1)=="]")thing=thing.substring(0,thing.length-1);if(thing.length>0)ary[idx++]=parseFloat(thing)}return ary};this.getLoc=function(){return this.loc};this.setLoc=function(loc){this.loc=loc};this.getNEncodedBytes=function(n,key,skip){var result=trapeze.font.Type1Font.decrypt(this.data,this.loc,this.loc+n,key,skip);this.loc+=n;return result};this.isRegularCharacter=function(c){return!(this.isWhiteSpace(c)||this.isDelimiter(c))};this.isDelimiter=function(c){c=String.fromCharCode(c);switch(c){case "(":case ")":case "<":case ">":case "[":case "]":case "{":case "}":case "/":case "%":return true;
default:return false}};this.isWhiteSpace=function(c){c=String.fromCharCode(c);switch(c){case "\t":case "\n":case "\r":case " ":return true;default:return false}}};goog.provide("trapeze.font.BuiltInFont");goog.require("trapeze.font.PDFFontDescriptor");goog.require("trapeze.font.Type1Font");goog.require("trapeze.font.BaseFontMap");goog.require("trapeze.StreamBuffer");
trapeze.font.BuiltInFont=function(baseFont,fontObj,descriptor){trapeze.font.Type1Font.call(this,baseFont,fontObj,descriptor);var fontName=descriptor.fontName;for(var i=0;i<trapeze.font.BuiltInFont.baseFonts.length;i++)if(fontName.toLowerCase()==trapeze.font.BuiltInFont.baseFonts[i].toLowerCase()){this.parseFont(fontName);return}for(var i=0;i<trapeze.font.BuiltInFont.mappedFonts.length;i+=2)if(fontName.toLowerCase()==trapeze.font.BuiltInFont.mappedFonts[i].toLowerCase()){this.parseFont(trapeze.font.BuiltInFont.mappedFonts[i+
1]);return}var flags=descriptor.flags;var style=(flags&trapeze.font.PDFFontDescriptor.FORCEBOLD)!=0?trapeze.font.PDFFontDescriptor.BOLD:trapeze.font.PDFFontDescriptor.PLAIN;if(fontName.indexOf("Bold")>0)style|=trapeze.font.PDFFontDescriptor.BOLD;if(descriptor.italicAngle!=0||(flags&trapeze.font.PDFFontDescriptor.NONSYMBOLIC)!=0)style|=trapeze.font.PDFFontDescriptor.ITALIC;var name=null;if((flags&trapeze.font.PDFFontDescriptor.FIXED_PITCH)!=0)if((style&trapeze.font.PDFFontDescriptor.BOLD)>0&&(style&
trapeze.font.PDFFontDescriptor.ITALIC)>0)name="Courier-BoldOblique";else if((style&trapeze.font.PDFFontDescriptor.BOLD)>0)name="Courier-Bold";else if((style&trapeze.font.PDFFontDescriptor.ITALIC)>0)name="Courier-Oblique";else name="Courier";else if((flags&trapeze.font.PDFFontDescriptor.SERIF)!=0)if((style&trapeze.font.PDFFontDescriptor.BOLD)>0&&(style&trapeze.font.PDFFontDescriptor.ITALIC)>0)name="Times-BoldItalic";else if((style&trapeze.font.PDFFontDescriptor.BOLD)>0)name="Times-Bold";else if((style&
trapeze.font.PDFFontDescriptor.ITALIC)>0)name="Times-Italic";else name="Times-Roman";else if((style&trapeze.font.PDFFontDescriptor.BOLD)>0&&(style&trapeze.font.PDFFontDescriptor.ITALIC)>0)name="Helvetica-BoldOblique";else if((style&trapeze.font.PDFFontDescriptor.BOLD)>0)name="Helvetica-Bold";else if((style&trapeze.font.PDFFontDescriptor.ITALIC)>0)name="Helvetica-Oblique";else name="Helvetica";this.parseFont(name)};goog.inherits(trapeze.font.BuiltInFont,trapeze.font.Type1Font);
trapeze.font.BuiltInFont.fontStreamCache={};trapeze.font.BuiltInFont.prototype.getFontStream=function(file){if(trapeze.font.BuiltInFont.fontStreamCache[file]!=null)return trapeze.font.BuiltInFont.fontStreamCache[file].subStream(0);var stream=trapeze.StreamBuffer.createFromUrl("../external/fonts/"+file);trapeze.font.BuiltInFont.fontStreamCache[file]=stream;return stream};
trapeze.font.BuiltInFont.prototype.parseFont=function(baseFont){var props=trapeze.font.BaseFontMap;if(props[baseFont]==null)throw new IllegalArgumentException("Unknown Base Font: "+baseFont);var file=props[baseFont]["file"];var length=props[baseFont]["length"];var length1=0;var length2=0;var data=this.getFontStream(file);if((data.getByteAt(0)&255)==128){length1=data.getByteAt(2)&255;length1|=(data.getByteAt(3)&255)<<8;length1|=(data.getByteAt(4)&255)<<16;length1|=(data.getByteAt(5)&255)<<24;length1+=
6;length2=data.getByteAt(length1+2)&255;length2|=(data.getByteAt(length1+3)&255)<<8;length2|=(data.getByteAt(length1+4)&255)<<16;length2|=(data.getByteAt(length1+5)&255)<<24;length1+=6}else throw"Builtin font read from prop file not implemented";this.parseFontFromStream(data,length1,length2)};
trapeze.font.BuiltInFont.baseFonts=["Courier","Courier-Bold","Courier-BoldOblique","Courier-Oblique","Helvetica","Helvetica-Bold","Helvetica-BoldOblique","Helvetica-Oblique","Times-Roman","Times-Bold","Times-BoldItalic","Times-Italic","Symbol","ZapfDingbats"];
trapeze.font.BuiltInFont.mappedFonts=["Arial","Helvetica","Arial,Bold","Helvetica-Bold","Arial,BoldItalic","Helvetica-BoldOblique","Arial,Italic","Helvetica-Oblique","TimesNewRoman","Times-Roman","TimesNewRoman,Bold","Times-Bold","TimesNewRoman,BoldItalic","Times-BoldItalic","TimesNewRoman,Italic","Times-Italic"];goog.provide("trapeze.font.AdobeGlyphList");goog.require("trapeze.StreamBuffer");trapeze.font.AdobeGlyphList=function(){};trapeze.font.AdobeGlyphList.glyphToUnicodes=null;
trapeze.font.AdobeGlyphList.unicodeToGlyph=null;trapeze.font.AdobeGlyphList.getGlyphNameIndex=function(glyphName){var unicodes=trapeze.font.AdobeGlyphList.getUnicodeValues(glyphName);if(unicodes==null)return null;else return unicodes[0]};trapeze.font.AdobeGlyphList.getUnicodeValues=function(glyphName){trapeze.font.AdobeGlyphList.intialize();return trapeze.font.AdobeGlyphList.glyphToUnicodes[glyphName]};
trapeze.font.AdobeGlyphList.intialize=function(){if(trapeze.font.AdobeGlyphList.glyphToUnicodes!=null)return;trapeze.font.AdobeGlyphList.glyphToUnicodes={};trapeze.font.AdobeGlyphList.unicodeToGlyph={};var reader=trapeze.StreamBuffer.createFromUrl("../external/fonts/glyphlist.txt");while(reader.hasRemaining()){var unicodes=[];var line=reader.readLine();line=line.replace(/\s+$/,"");if(line!=""&&line.charAt(0)!="#"){var tokens=line.split(";");var glyphName=tokens[0];var unicodes=tokens[1].split(" ");
var codes=new Array(unicodes.length);for(var i=0;i<unicodes.length;i++){codes[i]=parseInt(unicodes[i],16);trapeze.font.AdobeGlyphList.unicodeToGlyph[codes[i]]=glyphName}trapeze.font.AdobeGlyphList.glyphToUnicodes[glyphName]=codes}}};goog.provide("trapeze.font.GlyfCompound");trapeze.font.GlyfCompound=function(){this._components;this._instructions};trapeze.font.GlyfCompound.ARG_1_AND_2_ARE_WORDS=1;trapeze.font.GlyfCompound.ARGS_ARE_XY_VALUES=2;trapeze.font.GlyfCompound.ROUND_XY_TO_GRID=4;
trapeze.font.GlyfCompound.WE_HAVE_A_SCALE=8;trapeze.font.GlyfCompound.MORE_COMPONENTS=32;trapeze.font.GlyfCompound.WE_HAVE_AN_X_AND_Y_SCALE=64;trapeze.font.GlyfCompound.WE_HAVE_A_TWO_BY_TWO=128;trapeze.font.GlyfCompound.WE_HAVE_INSTRUCTIONS=256;trapeze.font.GlyfCompound.USE_MY_METRICS=512;trapeze.font.GlyfCompound.OVERLAP_COMPOUND=1024;
trapeze.font.GlyfCompound.prototype.setData=function(data){var comps=[];var cur=null;var hasInstructions=false;do{cur=new GlyfComponent;cur.flags=data.getShort();cur.glyphIndex=data.getShort();if((cur.flags&trapeze.font.GlyfCompound.ARG_1_AND_2_ARE_WORDS)!=0&&(cur.flags&trapeze.font.GlyfCompound.ARGS_ARE_XY_VALUES)!=0){cur.e=data.getShort();cur.f=data.getShort()}else if(!((cur.flags&trapeze.font.GlyfCompound.ARG_1_AND_2_ARE_WORDS)!=0)&&(cur.flags&trapeze.font.GlyfCompound.ARGS_ARE_XY_VALUES)!=0){cur.e=
data.get();cur.f=data.get()}else if((cur.flags&trapeze.font.GlyfCompound.ARG_1_AND_2_ARE_WORDS)!=0&&!((cur.flags&trapeze.font.GlyfCompound.ARGS_ARE_XY_VALUES)!=0)){cur.compoundPoint=data.getShort();cur.componentPoint=data.getShort()}else{cur.compoundPoint=data.get();cur.componentPoint=data.get()}if((cur.flags&trapeze.font.GlyfCompound.WE_HAVE_A_SCALE)!=0){cur.a=data.getShort()/(1<<14);cur.d=cur.a}else if((cur.flags&trapeze.font.GlyfCompound.WE_HAVE_AN_X_AND_Y_SCALE)!=0){cur.a=data.getShort()/(1<<
14);cur.d=data.getShort()/(1<<14)}else if((cur.flags&trapeze.font.GlyfCompound.WE_HAVE_A_TWO_BY_TWO)!=0){cur.a=data.getShort()/(1<<14);cur.b=data.getShort()/(1<<14);cur.c=data.getShort()/(1<<14);cur.d=data.getShort()/(1<<14)}if((cur.flags&trapeze.font.GlyfCompound.WE_HAVE_INSTRUCTIONS)!=0)hasInstructions=true;comps.push(cur)}while((cur.flags&trapeze.font.GlyfCompound.MORE_COMPONENTS)!=0);this._components=comps;var instr=null;if(hasInstructions){var numInstructions=data.getShort();instr=new Array(numInstructions);
for(var i=0;i<numInstructions;i++)instr[i]=data.get()}else instr=[];this._instructions=instr};trapeze.font.GlyfCompound.prototype.getNumComponents=function(){return this._components.length};trapeze.font.GlyfCompound.prototype.getGlyphIndex=function(index){return this._components[index].glyphIndex};
trapeze.font.GlyfCompound.prototype.getTransform=function(index){var gc=this._components[index];var m=Math.max(Math.abs(gc.a),Math.abs(gc.b));if(Math.abs(Math.abs(gc.a)-Math.abs(gc.c))<33/65536)m*=2;var n=Math.max(Math.abs(gc.c),Math.abs(gc.d));if(Math.abs(Math.abs(gc.c)-Math.abs(gc.d))<33/65536)n*=2;var e=m*gc.e;var f=n*gc.f;return[gc.a,gc.b,gc.c,gc.d,e,f]};function GlyfComponent(){}goog.provide("trapeze.font.GlyfSimple");
trapeze.font.GlyfSimple=function(){this.setData=function(data){var contourEndPoints=[];for(var i=0;i<this.numContours;i++)contourEndPoints[i]=data.getShort();this.contourEndPoints=contourEndPoints;var numPoints=this.contourEndPoints[this.numContours-1]+1;var numInstructions=data.getShort();var instructions=[];for(var i=0;i<numInstructions;i++)instructions[i]=data.get();this.instructions=instructions;var flags=[];for(var i=0;i<numPoints;i++){flags[i]=data.get();if((flags[i]&8)!=0){var f=flags[i];var n=
data.get()&255;for(var c=0;c<n;c++)flags[++i]=f}}this.flags=flags;var xCoords=[];for(var i=0;i<numPoints;i++)xCoords[i]=0;for(var i=0;i<numPoints;i++){if(i>0)xCoords[i]=xCoords[i-1];if(this.xIsByte(i)){var val=data.get()&255;if(!this.xIsSame(i))val=-val;xCoords[i]+=val}else if(!this.xIsSame(i))xCoords[i]+=data.getShort()}this.xCoords=xCoords;var yCoords=[];for(var i=0;i<numPoints;i++)yCoords[i]=0;for(var i=0;i<numPoints;i++){if(i>0)yCoords[i]=yCoords[i-1];if(this.yIsByte(i)){var val=data.get()&255;
if(!this.yIsSame(i))val=-val;yCoords[i]+=val}else if(!this.yIsSame(i))yCoords[i]+=data.getShort()}this.yCoords=yCoords};this.xIsByte=function(pointIndex){return(this.flags[pointIndex]&2)!=0};this.yIsByte=function(pointIndex){return(this.flags[pointIndex]&4)!=0};this.xIsSame=function(pointIndex){return(this.flags[pointIndex]&16)!=0};this.yIsSame=function(pointIndex){return(this.flags[pointIndex]&32)!=0};this.getNumPoints=function(){return this.flags.length};this.getContourEndPoint=function(index){return this.contourEndPoints[index]};
this.getXCoord=function(pointIndex){return this.xCoords[pointIndex]};this.getYCoord=function(pointIndex){return this.yCoords[pointIndex]};this.onCurve=function(pointIndex){return(this.flags[pointIndex]&1)!=0}};goog.provide("trapeze.font.CMapFormat0");trapeze.font.CMapFormat0=function(languange){this.glyphIndex};
trapeze.font.CMapFormat0.prototype.setData=function(length,data){if(length!=262)throw new IllegalArgumentException("Bad length for CMap format 0");var pos=data.getPosition();this.glyphIndex=data};trapeze.font.CMapFormat0.prototype.map=function(src){var i=src.charCodeAt(0)&255;return this.glyphIndex.getByteAt(i+6)};goog.provide("trapeze.font.CMapFormat4");
trapeze.font.CMapFormat4=function(languange){this.glyphIndex;this.segments={_keys:[],_items:[],remove:function(o){var length=this._keys.length;for(var i=0;i<length;i++)if(this._keys[i].equals(o)){this._keys.splice(i);this.splice(i);break}},put:function(key,value){this._keys.push(key);this._items.push(value)},get:function(index){return[this._keys[index],this._items[index]]},size:function(){return this._keys.length}}};
trapeze.font.CMapFormat4.prototype.addSegmentWithDelta=function(startCode,endCode,idDelta){var s=new Segment(startCode,endCode,false);this.segments.remove(s);this.segments.put(s,idDelta)};trapeze.font.CMapFormat4.prototype.addSegmentWithMap=function(startCode,endCode,map){if(map.length!=endCode-startCode+1)throw new IllegalArgumentException("Wrong number of entries in map");var s=new Segment(startCode,endCode,true);this.segments.remove(s);this.segments.put(s,map)};
trapeze.font.CMapFormat4.prototype.setData=function(length,data){var segCount=data.getShort()/2;var searchRange=data.getShort();var entrySelector=data.getShort();var rangeShift=data.getShort();var endCodes=new Array(segCount);var startCodes=new Array(segCount);var idDeltas=new Array(segCount);var idRangeOffsets=new Array(segCount);var glyphArrayPos=16+8*segCount;for(var i=0;i<segCount;i++)endCodes[i]=data.getShort();data.getShort();for(var i=0;i<segCount;i++)startCodes[i]=data.getShort();for(var i=
0;i<segCount;i++)idDeltas[i]=data.getShort();for(var i=0;i<segCount;i++){idRangeOffsets[i]=data.getShort();if(idRangeOffsets[i]<=0)this.addSegmentWithDelta(startCodes[i],endCodes[i],idDeltas[i]);else{var offset=data.getPosition()-2+idRangeOffsets[i];var size=endCodes[i]-startCodes[i]+1;var map=new Array(size);var oldOffset=data.getPosition();for(var c=0;c<size;c++){data.setPosition(offset+c*2);map[c]=data.getChar().charCodeAt(0)}data.setPosition(oldOffset);this.addSegmentWithMap(startCodes[i],endCodes[i],
map)}}};trapeze.font.CMapFormat4.prototype.map=function(src){if(typeof src=="string")src=src.charCodeAt(0);var size=this.segments.size();for(var i=0;i<size;i++){var keyValue=this.segments.get(i);var s=keyValue[0];var value=keyValue[1];if(s.endCode>=src)if(s.startCode<=src)if(s.hasMap){var map=value;return map[src-s.startCode]}else{var idDelta=value;return src+idDelta}else return 0}return 0};
function Segment(startCode,endCode,hasMap){this.endCode=65535&endCode;this.startCode=65535&startCode;this.hasMap=hasMap}Segment.prototype.equals=function(o){return this.compareTo(o)==0};Segment.prototype.compareTo=function(o){if(!(o instanceof Segment))return-1;var s=o;if(s.endCode>=this.startCode&&s.endCode<=this.endCode||s.startCode>=this.startCode&&s.startCode<=this.endCode)return 0;if(this.endCode>s.endCode)return 1;else if(this.endCode<s.endCode)return-1;else return 0};goog.provide("trapeze.font.CMap");
goog.require("trapeze.font.CMapFormat4");goog.require("trapeze.font.CMapFormat0");trapeze.font.CMap=function(){};trapeze.font.CMap.getMap=function(data){var format=data.getShort();var length=data.getShort();data=data.subStream(0,Math.min(data.getLimit(),length));data.setPosition(4);var language=data.getShort();var outMap=this.createMap(format,language);if(outMap==null)return null;outMap.setData(data.getLimit(),data);return outMap};
trapeze.font.CMap.createMap=function(format,language){var outMap=null;switch(format){case 0:outMap=new trapeze.font.CMapFormat0(language);break;case 4:outMap=new trapeze.font.CMapFormat4(language);break;default:throw"not done with any other CMaps";}return outMap};goog.provide("trapeze.font.CmapTable");goog.require("trapeze.font.CMap");
trapeze.font.CmapTable=function(){this.subTables={};this.setVersion=function(version){this.version=version};this.setData=function(data){this.setVersion(data.getShort());var numberSubtables=data.getShort();for(var i=0;i<numberSubtables;i++){var platformID=data.getShort();var platformSpecificID=data.getShort();var offset=data.getInt();var mapData=data.subStream(offset);var cMap=trapeze.font.CMap.getMap(mapData);if(cMap!=null)this.addCMap(platformID,platformSpecificID,cMap)}};this.addCMap=function(platformID,
platformSpecificID,cMap){this.subTables[""+platformID+platformSpecificID]=cMap};this.getCMaps=function(){var ret=[];for(var prop in this.subTables)if(this.subTables.hasOwnProperty(prop))ret.push(this.subTables[prop]);return ret};this.getCMap=function(platformID,platformSpecificID){return this.subTables[""+platformID+platformSpecificID]}};goog.provide("trapeze.font.Glyf");goog.require("trapeze.font.GlyfSimple");goog.require("trapeze.font.GlyfCompound");trapeze.font.Glyf=function(){};
trapeze.font.Glyf.getGlyf=function(data){var numContours=data.getShort();var g=null;if(numContours==0)g=new trapeze.font.Glyf;else if(numContours==-1)g=new trapeze.font.GlyfCompound;else if(numContours>0)g=new trapeze.font.GlyfSimple;else throw new IllegalArgumentException("Unknown glyf type: "+numContours);g.numContours=numContours;g.minX=data.getShort();g.minY=data.getShort();g.maxX=data.getShort();g.maxY=data.getShort();g.setData(data);return g};goog.provide("trapeze.font.GlyfTable");goog.require("trapeze.font.Glyf");
goog.require("trapeze.StreamBuffer");
trapeze.font.GlyfTable=function(ttf){this.loca=ttf.getTable("loca");this.maxp=ttf.getTable("maxp");var numGlyphs=this.maxp.numGlyphs;this.glyfs=[];this.setData=function(data){for(var i=0;i<numGlyphs;i++){var location=this.loca.offsets[i];var length=this.loca.getSize(i);if(length==0)continue;this.glyfs[i]=data.subStream(location,length)}};this.getGlyph=this.getGlyf=function(index){var o=this.glyfs[index];if(o==null)return null;if(o instanceof trapeze.StreamBuffer){var g=trapeze.font.Glyf.getGlyf(o);
this.glyfs[index]=g;return g}else return o}};goog.provide("trapeze.font.HeadTable");
trapeze.font.HeadTable=function(){this.setData=function(data){this.version=data.getInt();this.fontRevision=data.getInt();this.checksumAdjustment=data.getInt();this.magicNumber=data.getInt();this.flags=data.getShort();this.unitsPerEm=data.getShort();this.created=data.getLong();this.modified=data.getLong();this.xMin=data.getShort();this.xMax=data.getShort();this.yMin=data.getShort();this.yMax=data.getShort();this.macStyle=data.getShort();this.lowestRecPPem=data.getShort();this.fontDirectionHint=data.getShort();
this.indexToLocFormat=data.getShort();this.glyphDataFormat=data.getShort()}};goog.provide("trapeze.font.HheaTable");
trapeze.font.HheaTable=function(){this.setData=function(data){this.version=data.getInt();this.ascent=data.getShort();this.descent=data.getShort();this.lineGap=data.getShort();this.advanceWidthMax=data.getShort();this.minLeftSideBearing=data.getShort();this.minRightSideBearing=data.getShort();this.xMaxExtent=data.getShort();this.caretSlopeRise=data.getShort();this.caretSlopeRun=data.getShort();this.caretOffset=data.getShort();data.getShort();data.getShort();data.getShort();data.getShort();this.metricDataFormat=
data.getShort();this.numOfLongHorMetrics=data.getShort()}};goog.provide("trapeze.font.HmtxTable");
trapeze.font.HmtxTable=function(ttf){var maxp=ttf.getTable("maxp");var numGlyphs=maxp.numGlyphs;var hhea=ttf.getTable("hhea");var numOfLongHorMetrics=hhea.numOfLongHorMetrics;this.advanceWidths=[];this.leftSideBearings=[];this.setData=function(data){var i;for(i=0;i<numGlyphs&&data.hasRemaining();i++){if(i<numOfLongHorMetrics)this.advanceWidths[i]=data.getShort();this.leftSideBearings[i]=data.getShort()}if(i<numOfLongHorMetrics)for(var j=i;j<numOfLongHorMetrics;j++)this.advanceWidths[i]=0;if(i<numGlyphs)for(var j=
i;j<numGlyphs;j++)this.leftSideBearings[i]=0};this.getAdvance=function(glyphID){if(glyphID<this.advanceWidths.length)return this.advanceWidths[glyphID];else return this.advanceWidths[this.advanceWidths.length-1]}};goog.provide("trapeze.font.LocaTable");
trapeze.font.LocaTable=function(ttf){var maxp=ttf.getTable("maxp");var numGlyphs=maxp.numGlyphs;var head=ttf.getTable("head");var format=head.indexToLocFormat;this.isLong=format==1;this.offsets=[];this.setData=function(data){for(var i=0;i<numGlyphs+1;i++)if(this.isLong)this.offsets[i]=data.getInt();else this.offsets[i]=2*(65535&data.getShort())};this.getSize=function(glyphID){return this.offsets[glyphID+1]-this.offsets[glyphID]}};goog.provide("trapeze.font.MaxpTable");
trapeze.font.MaxpTable=function(){this.setData=function(data){this.version=data.getInt();this.numGlyphs=data.getShort();this.maxPoints=data.getShort();this.maxContours=data.getShort();this.maxComponentPoints=data.getShort();this.maxComponentContours=data.getShort();this.axZones=data.getShort();this.maxTwilightPoints=data.getShort();this.maxStorage=data.getShort();this.maxFunctionDefs=data.getShort();this.maxInstructionDefs=data.getShort();this.maxStackElements=data.getShort();this.maxSizeOfInstructions=
data.getShort();this.maxComponentElements=data.getShort();this.maxComponentDepth=data.getShort()}};goog.provide("trapeze.font.PostTable");trapeze.font.PostTable=function(){this._nameMap};
trapeze.font.PostTable.prototype.setData=function(data){this.format=data.getInt();this.italicAngle=data.getInt();this.underlinePosition=data.getShort();this.underlineThickness=data.getShort();this.isFixedPitch=data.getShort();data.getShort();this.minMemType42=data.getInt();this.maxMemType42=data.getInt();this.minMemType1=data.getInt();this.maxMemType1=data.getInt();switch(this.format){case 65536:this._nameMap=new PostMapFormat0;break;case 131072:this._nameMap=new PostMapFormat2;break;case 196608:this._nameMap=
new PostMap;break;default:this._nameMap=new PostMap;System.out.println("Unknown post map type: "+Integer.toHexString(format));break}this._nameMap.setData(data)};trapeze.font.PostTable.prototype.getGlyphNameIndex=function(name){return this._nameMap.getCharIndex(name)};function PostMap(){}PostMap.prototype.getCharIndex=function(charName){return 0};PostMap.prototype.getCharName=function(charIndex){return null};PostMap.prototype.getLength=function(){return 0};PostMap.prototype.getData=function(){return ByteBuffer.allocate(0)};
PostMap.prototype.setData=function(data){return};function PostMapFormat0(){PostMapFormat0.baseConstructor.call(this)}extend(PostMapFormat0,PostMap);
PostMapFormat0.stdNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","ackslash","bracketright","asciicircum",
"underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis",
"dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE",
"oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring",
"cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];
PostMapFormat0.prototype.getCharIndex=function(charName){var length=PostMapFormat0.stdNames.length;for(var i=0;i<length;i++)if(charName==PostMapFormat0.stdNames[i])return i;return 0};PostMapFormat0.prototype.getCharName=function(charIndex){return PostMapFormat0.stdNames[charIndex]};PostMapFormat0.prototype.getLength=function(){return 0};PostMapFormat0.prototype.getData=function(){return ByteBuffer.allocate(0)};PostMapFormat0.prototype.setData=function(data){return};
function PostMapFormat2(){PostMapFormat2.baseConstructor.call(this);this.glyphNameIndex;this.glyphNames}extend(PostMapFormat2,PostMapFormat0);
PostMapFormat2.prototype.getCharIndex=function(charName){var idx=-1;var glyphNamesLength=this.glyphNames.length;for(var i=0;i<glyphNamesLength;i++)if(charName==this.glyphNames[i]){idx=PostMapFormat0.stdNames.length+i;break}if(idx==-1)idx=PostMapFormat2.superClass.getCharIndex.call(this,charName);var glyphNameIndexLength=this.glyphNameIndex.length;for(var c=0;c<glyphNameIndexLength;c++)if(this.glyphNameIndex[c]==idx)return c;return 0};
PostMapFormat2.prototype.getCharName=function(charIndex){if(charIndex>=PostMapFormat0.stdNames.length)return this.glyphNames[charIndex-PostMapFormat0.stdNames.length];return PostMapFormat2.superClass.getCharName(charIndex)};PostMapFormat2.prototype.getLength=function(){var size=2+2*this.glyphNameIndex.length;var glyphNamesLength=this.glyphNames.length;for(var i=0;i<glyphNamesLength;i++)size+=this.glyphNames[i].length+1;return size};
PostMapFormat2.prototype.setData=function(data){var numGlyphs=data.getShort();this.glyphNameIndex=new Array(numGlyphs);var maxGlyph=257;for(var i=0;i<numGlyphs;i++){this.glyphNameIndex[i]=data.getShort();if(this.glyphNameIndex[i]>maxGlyph)maxGlyph=this.glyphNameIndex[i]}maxGlyph-=257;this.glyphNames=new Array(maxGlyph);for(var i=0;i<maxGlyph;i++){var size=data.get();var glyphName="";for(var j=0;j<size;j++)glyphName+=String.fromCharCode(data.get());this.glyphNames[i]=glyphName}};goog.provide("trapeze.font.TrueTypeTable");
goog.require("trapeze.font.PostTable");goog.require("trapeze.font.MaxpTable");goog.require("trapeze.font.LocaTable");goog.require("trapeze.font.HmtxTable");goog.require("trapeze.font.HheaTable");goog.require("trapeze.font.HeadTable");goog.require("trapeze.font.GlyfTable");goog.require("trapeze.font.CmapTable");trapeze.font.TrueTypeTable=function(){};
trapeze.font.TrueTypeTable.createTable=function(ttf,tagString,data){var outTable=null;switch(tagString){case "cmap":outTable=new trapeze.font.CmapTable;break;case "glyf":outTable=new trapeze.font.GlyfTable(ttf);break;case "head":outTable=new trapeze.font.HeadTable;break;case "hhea":outTable=new trapeze.font.HheaTable;break;case "hmtx":outTable=new trapeze.font.HmtxTable(ttf);break;case "loca":outTable=new trapeze.font.LocaTable(ttf);break;case "maxp":outTable=new trapeze.font.MaxpTable;break;case "name":outTable=
new NameTable;break;case "post":outTable=new trapeze.font.PostTable;break;default:outTable=new trapeze.font.TrueTypeTable(tag);break}if(data!=null)outTable.setData(data);return outTable};goog.provide("trapeze.font.TrueTypeFont");goog.require("trapeze.font.TrueTypeTable");goog.require("trapeze.StreamBuffer");
trapeze.font.TrueTypeFont=function(type){this.tables={};this.type=type;this.parseDirectories=function(data,numTables){for(var i=0;i<numTables;i++){var tagString=data.read(4);var checksum=data.getInt();var offset=data.getInt();var length=data.getInt();var tableData=data.subStream(offset,length);this.tables[tagString]=tableData}};this.getTable=function(tagString){var table=this.tables[tagString];if(table==null)return null;if(table instanceof trapeze.StreamBuffer){table=trapeze.font.TrueTypeTable.createTable(this,
tagString,table);this.tables[tagString]=table;return table}else return table}};trapeze.font.TrueTypeFont.parseFont=function(stream){var buffer=new trapeze.StreamBuffer(stream,true);var type=buffer.getInt();var numTables=buffer.getShort();var searchRange=buffer.getShort();var entrySelector=buffer.getShort();var rangeShift=buffer.getShort();var font=new trapeze.font.TrueTypeFont(type);font.parseDirectories(buffer,numTables);return font};goog.provide("trapeze.font.TTFFont");goog.require("trapeze.font.OutlineFont");
goog.require("trapeze.font.TrueTypeFont");goog.require("trapeze.font.AdobeGlyphList");goog.require("trapeze.font.GlyfSimple");goog.require("trapeze.font.GlyfCompound");goog.require("trapeze.GeneralPath");goog.require("trapeze.AffineTransform");
trapeze.font.TTFFont=function(baseFont,fontObj,descriptor){trapeze.font.TTFFont.baseConstructor.call(this,baseFont,fontObj,descriptor);this.font;this.unitsPerEm;var ttfObj=descriptor.fontFile2;if(ttfObj!=null){this.font=trapeze.font.TrueTypeFont.parseFont(ttfObj.decode());var head=this.font.getTable("head");this.unitsPerEm=head.unitsPerEm}else this.font=null};extend(trapeze.font.TTFFont,trapeze.font.OutlineFont);
trapeze.font.TTFFont.prototype.getOutlineByName=function(name,width){var idx;var postTable=this.font.getTable("post");if(postTable!=null){idx=postTable.getGlyphNameIndex(name);if(idx!=0)return this.getOutlineById(idx,width);return null}var res=trapeze.font.AdobeGlyphList.getGlyphNameIndex(name);if(res!=null){idx=res;return this.getOutlineFromCMaps(idx,width)}return null};
trapeze.font.TTFFont.prototype.getOutlineByCode=function(src,width){var cmap=this.font.getTable("cmap");var maps=cmap.getCMaps();for(var i=0;i<maps.length;i++){var idx=maps[i].map(src);if(idx!=0)return this.getOutlineById(idx,width)}return this.getOutlineById(0,width)};
trapeze.font.TTFFont.prototype.getOutlineById=function(glyphId,width){var glyf=this.font.getTable("glyf");var g=glyf.getGlyf(glyphId);var gp=null;if(g instanceof trapeze.font.GlyfSimple)gp=this.renderSimpleGlyph(g);else if(g instanceof trapeze.font.GlyfCompound)gp=this.renderCompoundGlyph(glyf,g);else gp=new trapeze.GeneralPath;var hmtx=this.font.getTable("hmtx");var advance=hmtx.getAdvance(glyphId)/this.unitsPerEm;var widthfactor=width/advance;var at=trapeze.AffineTransform.getScaleInstance(1/this.unitsPerEm,
1/this.unitsPerEm);at=at.multiply(trapeze.AffineTransform.getScaleInstance(widthfactor,1));gp.transform(at);return gp};trapeze.font.TTFFont.prototype.getOutlineFromCMaps=function(val,width){var cmap=this.font.getTable("cmap");if(cmap==null)return null;var map=cmap.getCMap(3,1);if(map==null)map=cmap.getCMap(1,0);var idx=map.map(val);if(idx!=0)return this.getOutlineById(idx,width);return null};
trapeze.font.TTFFont.prototype.renderSimpleGlyph=function(g){var curContour=0;var rs=new RenderState;rs.gp=new trapeze.GeneralPath;for(var i=0;i<g.getNumPoints();i++){var rec=new PointRec(g,i);if(rec.onCurve)this.addOnCurvePoint(rec,rs);else this.addOffCurvePoint(rec,rs);if(i==g.getContourEndPoint(curContour)){curContour++;if(rs.firstOff!=null)this.addOffCurvePoint(rs.firstOff,rs);if(rs.firstOn!=null)this.addOnCurvePoint(rs.firstOn,rs);rs.firstOn=null;rs.firstOff=null;rs.prevOff=null}}return rs.gp};
trapeze.font.TTFFont.prototype.renderCompoundGlyph=function(glyf,g){var gp=new trapeze.GeneralPath;for(var i=0;i<g.getNumComponents();i++){var gs=glyf.getGlyph(g.getGlyphIndex(i));var path=this.renderSimpleGlyph(gs);var matrix=g.getTransform(i);path.transform(new trapeze.AffineTransform(matrix[0],matrix[1],matrix[2],matrix[3],matrix[4],matrix[5]));gp.append(path)}return gp};
trapeze.font.TTFFont.prototype.addOnCurvePoint=function(rec,rs){if(rs.firstOn==null){rs.firstOn=rec;rs.gp.moveTo(rec.x,rec.y)}else if(rs.prevOff!=null){rs.gp.quadTo(rs.prevOff.x,rs.prevOff.y,rec.x,rec.y);rs.prevOff=null}else rs.gp.lineTo(rec.x,rec.y)};trapeze.font.TTFFont.prototype.addOffCurvePoint=function(rec,rs){if(rs.prevOff!=null){var oc=new PointRec((rec.x+rs.prevOff.x)/2,(rec.y+rs.prevOff.y)/2,true);this.addOnCurvePoint(oc,rs)}else if(rs.firstOn==null)rs.firstOff=rec;rs.prevOff=rec};
function RenderState(){this.gp;this.firstOn;this.firstOff;this.prevOff}function PointRec(a,b,c){if(a instanceof trapeze.font.GlyfSimple){this.x=a.getXCoord(b);this.y=a.getYCoord(b);this.onCurve=a.onCurve(b)}else{this.x=a;this.y=b;this.onCurve=c}}goog.provide("trapeze.font.CIDFontType2");goog.require("trapeze.font.TTFFont");goog.require("trapeze.cos.COSArray");goog.require("trapeze.cos.COSStream");
trapeze.font.CIDFontType2=function(baseFont,fontObj,descriptor){trapeze.font.CIDFontType2.baseConstructor.call(this,baseFont,fontObj,descriptor);this.widths=null;this.widthsVertical=null;this.defaultWidth=1E3;this.defaultWidthVertical=1E3;this.parseWidths(fontObj);var systemInfoObj=fontObj.getDictionaryObject("CIDSystemInfo");var mapObj=fontObj.getDictionaryObject("CIDToGIDMap");if(mapObj!=null&&mapObj instanceof trapeze.cos.COSStream){throw new UnimplementedException("Haven't finished cid to gid map for CID font");
this.cidToGidMap=mapObj.getStreamBuffer()}};extend(trapeze.font.CIDFontType2,trapeze.font.TTFFont);
trapeze.font.CIDFontType2.prototype.parseWidths=function(fontObj){var defaultWidthObj=fontObj.getDictionaryObject("DW");if(defaultWidthObj!=null)this.defaultWidth=defaultWidthObj.value;var entryIdx=0;var first=0;var last=0;var widthArray;var widthObj=fontObj.getDictionaryObject("W");if(widthObj!=null){this.widths={};widthArray=widthObj;var widthArraySize=widthArray.size();for(var i=0;i<widthArraySize;i++){if(entryIdx==0)first=widthArray.getObject(i).value;else if(entryIdx==1)if(widthArray.getObject(i)instanceof
trapeze.cos.COSArray){var entries=widthArray.getObject(i);for(var c=0;c<entries.size();c++){var key=c+first;var value=entries.getObject(c).value;this.widths[key]=value}entryIdx=-1}else last=getObject(i).value;else{var value=widthArray.getObject(i).value;for(var c=first;c<=last;c++)this.widths[c]=value;entryIdx=-1}entryIdx++}}defaultWidthObj=fontObj.getDictionaryObject("DW2");if(defaultWidthObj!=null)this.defaultWidthVertical=defaultWidthObj.value;widthObj=fontObj.getDictionaryObject("W2");if(widthObj!=
null){this.widthsVertical={};widthArray=widthObj;var widthArraySize=widthArray.size();entryIdx=0;first=0;last=0;for(var i=0;i<widthArraySize;i++){if(entryIdx==0)first=widthArray.getObject(i).value;else if(entryIdx==1)if(widthArray.getObject(i)instanceof trapeze.cos.COSArray){var entries=widthArray.getObject(i);for(var c=0;c<entries.size();c++){var key=c+first;var value=entries.getObject(c).value;this.widthsVertical[key]=value}entryIdx=-1}else last=getObject(i).value;else{var value=getObject(i).value;
for(var c=first;c<=last;c++)this.widthsVertical[c]=value;entryIdx=-1}entryIdx++}}};trapeze.font.CIDFontType2.prototype.getDefaultWidth=function(){return this.defaultWidth};goog.provide("trapeze.font.PDFCMap");goog.require("trapeze.cos.COSName");goog.require("trapeze.cos.COSStream");trapeze.font.PDFCMap=function(){};trapeze.font.PDFCMap.prototype.map=function(src){return src};trapeze.font.PDFCMap.prototype.getFontID=function(src){return 0};
trapeze.font.PDFCMap.getCMap=function(map){if(map instanceof trapeze.cos.COSName)return new trapeze.font.PDFCMap;else if(map instanceof trapeze.cos.COSStream)throw new UnimplementedException("Parsing a CMAP from a stream is not supported");else throw new IOException("CMap type not Name or Stream!");};goog.provide("trapeze.font.PDFFontEncoding");goog.require("trapeze.font.PDFCMap");goog.require("trapeze.font.FontSupport");goog.require("trapeze.cos.COSDictionary");goog.require("trapeze.cos.COSName");
goog.require("trapeze.cos.COSNumber");
trapeze.font.PDFFontEncoding=function(fontType,encoding){this.differences={};if(encoding instanceof trapeze.cos.COSDictionary){var typeStr=encoding.getDictionaryObject("Type").name;if(typeStr=="Encoding"){this.type=trapeze.font.PDFFontEncoding.TYPE_ENCODING;this.parseEncoding(encoding)}else if(typeStr=="CMap"){this.type=trapeze.font.PDFFontEncoding.TYPE_CMAP;this.cmap=trapeze.font.PDFCMap.getCMap(encoding)}else throw"Uknown encoding type: "+type;}else if(encoding instanceof trapeze.cos.COSName)if(fontType==
"Type0"){this.type=trapeze.font.PDFFontEncoding.TYPE_CMAP;this.cmap=trapeze.font.PDFCMap.getCMap(encoding)}else{this.type=trapeze.font.PDFFontEncoding.TYPE_ENCODING;this.differences={};this.baseEncoding=this.getBaseEncoding(encoding.name)}else throw"not doen pdffontencoding";};
trapeze.font.PDFFontEncoding.prototype.parseEncoding=function(encoding){this.differences={};var baseEncObj=encoding.getDictionaryObject("BaseEncoding");if(baseEncObj!=null)this.baseEncoding=this.getBaseEncoding(baseEncObj.name);var diffArrayObj=encoding.getDictionaryObject("Differences");if(diffArrayObj!=null){var diffArray=diffArrayObj;var curPosition=-1;for(var i=0;i<diffArray.size();i++){var test=diffArray.get(i);if(test instanceof trapeze.cos.COSNumber)curPosition=test.value;else if(test instanceof
trapeze.cos.COSName){var key=String.fromCharCode(curPosition);this.differences[key]=test.name;curPosition++}else throw"Unexpected type in diff array: "+test;}}};
trapeze.font.PDFFontEncoding.prototype.getBaseEncoding=function(encodingName){if(encodingName=="MacRomanEncoding")return trapeze.font.FontSupport.macRomanEncoding;else if(encodingName=="MacExpertEncoding")return trapeze.font.FontSupport.type1CExpertCharset;else if(encodingName=="WinAnsiEncoding")return trapeze.font.FontSupport.winAnsiEncoding;else throw"Unknown encoding: "+encodingName;};
trapeze.font.PDFFontEncoding.prototype.getGlyphs=function(font,text){var outList=[];for(var i=0;i<text.length;i++)switch(this.type){case trapeze.font.PDFFontEncoding.TYPE_ENCODING:outList.push(this.getGlyphFromEncoding(font,text.charAt(i)));break;case trapeze.font.PDFFontEncoding.TYPE_CMAP:break}return outList};
trapeze.font.PDFFontEncoding.prototype.getGlyphFromEncoding=function(font,src){var charName;if(this.differences[src]!=null)charName=this.differences[src];else if(this.baseEncoding!=null){var charID=this.baseEncoding[src.charCodeAt(0)];charName=trapeze.font.FontSupport.getName(charID)}return font.getCachedGlyph(src,charName)};trapeze.font.PDFFontEncoding.TYPE_ENCODING=0;trapeze.font.PDFFontEncoding.TYPE_CMAP=1;goog.provide("trapeze.font.Type0Font");
trapeze.font.Type0Font=function(baseFont,fontObj,descriptor){trapeze.font.Type0Font.baseConstructor.call(this,baseFont,fontObj,descriptor);var descendantFonts=fontObj.getDictionaryObject("DescendantFonts");var size=descendantFonts.size();this.fonts=new Array(size);for(var i=0;i<size;i++)this.fonts[i]=trapeze.font.FontManager.getFont(descendantFonts.getObject(i),null)};extend(trapeze.font.Type0Font,trapeze.font.PDFFont);goog.provide("trapeze.font.Type1CFont");goog.require("trapeze.font.OutlineFont");
goog.require("trapeze.font.FontSupport");goog.require("trapeze.StreamBuffer");goog.require("trapeze.GeneralPath");goog.require("trapeze.AffineTransform");
trapeze.font.Type1CFont=function(baseFont,fontObj,descriptor){trapeze.font.Type1CFont.baseConstructor.call(this,baseFont,fontObj,descriptor);this.pos=0;this.data=new trapeze.StreamBuffer(descriptor.fontFile3.decode());this.gsubrbase=0;this.lsubrbase=0;this.gsubrsoffset=0;this.lsubrsoffset=0;this.num;this.type;this.charstringtype;this.stack=[];this.stackptr=0;this.myEncoding=[];this.at=new trapeze.AffineTransform(0.001,0,0,0.001,0,0);this.charstringtype=2;this.charsetbase=0;this.encodingbase=0;this.charstringbase=
0;this.privatebase=0;this.privatesize=0;this.gsubrbase=0;this.lsubrbase=0;this.gsubrsoffset=0;this.lsubrsoffset=0;this.nglyphs=1;this.parse()};extend(trapeze.font.Type1CFont,trapeze.font.OutlineFont);trapeze.font.Type1CFont.CMD=0;trapeze.font.Type1CFont.NUM=1;trapeze.font.Type1CFont.FLT=2;
var temp={parse:function(){var majorVersion=this.readByte();var minorVersion=this.readByte();var hdrsz=this.readByte();var offsize=this.readByte();var fnames=hdrsz;var topdicts=fnames+this.getIndexSize(fnames);var theNames=topdicts+this.getIndexSize(topdicts);this.gsubrbase=theNames+this.getIndexSize(theNames);this.gsubrsoffset=this.calcoffset(this.gsubrbase);this.readNames(theNames);this.pos=topdicts;this.data.setPosition(this.pos);if(this.readInt(2)!=1)throw"More than one font in this file!";var r=
this.getIndexEntry(fnames,0);var p=this.pos;this.data.setPosition(r.start);this.fontname=this.data.read(r.len);this.data.setPosition(this.pos);this.readDict(this.getIndexEntry(topdicts,0));this.readDict({start:this.privatebase,len:this.privatesize});this.pos=this.charstringbase;this.data.setPosition(this.pos);this.nglyphs=this.readInt(2);this.readGlyphNames(this.charsetbase);this.readEncodingData(this.encodingbase)},getIndexSize:function(loc){var hold=this.pos;this.pos=loc;this.data.setPosition(loc);
var count=this.readInt(2);if(count<=0)return 2;var encsz=this.readByte();if(encsz<1||encsz>4)throw new Exception("Offsize: "+encsz+", must be in range 1-4.");this.pos+=count*encsz;this.data.setPosition(this.pos);var end=this.readInt(encsz);this.pos=hold;this.data.setPosition(hold);return 2+(count+1)*encsz+end},readByte:function(){this.pos++;return this.data.get()},readInt:function(len){var n=0;for(var i=0;i<len;i++){this.pos++;n=n<<8|this.data.get()&255}return n},calcoffset:function(base){var len=
this.getTableLength(base);if(len<1240)return 107;else if(len<33900)return 1131;else return 32768},getTableLength:function(loc){var hold=this.pos;this.pos=loc;this.data.setPosition(this.pos);var count=this.readInt(2);if(count<=0)return 2;this.pos=hold;this.data.setPosition(this.pos);return count},readNames:function(base){this.pos=base;this.data.setPosition(this.pos);var nextra=this.readInt(2);this.names=[];var p=this.data.getPosition();for(var i=0;i<nextra;i++){var r=this.getIndexEntry(base,i);this.data.setPosition(r.start);
this.names.push(this.data.read(r.len))}this.data.setPosition(p)},getIndexEntry:function(index,id){var hold=this.pos;this.pos=index;this.data.setPosition(this.pos);var count=this.readInt(2);var encsz=this.readByte();if(encsz<1||encsz>4)throw new Exception("Offsize: "+encsz+", must be in range 1-4.");this.pos+=encsz*id;this.data.setPosition(this.pos);var from=this.readInt(encsz);var r={start:from+2+index+encsz*(count+1),len:this.readInt(encsz)-from};this.pos=hold;this.data.setPosition(this.pos);return r},
readDict:function(r){this.pos=r.start;this.data.setPosition(this.pos);var end=r.len+r.start;while(this.pos<end){var cmd=this.readCommand(false);if(cmd==1006)this.charstringtype=this.stack[0];else if(cmd==1007)if(this.stackptr==4)this.at=new AffineTransform(this.stack[0],this.stack[1],this.stack[2],this.stack[3],0,0);else this.at=new trapeze.AffineTransform(this.stack[0],this.stack[1],this.stack[2],this.stack[3],this.stack[4],this.stack[5]);else if(cmd==15)this.charsetbase=this.stack[0];else if(cmd==
16)this.encodingbase=this.stack[0];else if(cmd==17)this.charstringbase=this.stack[0];else if(cmd==18){this.privatesize=this.stack[0];this.privatebase=this.stack[1]}else if(cmd==19){this.lsubrbase=this.privatebase+this.stack[0];this.lsubrsoffset=this.calcoffset(this.lsubrbase)}this.stackptr=0}this.data.setPosition(this.pos)},readCommand:function(charstring){while(true){var t=this.readNext(charstring);if(t==trapeze.font.Type1CFont.CMD)return this.num;else this.stack[this.stackptr++]=t==trapeze.font.Type1CFont.NUM?
this.num:this.fnum}},readNext:function(charstring){this.num=this.data.getByteAt(this.pos++);if(this.num==30&&!charstring){this.readFNum();return this.type=trapeze.font.Type1CFont.FLT}else if(this.num==28){this.num=(this.data.getAt(this.pos)<<8)+(this.data.getByteAt(this.pos+1)&255);this.pos+=2;return this.type=trapeze.font.Type1CFont.NUM}else if(this.num==29&&!charstring){this.num=(this.data.getByteAt(this.pos)&255)<<24|(this.data.getByteAt(this.pos+1)&255)<<16|(this.data.getByteAt(this.pos+2)&255)<<
8|this.data.getByteAt(this.pos+3)&255;this.pos+=4;return this.type=trapeze.font.Type1CFont.NUM}else if(this.num==12){this.num=1E3+(this.data.getByteAt(this.pos)&255);this.pos++;return this.type=trapeze.font.Type1CFont.CMD}else if(this.num<32)return this.type=trapeze.font.Type1CFont.CMD;else if(this.num<247){this.num-=139;return this.type=trapeze.font.Type1CFont.NUM}else if(this.num<251){this.num=(this.num-247)*256+(this.data.getByteAt(this.pos)&255)+108;this.pos++;return this.type=trapeze.font.Type1CFont.NUM}else if(this.num<
255){this.num=-(this.num-251)*256-(this.data.getByteAt(this.pos)&255)-108;this.pos++;return this.type=trapeze.font.Type1CFont.NUM}else if(!charstring){printData();throw new RuntimeException("Got a 255 code while reading dict");}else{this.fnum=((this.data.getByteAt(this.pos)&255)<<24|(this.data.getByteAt(this.pos+1)&255)<<16|(this.data.getByteAt(this.pos+2)&255)<<8|this.data.getByteAt(this.pos+3)&255)/65536;this.pos+=4;return this.type=trapeze.font.Type1CFont.FLT}},readFNum:function(){var f=0;var neg=
false;var exp=0;var eval=0;var mul=1;this.data.setPosition(this.pos);var work=this.readByte();while(true){if(work==221)work=this.readByte();var nyb=work>>4&15;work=(work<<4|13)&255;if(nyb<10)if(exp!=0)eval=eval*10+nyb;else if(mul==1)f=f*10+nyb;else{f+=nyb*mul;mul/=10}else if(nyb==10)mul=0.1;else if(nyb==11)exp=1;else if(nyb==12)exp=-1;else if(nyb==14)neg=true;else break}this.fnum=(neg?-1:1)*f*Math.pow(10,eval*exp)},readGlyphNames:function(base){if(base==0){this.glyphnames=new Array(229);for(var i=
0;i<229;i++)this.glyphnames[i]=i;return}else if(base==1){this.glyphnames=trapeze.font.FontSupport.type1CExpertCharset;return}else if(base==2){this.glyphnames=trapeze.font.FontSupport.type1CExpertSubCharset;return}this.glyphnames=[];this.glyphnames[0]=0;this.pos=base;this.data.setPosition(this.pos);var t=this.readByte();if(t==0)for(var i=1;i<this.nglyphs;i++)this.glyphnames[i]=this.readInt(2);else if(t==1){var n=1;while(n<this.nglyphs){var sid=this.readInt(2);var range=this.readByte()+1;for(var i=
0;i<range;i++)this.glyphnames[n++]=sid++}}else if(t==2){var n=1;while(n<this.nglyphs){var sid=this.readInt(2);var range=this.readInt(2)+1;for(var i=0;i<range;i++)ths.glyphnames[n++]=sid++}}},readEncodingData:function(base){if(base==0)this.myEncoding=trapeze.font.FontSupport.standardEncoding;else if(base==1)System.out.println("**** EXPERT ENCODING!");else{this.pos=base;this.data.setPosition(this.pos);var encodingtype=this.readByte();if((encodingtype&127)==0){var ncodes=this.readByte();for(var i=1;i<
ncodes+1;i++){var idx=this.readByte()&255;this.myEncoding[idx]=i}}else if((encodingtype&127)==1){var nranges=this.readByte();var p=1;for(var i=0;i<nranges;i++){var start=this.readByte();var more=this.readByte();for(var j=start;j<start+more+1;j++)this.myEncoding[j]=p++}}else System.out.println("Bad encoding type: "+encodingtype)}},getOutlineByName:function(name,width){var index=this.getNameIndex(name);for(var i=0;i<this.glyphnames.length;i++)if(this.glyphnames[i]==index)return this.readGlyph(this.charstringbase,
i);return this.readGlyph(this.charstringbase,0)},getOutlineByCode:function(src,width){var index=toSignedByte(src);if(this.encodingbase==0||this.encodingbase==1)for(var i=0;i<this.glyphnames.length;i++){if(this.glyphnames[i]==this.myEncoding[index])return this.readGlyph(this.charstringbase,i)}else if(index>0&&index<this.myEncoding.length)return this.readGlyph(this.charstringbase,this.myEncoding[index]);return this.readGlyph(this.charstringbase,0)},getNameIndex:function(name){var val=trapeze.font.FontSupport.findName(name,
trapeze.font.FontSupport.stdNames);if(val==-1)val=trapeze.font.FontSupport.findName(name,this.names)+trapeze.font.FontSupport.stdNames.length;if(val==-1)val=0;return val},readGlyph:function(base,offset){var pt={x:0,y:0,open:false};var r=this.getIndexEntry(base,offset);var gp=new trapeze.GeneralPath;var hold=this.pos;this.stackptr=0;this.parseGlyph(r,gp,pt);this.pos=hold;this.data.setPosition(this.pos);gp.transform(this.at);return gp},parseGlyph:function(r,gp,pt){this.pos=r.start;var i;var x1,y1,x2,
y2,x3,y3,ybase;var hold;var stemhints=0;var end=r.start+r.len;while(this.pos<end){var cmd=this.readCommand(true);hold=0;switch(cmd){case 1:case 3:this.stackptr=0;break;case 4:if(this.stackptr>1)this.stack[0]=this.stack[1];pt.y+=this.stack[0];if(pt.open)gp.closePath();pt.open=false;gp.moveTo(pt.x,pt.y);this.stackptr=0;break;case 5:for(i=0;i<this.stackptr;){pt.x+=this.stack[i++];pt.y+=this.stack[i++];gp.lineTo(pt.x,pt.y)}pt.open=true;this.stackptr=0;break;case 6:for(i=0;i<this.stackptr;){if((i&1)==
0)pt.x+=this.stack[i++];else pt.y+=this.stack[i++];gp.lineTo(pt.x,pt.y)}pt.open=true;this.stackptr=0;break;case 7:for(i=0;i<this.stackptr;){if((i&1)==0)pt.y+=this.stack[i++];else pt.x+=this.stack[i++];gp.lineTo(pt.x,pt.y)}pt.open=true;this.stackptr=0;break;case 8:for(i=0;i<this.stackptr;){x1=pt.x+this.stack[i++];y1=pt.y+this.stack[i++];x2=x1+this.stack[i++];y2=y1+this.stack[i++];pt.x=x2+this.stack[i++];pt.y=y2+this.stack[i++];gp.curveTo(x1,y1,x2,y2,pt.x,pt.y)}pt.open=true;this.stackptr=0;break;case 10:hold=
this.pos;i=this.stack[--this.stackptr]+this.lsubrsoffset;var lsubr=this.getIndexEntry(this.lsubrbase,i);this.parseGlyph(lsubr,gp,pt);this.pos=hold;break;case 11:return;case 14:if(this.stackptr==5)console.warn("build asccent char not done");if(pt.open)gp.closePath();pt.open=false;this.stackptr=0;break;case 18:stemhints+=Math.floor(this.stackptr/2);this.stackptr=0;break;case 19:case 20:stemhints+=Math.floor(this.stackptr/2);this.pos+=Math.floor((stemhints-1)/8+1);this.stackptr=0;break;case 21:if(this.stackptr>
2){this.stack[0]=this.stack[1];this.stack[1]=this.stack[2]}pt.x+=this.stack[0];pt.y+=this.stack[1];if(pt.open)gp.closePath();gp.moveTo(pt.x,pt.y);pt.open=false;this.stackptr=0;break;case 22:if(this.stackptr>1)this.stack[0]=this.stack[1];pt.x+=this.stack[0];if(pt.open)gp.closePath();gp.moveTo(pt.x,pt.y);pt.open=false;this.stackptr=0;break;case 23:stemhints+=this.stackptr/2;this.stackptr=0;break;case 24:for(i=0;i<this.stackptr-2;){x1=pt.x+this.stack[i++];y1=pt.y+this.stack[i++];x2=x1+this.stack[i++];
y2=y1+this.stack[i++];pt.x=x2+this.stack[i++];pt.y=y2+this.stack[i++];gp.curveTo(x1,y1,x2,y2,pt.x,pt.y)}pt.x+=this.stack[i++];pt.y+=this.stack[i++];gp.lineTo(pt.x,pt.y);pt.open=true;this.stackptr=0;break;case 25:for(i=0;i<this.stackptr-6;){pt.x+=this.stack[i++];pt.y+=this.stack[i++];gp.lineTo(pt.x,pt.y)}x1=pt.x+this.stack[i++];y1=pt.y+this.stack[i++];x2=x1+this.stack[i++];y2=y1+this.stack[i++];pt.x=x2+this.stack[i++];pt.y=y2+this.stack[i++];gp.curveTo(x1,y1,x2,y2,pt.x,pt.y);pt.open=true;this.stackptr=
0;break;case 26:i=0;if((this.stackptr&1)==1)pt.x+=this.stack[i++];while(i<this.stackptr){x1=pt.x;y1=pt.y+this.stack[i++];x2=x1+this.stack[i++];y2=y1+this.stack[i++];pt.x=x2;pt.y=y2+this.stack[i++];gp.curveTo(x1,y1,x2,y2,pt.x,pt.y)}pt.open=true;this.stackptr=0;break;case 27:i=0;if((this.stackptr&1)==1)pt.y+=this.stack[i++];while(i<this.stackptr){x1=pt.x+this.stack[i++];y1=pt.y;x2=x1+this.stack[i++];y2=y1+this.stack[i++];pt.x=x2+this.stack[i++];pt.y=y2;gp.curveTo(x1,y1,x2,y2,pt.x,pt.y)}pt.open=true;
this.stackptr=0;break;case 29:hold=this.pos;i=this.stack[--this.stackptr]+this.gsubrsoffset;var gsubr=this.getIndexEntry(this.gsubrbase,i);this.parseGlyph(gsubr,gp,pt);this.pos=hold;break;case 30:hold=4;case 31:for(i=0;i<this.stackptr;){var hv=(i+hold&4)==0;x1=pt.x+(hv?this.stack[i++]:0);y1=pt.y+(hv?0:this.stack[i++]);x2=x1+this.stack[i++];y2=y1+this.stack[i++];pt.x=x2+(hv?0:this.stack[i++]);pt.y=y2+(hv?this.stack[i++]:0);if(i==this.stackptr-1)if(hv)pt.x+=this.stack[i++];else pt.y+=this.stack[i++];
gp.curveTo(x1,y1,x2,y2,pt.x,pt.y)}pt.open=true;this.stackptr=0;break;case 1E3:this.stackptr=0;break;case 1003:x1=this.stack[--this.stackptr];y1=this.stack[--this.stackptr];this.stack[this.stackptr++]=x1!=0&&y1!=0?1:0;break;case 1004:x1=this.stack[--this.stackptr];y1=this.stack[--this.stackptr];this.stack[this.stackptr++]=x1!=0||y1!=0?1:0;break;case 1005:x1=this.stack[--this.stackptr];this.stack[this.stackptr++]=x1==0?1:0;break;case 1009:this.stack[this.stackptr-1]=Math.abs(this.stack[this.stackptr-
1]);break;case 1010:x1=this.stack[--this.stackptr];y1=this.stack[--this.stackptr];this.stack[this.stackptr++]=x1+y1;break;case 1011:x1=this.stack[--this.stackptr];y1=this.stack[--this.stackptr];this.stack[this.stackptr++]=y1-x1;break;case 1012:x1=this.stack[--this.stackptr];y1=this.stack[--this.stackptr];this.stack[this.stackptr++]=y1/x1;break;case 1014:this.stack[this.stackptr-1]=-this.stack[this.stackptr-1];break;case 1015:x1=this.stack[--this.stackptr];y1=this.stack[--this.stackptr];this.stack[this.stackptr++]=
x1==y1?1:0;break;case 1018:this.stackptr--;break;case 1020:i=this.stack[--this.stackptr];x1=this.stack[--this.stackptr];this.temps[i]=x1;break;case 1021:i=this.stack[--this.stackptr];this.stack[this.stackptr++]=this.temps[i];break;case 1022:if(this.stack[this.stackptr-2]>this.stack[this.stackptr-1])this.stack[this.stackptr-4]=this.stack[this.stackptr-3];this.stackptr-=3;break;case 1023:this.stack[this.stackptr++]=Math.random();break;case 1024:x1=this.stack[--this.stackptr];y1=this.stack[--this.stackptr];
this.stack[this.stackptr++]=y1*x1;break;case 1026:this.stack[this.stackptr-1]=Math.sqrt(this.stack[this.stackptr-1]);break;case 1027:x1=this.stack[this.stackptr-1];this.stack[this.stackptr++]=x1;break;case 1028:x1=this.stack[this.stackptr-1];this.stack[this.stackptr-1]=this.stack[this.stackptr-2];this.stack[this.stackptr-2]=x1;break;case 1029:i=this.stack[this.stackptr-1];if(i<0)i=0;this.stack[this.stackptr-1]=this.stack[this.stackptr-2-i];break;case 1030:console.warn("havent finished roll yet");
break;case 1034:x1=pt.x+this.stack[0];y1=ybase=pt.y;x2=x1+this.stack[1];y2=y1+this.stack[2];pt.x=x2+this.stack[3];pt.y=y2;gp.curveTo(x1,y1,x2,y2,pt.x,pt.y);x1=pt.x+this.stack[4];y1=pt.y;x2=x1+this.stack[5];y2=ybase;pt.x=x2+this.stack[6];pt.y=y2;gp.curveTo(x1,y1,x2,y2,pt.x,pt.y);pt.open=true;this.stackptr=0;break;case 1035:x1=pt.x+this.stack[0];y1=pt.y+this.stack[1];x2=x1+this.stack[2];y2=y1+this.stack[3];pt.x=x2+this.stack[4];pt.y=y2+this.stack[5];gp.curveTo(x1,y1,x2,y2,pt.x,pt.y);x1=pt.x+this.stack[6];
y1=pt.y+this.stack[7];x2=x1+this.stack[8];y2=y1+this.stack[9];pt.x=x2+this.stack[10];pt.y=y2+this.stack[11];gp.curveTo(x1,y1,x2,y2,pt.x,pt.y);pt.open=true;this.stackptr=0;break;case 1036:ybase=pt.y;x1=pt.x+this.stack[0];y1=pt.y+this.stack[1];x2=x1+this.stack[2];y2=y1+this.stack[3];pt.x=x2+this.stack[4];pt.y=y2;gp.curveTo(x1,y1,x2,y2,pt.x,pt.y);x1=pt.x+this.stack[5];y1=pt.y;x2=x1+this.stack[6];y2=y1+this.stack[7];pt.x=x2+this.stack[8];pt.y=ybase;gp.curveTo(x1,y1,x2,y2,pt.x,pt.y);pt.open=true;this.stackptr=
0;break;case 1037:ybase=pt.y;var xbase=pt.x;x1=pt.x+this.stack[0];y1=pt.y+this.stack[1];x2=x1+this.stack[2];y2=y1+this.stack[3];pt.x=x2+this.stack[4];pt.y=y2+this.stack[5];gp.curveTo(x1,y1,x2,y2,pt.x,pt.y);x1=pt.x+this.stack[6];y1=pt.y+this.stack[7];x2=x1+this.stack[8];y2=y1+this.stack[9];if(Math.abs(x2-xbase)>Math.abs(y2-ybase)){pt.x=x2+this.stack[10];pt.y=ybase}else{pt.x=xbase;pt.y=y2+this.stack[10]}gp.curveTo(x1,y1,x2,y2,pt.x,pt.y);pt.open=true;this.stackptr=0;break;default:System.out.println("ERROR! TYPE1C CHARSTRING CMD IS "+
cmd);break}}}};for(var key in temp)trapeze.font.Type1CFont.prototype[key]=temp[key];goog.provide("trapeze.font.Type3Font");goog.require("trapeze.font.PDFFont");goog.require("trapeze.font.PDFGlyph");goog.require("trapeze.Rectangle2D");goog.require("trapeze.PDFParser");goog.require("trapeze.GeneralPath");goog.require("trapeze.AffineTransform");goog.require("trapeze.cos.COSDictionary");
trapeze.font.Type3Font=function(baseFont,fontObj,resources,descriptor){trapeze.font.Type3Font.baseConstructor.call(this,baseFont,fontObj,descriptor);this.rsrc;this.charProcs;this.bbox;this.at;this.widths;this.firstChar;this.lastChar;this.rsrc=new trapeze.cos.COSDictionary;if(resources!=null)this.rsrc.addAll(resources.resources);var matrix=fontObj.getDictionaryObject("FontMatrix");var matrixAry=[];for(var i=0;i<6;i++)matrixAry.push(matrix.getObject(i).value);this.at=new trapeze.AffineTransform(matrixAry[0],
matrixAry[1],matrixAry[2],matrixAry[3],matrixAry[4],matrixAry[5]);var scale=matrixAry[0]+matrixAry[2];var rsrcObj=fontObj.getDictionaryObject("Resources");if(rsrcObj!=null)this.rsrc.addAll(rsrcObj);this.charProcs=fontObj.getDictionaryObject("CharProcs");var bboxdef=fontObj.getDictionaryObject("FontBBox");var bboxfdef=[];for(var i=0;i<4;i++)bboxfdef.push(bboxdef.getObject(i).value);this.bbox=new trapeze.Rectangle2D(bboxfdef[0],bboxfdef[1],bboxfdef[2]-bboxfdef[0],bboxfdef[3]-bboxfdef[1]);if(this.bbox.isEmpty())this.bbox=
null;var widthArray=fontObj.getDictionaryObject("Widths");this.widths=[];var widthLength=widthArray.size();for(var i=0;i<widthLength;i++)this.widths[i]=widthArray.getObject(i).value;this.firstChar=fontObj.getDictionaryObject("FirstChar").value;this.lastChar=fontObj.getDictionaryObject("LastChar").value};extend(trapeze.font.Type3Font,trapeze.font.PDFFont);
trapeze.font.Type3Font.prototype.getGlyph=function(src,name){if(name==null)throw new IllegalArgumentException("Glyph name required for Type3 font!"+"Source character: "+src);var pageObj=this.charProcs.getDictionaryObject(name);if(pageObj==null)return new trapeze.font.PDFGlyph(src,name,new trapeze.GeneralPath,new Point2D.Float(0,0));var width=this.widths[src-this.firstChar];var advance={x:width,y:0};advance=this.at.transform(advance);return new trapeze.font.PDFGlyph(src,name,pageObj,advance)};goog.provide("trapeze.font.FontManager");
goog.require("trapeze.font.OutlineFont");goog.require("trapeze.font.Type3Font");goog.require("trapeze.font.Type1Font");goog.require("trapeze.font.Type1CFont");goog.require("trapeze.font.Type0Font");goog.require("trapeze.font.TTFFont");goog.require("trapeze.font.PDFFontEncoding");goog.require("trapeze.font.PDFFontDescriptor");goog.require("trapeze.font.CIDFontType2");goog.require("trapeze.font.BuiltInFont");
trapeze.font.FontManager.getFont=function(obj,resources){if(obj["cachedFont"]!=null)return obj["cachedFont"];var baseFont=null;var encoding=null;var descriptor=null;var subType=obj.getDictionaryObject("Subtype").name;if(subType==null)subType=obj.getDictionaryObject("S").name;var baseFontObj=obj.getDictionaryObject("BaseFont");var encodingObj=obj.getDictionaryObject("Encoding");var descObj=obj.getDictionaryObject("FontDescriptor");if(baseFontObj!=null)baseFont=baseFontObj.name;else{baseFontObj=obj.getDictionaryObject("Name");
if(baseFontObj!=null)baseFont=baseFontObj.name}if(encodingObj!=null)encoding=new trapeze.font.PDFFontEncoding(subType,encodingObj);if(descObj!=null)descriptor=new trapeze.font.PDFFontDescriptor(descObj);else descriptor=new trapeze.font.PDFFontDescriptor(baseFont);if(subType=="Type0")font=new trapeze.font.Type0Font(baseFont,obj,descriptor);else if(subType=="Type1")if(descriptor==null)font=new trapeze.font.BuiltInFont(baseFont,obj);else if(descriptor.fontFile!=null)font=new trapeze.font.Type1Font(baseFont,
obj,descriptor);else if(descriptor.fontFile3!=null)font=new trapeze.font.Type1CFont(baseFont,obj,descriptor);else font=new trapeze.font.BuiltInFont(baseFont,obj,descriptor);else if(subType=="TrueType")if(descriptor.fontFile2!=null)font=new trapeze.font.TTFFont(baseFont,obj,descriptor);else font=new trapeze.font.BuiltInFont(baseFont,obj,descriptor);else if(subType=="Type3")font=new trapeze.font.Type3Font(baseFont,obj,resources,descriptor);else if(subType=="CIDFontType2")font=new trapeze.font.CIDFontType2(baseFont,
obj,descriptor);else if(subType=="CIDFontType0")font=new trapeze.font.CIDFontType2(baseFont,obj,descriptor);else throw"Don't know how to handle a '"+subType+"' font";font.subtype=subType;font.encoding=encoding;obj["cachedFont"]=font;return font};goog.provide("trapeze.Commander");goog.require("trapeze.colorspace.ColorSpaceManager");goog.require("trapeze.colorspace.PatternSpace");goog.require("trapeze.font.FontManager");goog.require("trapeze.pdmodel.PDResources");goog.require("trapeze.Rectangle2D");
goog.require("trapeze.AffineTransform");goog.require("trapeze.cos.COSString");goog.require("trapeze.cos.COSDictionary");goog.require("trapeze.cos.COSNumber");
trapeze.Commander=function(graphics,resources,initialMatrix,streamEngine){this.graphics=graphics;this.graphics.beginPath();this.text=new TextState(this);this.textStack=[];this.transform=initialMatrix;this.transformStack=[];this.fillCS=null;this.strokeCS=null;this.resources=resources;this.initialMatrix=initialMatrix;this.streamEngine=streamEngine;this.clip=0};
trapeze.Commander.prototype={saveGraphics:function(args){this.graphics.save();this.transformStack.push(this.transform);this.transform=this.transform.clone()},restoreGraphics:function(args){this.graphics.restore();this.transform=this.transformStack.pop()},concatenate:function(args){var a=args[0].value;var b=args[1].value;var c=args[2].value;var d=args[3].value;var e=args[4].value;var f=args[5].value;this.graphics.transform(a,b,c,d,e,f);this.transform=this.transform.multiply(new trapeze.AffineTransform(a,
b,c,d,e,f))},appendRectangleToPath:function(args){var x=args[0].value;var y=args[1].value;var width=args[2].value;var height=args[3].value;this.graphics.moveTo(x,y);this.graphics.lineTo(x+width,y);this.graphics.lineTo(x+width,y+height);this.graphics.lineTo(x,y+height);this.graphics.closePath()},beginText:function(args){this.text.textMatrix=new trapeze.AffineTransform;this.text.textLineMatrix=new trapeze.AffineTransform},endPath:function(args){if(this.clip!=0)this.addPath(this.clip);this.clip=0;this.graphics.closePath();
this.graphics.beginPath()},setGraphicsStateParameters:function(args){var name=args[0].name;var gsobj=this.resources.getGraphicsState(name);if(gsobj==null)return;var d;if((d=gsobj.getDictionaryObject("LW"))!=null)this.setLineWidth([d]);if((d=gsobj.getDictionaryObject("LC"))!=null)this.setLineCapStyle([d]);if((d=gsobj.getDictionaryObject("LJ"))!=null)this.setLineJoinStyle([d]);if((d=gsobj.getDictionaryObject("Font"))!=null)this.textFormat.setFont([d]);if((d=gsobj.getDictionaryObject("ML"))!=null)this.setLineMiterLimit([d]);
if((d=gsobj.getDictionaryObject("D"))!=null)console.warn("gs - dash not done");if((d=gsobj.getDictionaryObject("CA"))!=null)console.warn("gs - stroke alpha not done");if((d=gsobj.getDictionaryObject("ca"))!=null)console.warn("gs - fille alpha not done")},endText:function(args){},lineTo:function(args){var x=args[0].value;var y=args[1].value;this.graphics.lineTo(x,y)},moveText:function(args){var x=args[0].value;var y=args[1].value;this.text.carriageReturn(x,y)},moveTextSetLeading:function(args){var x=
args[0].value;var y=args[1].value;this.text.leading=-y;this.text.carriageReturn(x,y)},moveTo:function(args){var x=args[0].value;var y=args[1].value;this.graphics.moveTo(x,y)},setTextLeading:function(args){var leading=args[0].value;this.text.leading=leading},setTextRenderingMode:function(args){var mode=args[0].value;this.text.setMode(mode)},setTextRise:function(args){var rise=args[0].value;this.text.rise=rise},setTextMatrix:function(args){var a=args[0].value;var b=args[1].value;var c=args[2].value;
var d=args[3].value;var e=args[4].value;var f=args[5].value;var textMatrix=new trapeze.AffineTransform(a,b,c,d,e,f);this.text.textMatrix=textMatrix;this.text.textLineMatrix=textMatrix.clone()},setTextFont:function(args){if(args.length>=2){var fontName=args[0];var fontSize=args[1].value;this.text.fontSize=fontSize;var fontObj=this.resources.getFont(fontName.name);if(fontObj!=null){var fontName=fontObj.getDictionaryObject("BaseFont");this.text.font=trapeze.font.FontManager.getFont(fontObj,this.resources)}else debugger}},
setWordSpacing:function(args){var wordSpacing=args[0].value;this.text.wordSpacing=wordSpacing},setCharSpacing:function(args){var characterSpacing=args[0].value;this.text.characterSpacing=characterSpacing},showText:function(args){var text=args[0].value;this.text.graphics=this.graphics;this.text.doText(text)},showKernedText:function(args){var textArray=args[0];var length=textArray.size();for(var i=0;i<length;i++){var obj=textArray.get(i);if(obj instanceof trapeze.cos.COSNumber){var val=obj.value/1E3;
this.text.textMatrix=this.text.textMatrix.translate(-val*this.text.fontSize*this.text.horizontalScaling,0)}else if(obj instanceof trapeze.cos.COSString){this.text.graphics=this.graphics;this.text.doText(obj.value)}}},strokePath:function(args){this.addPath(Shape.STROKE|this.clip);this.clip=0;this.graphics.beginPath()},closeAndStrokePath:function(args){this.graphics.closePath();this.addPath(Shape.STROKE|this.clip);this.clip=0;this.graphics.beginPath()},fillPath:function(args){this.addPath(Shape.FILL|
this.clip);this.clip=0;this.graphics.beginPath()},fillEvenOddRule:function(args){this.addPath(Shape.FILL|this.clip);this.clip=0;this.graphics.beginPath()},fillNonZeroAndStrokePath:function(args){this.graphics.closePath();this.addPath(Shape.BOTH|this.clip);this.clip=0;this.graphics.beginPath()},closeStrokefillPath:function(args){this.graphics.closePath();this.addPath(Shape.BOTH|this.clip);this.clip=0;this.graphics.beginPath()},setNonStrokingGrayColor:function(args){var x=Math.round(args[0].value*255);
this.graphics.fillStyle="rgb("+x+","+x+","+x+")"},setStrokingGrayColor:function(args){var x=Math.round(args[0].value*255);this.graphics.strokeStyle="rgb("+x+","+x+","+x+")"},setNonStrokingRGBColor:function(args){var r=Math.round(args[0].value*255);var g=Math.round(args[1].value*255);var b=Math.round(args[2].value*255);this.graphics.fillStyle="rgb("+r+","+g+","+b+")"},setStrokingRGBColor:function(args){var r=Math.round(args[0].value*255);var g=Math.round(args[1].value*255);var b=Math.round(args[2].value*
255);this.graphics.strokeStyle="rgb("+r+","+g+","+b+")"},setNonStrokingCMYKColor:function(args){var c=args[0].value;var m=args[1].value;var y=args[2].value;var k=args[3].value;var rgb=trapeze.colorspace.PDFColorSpace.CMYKtoRGB(c,m,y,k);this.graphics.fillStyle="rgb("+rgb[0]+","+rgb[1]+","+rgb[2]+")"},setStrokingCMYKColor:function(args){var c=args[0].value;var m=args[1].value;var y=args[2].value;var k=args[3].value;var rgb=trapeze.colorspace.PDFColorSpace.CMYKtoRGB(c,m,y,k);this.graphics.strokeStyle=
"rgb("+rgb[0]+","+rgb[1]+","+rgb[2]+")"},setNonStrokingColorSpace:function(args){console.warn('not finished with "cs"');this.fillCS=trapeze.colorspace.ColorSpaceManager.getColorSpace(args[0],this.resources)},setNonStrokingColor:function(args){if(this.fillCS instanceof trapeze.colorspace.PatternSpace){console.warn('not finished with "scn"');this.graphics.fillStyle="rgb("+0+","+0+","+0+")";return;var patternName=args[0].name;var patternDictionary=this.resources.resources.getDictionaryObject("Pattern");
var pattern=patternDictionary.getDictionaryObject(patternName);var components=[];for(var i=1;i<args.length;i++)components.push(args[i].value);this.fillCS.getPaint(pattern,components,this.resources)}else{var n=this.fillCS.getNumComponents();var arry=[];for(var i=0;i<n;i++)arry.push(args[i].value);var rgb=this.fillCS.getPaint(arry);var r=Math.round(rgb[0]*255);var g=Math.round(rgb[1]*255);var b=Math.round(rgb[2]*255);this.graphics.fillStyle="rgb("+r+","+g+","+b+")"}},carriageReturn:function(args){this.text.carriageReturn()},
moveAndShow:function(args){var text=args[0].value;this.text.carriageReturn();this.text.doText(text)},setHorizontalTextScaling:function(args){var scale=args[0].value;this.text.horizontalScaling=scale/100},setLineWidth:function(args){var width=args[0].value;this.graphics.lineWidth=width},clipNonZeroRule:function(args){this.clip=Shape.CLIP},clipEvenOddRule:function(args){this.clip=Shape.CLIP},closePath:function(args){this.graphics.closePath()},curveTo:function(args){var a=args[0].value;var b=args[1].value;
var c=args[2].value;var d=args[3].value;var e=args[4].value;var f=args[5].value;this.graphics.bezierCurveTo(a,b,c,d,e,f)},curveToReplicateInitialPoint:function(args){var a=args[0].value;var b=args[1].value;var c=args[2].value;var d=args[3].value;this.graphics.quadraticCurveTo(a,b,c,d)},curveToReplicateFinalPoint:function(args){var a=args[0].value;var b=args[1].value;var c=args[2].value;var d=args[3].value;this.graphics.bezierCurveTo(a,b,c,d,c,d)},beginCompatibilitySection:function(args){},endCompatibilitySection:function(args){},
beginInlineImage:function(args){},endInlineImage:function(args){this.doImage(args[0])},doXObject:function(args){var name=args[0].name;var xObject=this.resources.getXObject(name);var dictionary=xObject.dictionary;var subType=dictionary.getDictionaryObject("Subtype").name;if(subType=="Image")this.doImage(xObject);else if(subType=="Form"){this.doForm(xObject);console.warn("XObject type '"+subType+"' is not completely done.")}else console.warn("XObject type '"+subType+"' is not supported yet.")},doImage:function(obj){this.graphics.save();
var dictionary=obj.dictionary;var width=dictionary.getDictionaryObject("Width").value;var height=dictionary.getDictionaryObject("Height").value;var at=new trapeze.AffineTransform(1/width,0,0,-1/height,0,1);var transform=this.transform.multiply(at);var imageSource=obj.getImageString(this.resources,this.graphics);var image=new Image;image.src=imageSource;this.graphics.drawImage(image,transform);this.graphics.restore()},doForm:function(obj){var at;var matrix=obj.dictionary.getDictionaryObject("Matrix");
if(matrix==null)at=new trapeze.AffineTransform;else{var elts=[];for(var i=0;i<6;i++)elts[i]=matrix.get(i).value;at=new trapeze.AffineTransform(elts[0],elts[1],elts[2],elts[3],elts[4],elts[5])}var bobj=obj.dictionary.getDictionaryObject("BBox");var r=new trapeze.cos.COSDictionary(jQuery.extend(true,{},this.resources.resources._items));var rsrc=obj.dictionary.getDictionaryObject("Resources");if(rsrc!=null)r.putAll(rsrc);var previousResources=this.resources;this.resources=new trapeze.pdmodel.PDResources(r);
var transform=at;this.graphics.save();this.graphics.transform(transform.m00,transform.m10,transform.m01,transform.m11,transform.m02,transform.m12);this.transform=this.transform.multiply(at);this.streamEngine.processSubStream(null,r,obj);this.graphics.restore();this.resources=previousResources},setLineJoinStyle:function(args){var joinStyle=args[0].value;var join="miter";switch(joinStyle){case 0:join="miter";break;case 1:join="round";break;case 2:join="bevel";break}this.graphics.lineJoin=join},setLineCapStyle:function(args){var capStyle=
args[0].value;var cap="butt";switch(capStyle){case 0:cap="butt";break;case 1:cap="round";break;case 2:cap="square";break}this.graphics.lineCap=cap},setLineMiterLimit:function(args){var limit=args[0].value;this.graphics.miterLimit=limit},addPath:function(style){if((style&Shape.FILL)!=0)this.graphics.fill();if((style&Shape.STROKE)!=0)this.graphics.stroke();if((style&Shape.CLIP)!=0)this.graphics.clip()}};
function TextState(commander){this.commander=commander;this.textMatrix;this.textLineMatrix;this.characterSpacing=0;this.wordSpacing=0;this.horizontalScaling=1;this.leading=0;this.font;this.fontSize;this.renderingMode=Shape.FILL;this.rise=0;this.knockout=true;this.graphics;this.carriageReturn=function(xArg,yArg){var x=0;var y=-this.leading;if(arguments.length==2){x=xArg;y=yArg}this.textLineMatrix=this.textLineMatrix.translate(x,y);this.textMatrix=this.textLineMatrix.clone()},this.setMode=function(m){var mode=
0;if((m&1)==0)mode|=Shape.FILL;if((m&4)!=0)mode|=Shape.CLIP;if((m&1^(m&2)>>1)!=0)mode|=Shape.STROKE;this.renderingMode=mode};this.doText=function(text){var scale=new trapeze.AffineTransform(this.fontSize,0,0,this.fontSize*this.horizontalScaling,0,this.rise);var glyphs=this.font.getGlyphs(text);for(var i=0;i<glyphs.length;i++){this.graphics.save();var glyph=glyphs[i];var at=this.textMatrix.clone();at=at.multiply(scale);var transform=at;this.graphics.transform(transform.m00,transform.m10,transform.m01,
transform.m11,transform.m02,transform.m12);this.graphics.beginPath();var advance=glyph.render(this.graphics,this.commander);if((this.renderingMode&Shape.FILL)!=0)this.graphics.fill();if((this.renderingMode&Shape.STROKE)!=0)this.graphics.stroke();if((this.renderingMode&Shape.CLIP)!=0)this.graphics.clip();var advanceX=advance.x*this.fontSize+this.characterSpacing;if(glyph.getChar()==" ")advanceX+=this.wordSpacing;advanceX*=this.horizontalScaling;this.textMatrix=this.textMatrix.translate(advanceX,advance.y);
this.graphics.restore()}this.graphics.beginPath()}}function Shape(){}Shape.STROKE=1;Shape.FILL=2;Shape.BOTH=3;Shape.CLIP=4;goog.provide("trapeze.PDFOperatorMap");
trapeze.PDFOperatorMap=function(){this.map={"b":"closeStrokefillPath","B":"fillNonZeroAndStrokePath","BI":"beginInlineImage","BT":"beginText","BX":"beginCompatibilitySection","c":"curveTo","cm":"concatenate","cs":"setNonStrokingColorSpace","Do":"doXObject","EI":"endInlineImage","ET":"endText","EX":"endCompatibilitySection","f":"fillPath","f*":"fillEvenOddRule","G":"setStrokingGrayColor","g":"setNonStrokingGrayColor","gs":"setGraphicsStateParameters","h":"closePath","j":"setLineJoinStyle","J":"setLineCapStyle",
"K":"setStrokingCMYKColor","k":"setNonStrokingCMYKColor","l":"lineTo","m":"moveTo","M":"setLineMiterLimit","n":"endPath","q":"saveGraphics","Q":"restoreGraphics","re":"appendRectangleToPath","RG":"setStrokingRGBColor","rg":"setNonStrokingRGBColor","s":"closeAndStrokePath","S":"strokePath","scn":"setNonStrokingColor","T*":"carriageReturn","Tc":"setCharSpacing","Td":"moveText","TD":"moveTextSetLeading","Tf":"setTextFont","Tj":"showText","TJ":"showKernedText","TL":"setTextLeading","Tm":"setTextMatrix",
"Tr":"setTextRenderingMode","Ts":"setTextRise","Tw":"setWordSpacing","Tz":"setHorizontalTextScaling","v":"curveToReplicateInitialPoint","w":"setLineWidth","W":"clipNonZeroRule","W*":"clipEvenOddRule","y":"curveToReplicateFinalPoint","'":"moveAndShow"}};goog.provide("trapeze.PDFStreamEngine");goog.require("trapeze.PDFOperatorMap");goog.require("trapeze.Commander");goog.require("trapeze.cos.COSObject");
trapeze.PDFStreamEngine=function(canvas,initialMatrix){this.page;this.canvas=canvas;this.initialMatrix=initialMatrix;this.resources;this.processStream=function(aPage,resources,cosStream){this.commander=new trapeze.Commander(this.canvas,resources,this.initialMatrix,this);this.map=(new trapeze.PDFOperatorMap(this.commander)).map;this.resources=resources;this.processSubStream(aPage,resources,cosStream)};this.processSubStream=function(aPage,resources,cosStream){this.page=aPage;var arguments=[];var tokens=
cosStream.getStreamTokens();var length=tokens.length;for(var i=0;i<length;i++){var next=tokens[i];if(next instanceof trapeze.cos.COSObject)arguments.push(next.getObject());else if(next instanceof trapeze.PDFOperator){this.processOperator(next,arguments,i+1==length);arguments=[]}else arguments.push(next)}};this.processOperator=function(operator,args,last){var operation=operator.operator;var processor=this.map[operation];if(processor!=null)this.commander[processor].call(this.commander,args);else console.warn("UNIMPLEMENTED OP '"+
operation+"'")}};if(typeof window=="undefined"){if(typeof COMPILED=="undefined")importScripts("../external/closure-library/closure/goog/bootstrap/webworkers.js","../external/closure-library/closure/goog/base.js","deps.js","FauxConsole.js","Image.js","util.js");importScripts("../external/jquerywebworker.js","../external/deflate.js","../external/base64.js")}goog.provide("trapeze.TrapezeWorker");goog.require("trapeze.util");goog.require("trapeze.StreamBuffer");goog.require("trapeze.PDFStreamEngine");
goog.require("trapeze.PDFParser");goog.require("trapeze.Faux2dContext");trapeze.TrapezeWorker=function(callback){this.callback=callback};trapeze.TrapezeWorker.prototype.postMessage=function(data){this.callback(data)};
trapeze.TrapezeWorker.prototype.onmessage=function(event){if(event.data["type"]=="init"){console.time("process");var stream=new trapeze.StreamBuffer(event.data["fileContents"]);var parser=new trapeze.PDFParser(stream);parser.parse();var myDocument=parser.getPDDocument();var info=myDocument.getDocumentInformation();this.pages=myDocument.getDocumentCatalog().getAllPages();this.currentPage=1;this.totalPages=this.pages.length;this.postMessage(["setTotalPages",[this.totalPages]]);this.init(event.data["width"],
event.data["height"]);console.timeEnd("process")}else if(event.data["type"]=="redraw"){this.postMessage(["init",[]]);this.init(event.data["width"],event.data["height"])}else if(event.data["type"]=="requestPage"){this.drawPage(event.data["pageIndex"]);if(event.data["pageIndex"]+1<this.totalPages)this.drawPage(event.data["pageIndex"]+1)}};
trapeze.TrapezeWorker.prototype.init=function(width,height){this.preferredWidth=width;this.preferredHeight=height;for(var i=0;i<this.totalPages;i++){var page=this.pages[i];page.drawn=false;var pageSize=page.getUnstretchedSize(this.preferredWidth,this.preferredHeight);var mediaBox=page.findMediaBox();this.postMessage(["initPage",[i,pageSize,mediaBox]])}this.postMessage(["initPager"],[])};
trapeze.TrapezeWorker.prototype.drawPage=function(i){var page=this.pages[i];if(page.drawn)return;page.drawn=true;var resources=page.findResources();var canvas=this.getCanvas(i);var pageSize=page.getUnstretchedSize(this.preferredWidth,this.preferredHeight);var transform=page.getInitialTransform(pageSize.width,pageSize.height);var ctx=canvas.getContext("2d");canvas.width=pageSize.width;canvas.height=pageSize.height;ctx.transform(transform.m00,transform.m10,transform.m01,transform.m11,transform.m02,
transform.m12);var engine=new trapeze.PDFStreamEngine(canvas.getContext("2d"),transform);engine.processStream(page,resources,page.getContents().getStream());page.drawToCanvas();ctx.post()};trapeze.TrapezeWorker.prototype.getCanvas=function(i){var that=this;var ctx=new trapeze.Faux2dContext(function(data){that.postMessage(data)},i);return{index:i,width:0,height:0,getContext:function(context){return ctx}}};
if(typeof window=="undefined"){var that=this;var worker=new trapeze.TrapezeWorker(function(data){that.postMessage(data)});addEventListener("message",function(event){worker.onmessage(event)},false)}goog.provide("trapeze.FauxWorker");goog.require("trapeze.TrapezeWorker");trapeze.FauxWorker=function(){var that=this;this.worker=new trapeze.TrapezeWorker(function(data){that.onmessage({"data":data})})};trapeze.FauxWorker.prototype.postMessage=function(data){this.worker.onmessage({"data":data})};goog.provide("trapeze.Trapeze");
goog.require("trapeze.AsyncFileReader");goog.require("trapeze.FauxWorker");function Trapeze(file,settings){var defaults={enableWebWorkers:true};this.settings=$.extend({},defaults,settings);this.currentPage=1;this.totalPages=0;this.init();this.standardZooms=[10,25,50,75,100,125,150,200,400,800,1600];this.width=window.innerWidth-40;this.height=window.innerHeight-75;$("#progress").show();var asyncFileReader=new trapeze.AsyncFileReader(file,this,this.loaded,this.progress);asyncFileReader.start()}
Trapeze.prototype={init:function(){this.drawnPages={};this.waitingToDraw={};this.canvasWrappers=[];this.contexts=[];this.actions=[];this.clear()},progress:function(e){var percentComplete=Math.ceil(100*e.loaded/e.total);var kbLoaded=Math.round(e.loaded/1E3);var kbTotal=Math.round(e.total/1E3);$("#progressBar").css("width",percentComplete+"%");$("#progressPercent").text(percentComplete+"% ["+kbLoaded+" of "+kbTotal+" KB]");console.log(percentComplete+"% ["+kbLoaded+" of "+kbTotal+" KB]")},loaded:function(fileSize,
fileContents){$("#progressBar").css("width","100%");$("#progress").hide();$(".zoom").removeClass("disabled");if(this.settings.enableWebWorkers)this.worker=new Worker("../src/TrapezeWorker.js");else this.worker=new trapeze.FauxWorker;var that=this;this.worker.onmessage=function(event){var method=event.data[0];var args=event.data[1];that[method].apply(that,args)};this.worker.postMessage({type:"init",fileContents:fileContents,width:this.width,height:this.height})},initPage:function(pageIndex,pageDimensions,
realDimensions){var wrapper=$('<div id="page'+(pageIndex+1)+'" class="page"></div>"');var canvas=$('<canvas id="canvas'+pageIndex+'"></canvas>');wrapper.html(canvas);wrapper.append('<div id="loading'+pageIndex+'" style="position: absolute; left: 50%; top: 50%;"><img src="images/indicator.gif"></div>');wrapper.pageNumber=pageIndex;wrapper.rendered=false;$("#pages").append(wrapper);canvas=this.getCanvas(pageIndex);var ctx=canvas.getContext("2d");canvas.width=pageDimensions.width;canvas.height=pageDimensions.height;
this.setZoom(100*pageDimensions.height/realDimensions.height);this.contexts[pageIndex]=ctx;this.canvasWrappers.push(wrapper)},schedulePageToDraw:function(pageIndex){if(this.waitingToDraw[pageIndex]===true)return;if(this.actions[pageIndex]!=undefined)this.drawPage(pageIndex);else{this.waitingToDraw[pageIndex]=true;this.worker.postMessage({type:"requestPage",pageIndex:pageIndex})}},pageReady:function(pageIndex,actions){this.drawnPages[pageIndex]=false;this.actions[pageIndex]=actions;if(this.waitingToDraw[pageIndex]!=
undefined)this.drawPage(pageIndex)},drawPage:function(pageIndex){this.drawnPages[pageIndex]=true;var method,args;var actions=this.actions[pageIndex];var ctx=this.contexts[pageIndex];var actionsLength=actions.length;for(var i=0;i<actionsLength;i++){var action=actions[i];var type=action[0];if(type==0){method=action[1];args=action[2];ctx[method].apply(ctx,args)}else if(type==1){var key=action[1];var value=action[2];ctx[key]=value}else{method=action[1];args=action[2];if(method=="drawImage"){var image=
new Image;image.src=args[0].src;var transform=args[1];(function(image,transform){image.onload=function(){ctx.save();ctx.setTransform(transform.m00,transform.m10,transform.m01,transform.m11,transform.m02,transform.m12);ctx.drawImage(image,0,0);ctx.restore()}})(image,transform)}}}this.actions[pageIndex]=null;$("#loading"+pageIndex).hide()},clear:function(){$("#pages").empty()},zoomIn:function(){var newZoom=this.zoom;for(var i=0;i<this.standardZooms.length;i++)if(this.standardZooms[i]>this.zoom){newZoom=
this.standardZooms[i];break}this.width*=newZoom/this.zoom;this.height*=newZoom/this.zoom;this.worker.postMessage({type:"redraw",width:this.width,height:this.height})},zoomOut:function(){var newZoom=this.zoom;for(var i=this.standardZooms.length;i>-1;i--)if(this.standardZooms[i]<this.zoom){newZoom=this.standardZooms[i];break}this.width*=newZoom/this.zoom;this.height*=newZoom/this.zoom;this.worker.postMessage({type:"redraw",width:this.width,height:this.height})},setZoom:function(percent){this.zoom=Math.round(percent);
$("#zoomPercent").html(Math.round(percent)+"%")},setTotalPages:function(num){this.currentPage=1;this.totalPages=num;$("#totalPages").html(this.totalPages)},getCanvas:function(i){return document.getElementById("canvas"+i)},initPager:function(){if(this.totalPages>1)$("#nextPage").show();var that=this;$(window).scroll(function(){for(var i=0;i<that.canvasWrappers.length;i++){if(that.isScrolledIntoView(that.canvasWrappers[i]))if(!that.drawnPages[i])that.schedulePageToDraw(i);if(that.isScrolledIntoMiddleView(that.canvasWrappers[i])){var pageNumber=
that.canvasWrappers[i].pageNumber;that.setPage(pageNumber+1)}}}).scroll()},nextPage:function(){window.location.hash="#page"+(this.currentPage+1)},previousPage:function(){window.location.hash="#page"+(this.currentPage-1)},setPage:function(page){this.currentPage=page;if(this.currentPage<2)$("#previousPage").hide();if(this.totalPages>1&&this.currentPage<this.totalPages)$("#nextPage").show();if(this.currentPage>=this.totalPages)$("#nextPage").hide();if(this.currentPage>1)$("#previousPage").show();$("#currentPage").html(page)},
isScrolledIntoView:function(elem){var docViewTop=$(window).scrollTop();var docViewBottom=docViewTop+$(window).height();var elemTop=elem.offset().top;var elemBottom=elemTop+elem.height();return elemBottom>=docViewTop&&elemTop<=docViewBottom},isScrolledIntoMiddleView:function(elem){var docViewTop=$(window).scrollTop();var docViewBottom=docViewTop+$(window).height()/2;var elemTop=elem.offset().top;var elemBottom=elemTop+elem.height();return elemBottom>=docViewTop&&elemTop<=docViewBottom},log:function(value){console.log(value)},
error:function(value){console.warn(value)},warn:function(value){console.warn(value)},time:function(value){console.time(value)},timeEnd:function(value){console.timeEnd(value)}};
